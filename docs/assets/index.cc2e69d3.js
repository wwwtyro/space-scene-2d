var vc=Object.defineProperty;var Ku=Object.getOwnPropertySymbols;var mc=Object.prototype.hasOwnProperty,bc=Object.prototype.propertyIsEnumerable;var Cu=(Ie,me,Z)=>me in Ie?vc(Ie,me,{enumerable:!0,configurable:!0,writable:!0,value:Z}):Ie[me]=Z,Ks=(Ie,me)=>{for(var Z in me||(me={}))mc.call(me,Z)&&Cu(Ie,Z,me[Z]);if(Ku)for(var Z of Ku(me))bc.call(me,Z)&&Cu(Ie,Z,me[Z]);return Ie};var Bt=(Ie,me,Z)=>(Cu(Ie,typeof me!="symbol"?me+"":me,Z),Z);const _c=function(){const me=document.createElement("link").relList;if(me&&me.supports&&me.supports("modulepreload"))return;for(const H of document.querySelectorAll('link[rel="modulepreload"]'))pe(H);new MutationObserver(H=>{for(const Ae of H)if(Ae.type==="childList")for(const Te of Ae.addedNodes)Te.tagName==="LINK"&&Te.rel==="modulepreload"&&pe(Te)}).observe(document,{childList:!0,subtree:!0});function Z(H){const Ae={};return H.integrity&&(Ae.integrity=H.integrity),H.referrerpolicy&&(Ae.referrerPolicy=H.referrerpolicy),H.crossorigin==="use-credentials"?Ae.credentials="include":H.crossorigin==="anonymous"?Ae.credentials="omit":Ae.credentials="same-origin",Ae}function pe(H){if(H.ep)return;H.ep=!0;const Ae=Z(H);fetch(H.href,Ae)}};_c();var ku=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},qu={exports:{}};(function(Ie,me){(function(Z,pe){Ie.exports=pe()})(ku,function(){return Z.importState=function(H){var Ae=new Z;return Ae.importState(H),Ae},Z;function Z(){return function(H){var Ae=0,Te=0,Se=0,Qe=1;H.length==0&&(H=[+new Date]);var Xe=pe();Ae=Xe(" "),Te=Xe(" "),Se=Xe(" ");for(var Mt=0;Mt<H.length;Mt++)Ae-=Xe(H[Mt]),Ae<0&&(Ae+=1),Te-=Xe(H[Mt]),Te<0&&(Te+=1),Se-=Xe(H[Mt]),Se<0&&(Se+=1);Xe=null;var Ve=function(){var Pt=2091639*Ae+Qe*23283064365386963e-26;return Ae=Te,Te=Se,Se=Pt-(Qe=Pt|0)};return Ve.next=Ve,Ve.uint32=function(){return Ve()*4294967296},Ve.fract53=function(){return Ve()+(Ve()*2097152|0)*11102230246251565e-32},Ve.version="Alea 0.9",Ve.args=H,Ve.exportState=function(){return[Ae,Te,Se,Qe]},Ve.importState=function(Pt){Ae=+Pt[0]||0,Te=+Pt[1]||0,Se=+Pt[2]||0,Qe=+Pt[3]||0},Ve}(Array.prototype.slice.call(arguments))}function pe(){var H=4022871197,Ae=function(Te){Te=Te.toString();for(var Se=0;Se<Te.length;Se++){H+=Te.charCodeAt(Se);var Qe=.02519603282416938*H;H=Qe>>>0,Qe-=H,Qe*=H,H=Qe>>>0,Qe-=H,H+=Qe*4294967296}return(H>>>0)*23283064365386963e-26};return Ae.version="Mash 0.9",Ae}})})(qu);var Wu=qu.exports,Tu={exports:{}};/*! Tweakpane 3.1.0 (c) 2016 cocopon, licensed under the MIT license. */(function(Ie,me){(function(Z,pe){pe(me)})(ku,function(Z){class pe{constructor(e){const[t,n]=e.split("-"),a=t.split(".");this.major=parseInt(a[0],10),this.minor=parseInt(a[1],10),this.patch=parseInt(a[2],10),this.prerelease=n!=null?n:null}toString(){const e=[this.major,this.minor,this.patch].join(".");return this.prerelease!==null?[e,this.prerelease].join("-"):e}}class H{constructor(e){this.controller_=e}get element(){return this.controller_.view.element}get disabled(){return this.controller_.viewProps.get("disabled")}set disabled(e){this.controller_.viewProps.set("disabled",e)}get hidden(){return this.controller_.viewProps.get("hidden")}set hidden(e){this.controller_.viewProps.set("hidden",e)}dispose(){this.controller_.viewProps.set("disposed",!0)}}class Ae{constructor(e){this.target=e}}class Te extends Ae{constructor(e,t,n,a){super(e),this.value=t,this.presetKey=n,this.last=a!=null?a:!0}}class Se extends Ae{constructor(e,t,n){super(e),this.value=t,this.presetKey=n}}class Qe extends Ae{constructor(e,t){super(e),this.expanded=t}}class Xe extends Ae{constructor(e,t){super(e),this.index=t}}function Mt(r){return r}function Ve(r){return r==null}function Pt(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}const Gi={alreadydisposed:()=>"View has been already disposed",invalidparams:r=>`Invalid parameters for '${r.name}'`,nomatchingcontroller:r=>`No matching controller for '${r.key}'`,nomatchingview:r=>`No matching view for '${JSON.stringify(r.params)}'`,notbindable:()=>"Value is not bindable",propertynotfound:r=>`Property '${r.name}' not found`,shouldneverhappen:()=>"This error should never happen"};class De{constructor(e){var t;this.message=(t=Gi[e.type](e.context))!==null&&t!==void 0?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}static alreadyDisposed(){return new De({type:"alreadydisposed"})}static notBindable(){return new De({type:"notbindable"})}static propertyNotFound(e){return new De({type:"propertynotfound",context:{name:e}})}static shouldNeverHappen(){return new De({type:"shouldneverhappen"})}}class xt{constructor(e,t,n){this.obj_=e,this.key_=t,this.presetKey_=n!=null?n:t}static isBindable(e){return!(e===null||typeof e!="object")}get key(){return this.key_}get presetKey(){return this.presetKey_}read(){return this.obj_[this.key_]}write(e){this.obj_[this.key_]=e}writeProperty(e,t){const n=this.read();if(!xt.isBindable(n))throw De.notBindable();if(!(e in n))throw De.propertyNotFound(e);n[e]=t}}class zr extends H{get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get title(){var e;return(e=this.controller_.valueController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.valueController.props.set("title",e)}on(e,t){const n=t.bind(this);return this.controller_.valueController.emitter.on(e,()=>{n(new Ae(this))}),this}}class Ye{constructor(){this.observers_={}}on(e,t){let n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this}off(e,t){const n=this.observers_[e];return n&&(this.observers_[e]=n.filter(a=>a.handler!==t)),this}emit(e,t){const n=this.observers_[e];!n||n.forEach(a=>{a.handler(t)})}}const Ui="tp";function Ge(r){return(t,n)=>[Ui,"-",r,"v",t?`_${t}`:"",n?`-${n}`:""].join("")}function $a(r,e){return t=>e(r(t))}function xr(r){return r.rawValue}function Er(r,e){r.emitter.on("change",$a(xr,e)),e(r.rawValue)}function Et(r,e,t){Er(r.value(e),t)}function Ws(r,e,t){t?r.classList.add(e):r.classList.remove(e)}function jr(r,e){return t=>{Ws(r,e,t)}}function zi(r,e){Er(r,t=>{e.textContent=t!=null?t:""})}const ji=Ge("btn");class Ka{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ji()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("button");n.classList.add(ji("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const a=e.createElement("div");a.classList.add(ji("t")),zi(t.props.value("title"),a),this.buttonElement.appendChild(a)}}class Xa{constructor(e,t){this.emitter=new Ye,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Ka(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class ni{constructor(e,t){var n;this.constraint_=t==null?void 0:t.constraint,this.equals_=(n=t==null?void 0:t.equals)!==null&&n!==void 0?n:(a,m)=>a===m,this.emitter=new Ye,this.rawValue_=e}get constraint(){return this.constraint_}get rawValue(){return this.rawValue_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t!=null?t:{forceEmit:!1,last:!0},a=this.constraint_?this.constraint_.constrain(e):e;!!this.equals_(this.rawValue_,a)&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.rawValue_=a,this.emitter.emit("change",{options:n,rawValue:a,sender:this}))}}class Ys{constructor(e){this.emitter=new Ye,this.value_=e}get rawValue(){return this.value_}set rawValue(e){this.setRawValue(e,{forceEmit:!1,last:!0})}setRawValue(e,t){const n=t!=null?t:{forceEmit:!1,last:!0};this.value_===e&&!n.forceEmit||(this.emitter.emit("beforechange",{sender:this}),this.value_=e,this.emitter.emit("change",{options:n,rawValue:this.value_,sender:this}))}}function mt(r,e){const t=e==null?void 0:e.constraint,n=e==null?void 0:e.equals;return!t&&!n?new Ys(r):new ni(r,e)}class Ne{constructor(e){this.emitter=new Ye,this.valMap_=e;for(const t in this.valMap_)this.valMap_[t].emitter.on("change",()=>{this.emitter.emit("change",{key:t,sender:this})})}static createCore(e){return Object.keys(e).reduce((n,a)=>Object.assign(n,{[a]:mt(e[a])}),{})}static fromObject(e){const t=this.createCore(e);return new Ne(t)}get(e){return this.valMap_[e].rawValue}set(e,t){this.valMap_[e].rawValue=t}value(e){return this.valMap_[e]}}function Qs(r,e){const n=Object.keys(e).reduce((a,m)=>{if(a===void 0)return;const te=e[m](r[m]);return te.succeeded?Object.assign(Object.assign({},a),{[m]:te.value}):void 0},{});return n}function Zs(r,e){return r.reduce((t,n)=>{if(t===void 0)return;const a=e(n);if(!(!a.succeeded||a.value===void 0))return[...t,a.value]},[])}function ii(r){return r===null?!1:typeof r=="object"}function It(r){return e=>t=>{if(!e&&t===void 0)return{succeeded:!1,value:void 0};if(e&&t===void 0)return{succeeded:!0,value:void 0};const n=r(t);return n!==void 0?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function qa(r){return{custom:e=>It(e)(r),boolean:It(e=>typeof e=="boolean"?e:void 0)(r),number:It(e=>typeof e=="number"?e:void 0)(r),string:It(e=>typeof e=="string"?e:void 0)(r),function:It(e=>typeof e=="function"?e:void 0)(r),constant:e=>It(t=>t===e?e:void 0)(r),raw:It(e=>e)(r),object:e=>It(t=>{if(!!ii(t))return Qs(t,e)})(r),array:e=>It(t=>{if(!!Array.isArray(t))return Zs(t,e)})(r)}}const Ze={optional:qa(!0),required:qa(!1)};function ht(r,e){const t=Ze.required.object(e)(r);return t.succeeded?t.value:void 0}function Js(r){return r&&r.parentElement&&r.parentElement.removeChild(r),null}function el(){return["veryfirst","first","last","verylast"]}const Wa=Ge(""),Ya={veryfirst:"vfst",first:"fst",last:"lst",verylast:"vlst"};class xn{constructor(e){this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;const t=this.view.element;this.blade.value("positions").emitter.on("change",()=>{el().forEach(n=>{t.classList.remove(Wa(void 0,Ya[n]))}),this.blade.get("positions").forEach(n=>{t.classList.add(Wa(void 0,Ya[n]))})}),this.viewProps.handleDispose(()=>{Js(t)})}get parent(){return this.parent_}}const Gt="http://www.w3.org/2000/svg";function ai(r){r.offsetHeight}function Qa(r,e){const t=r.style.transition;r.style.transition="none",e(),r.style.transition=t}function oi(r){return r.ontouchstart!==void 0}function Za(){return new Function("return this")()}function Ja(){return Za().document}function eo(r){const e=r.ownerDocument.defaultView;return e&&"document"in e?r.getContext("2d"):null}const tl={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function bt(r,e){const t=r.createElementNS(Gt,"svg");return t.innerHTML=tl[e],t}function Hi(r,e,t){r.insertBefore(e,r.children[t])}function En(r){r.parentElement&&r.parentElement.removeChild(r)}function to(r){for(;r.children.length>0;)r.removeChild(r.children[0])}function rl(r){for(;r.childNodes.length>0;)r.removeChild(r.childNodes[0])}function l(r){return r.relatedTarget?r.relatedTarget:"explicitOriginalTarget"in r?r.explicitOriginalTarget:null}const Cn=Ge("lbl");function nl(r,e){const t=r.createDocumentFragment();return e.split(`
`).map(a=>r.createTextNode(a)).forEach((a,m)=>{m>0&&t.appendChild(r.createElement("br")),t.appendChild(a)}),t}class ro{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Cn()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Cn("l")),Et(t.props,"label",m=>{Ve(m)?this.element.classList.add(Cn(void 0,"nol")):(this.element.classList.remove(Cn(void 0,"nol")),rl(n),n.appendChild(nl(e,m)))}),this.element.appendChild(n),this.labelElement=n;const a=e.createElement("div");a.classList.add(Cn("v")),this.element.appendChild(a),this.valueElement=a}}class si extends xn{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{view:new ro(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}const Cr={id:"button",type:"blade",accept(r){const e=Ze,t=ht(r,{title:e.required.string,view:e.required.constant("button"),label:e.optional.string});return t?{params:t}:null},controller(r){return new si(r.document,{blade:r.blade,props:Ne.fromObject({label:r.params.label}),valueController:new Xa(r.document,{props:Ne.fromObject({title:r.params.title}),viewProps:r.viewProps})})},api(r){return!(r.controller instanceof si)||!(r.controller.valueController instanceof Xa)?null:new zr(r.controller)}};class Ar extends xn{constructor(e){super(e),this.value=e.value}}function qt(){return new Ne({positions:mt([],{equals:Pt})})}class Hr extends Ne{constructor(e){super(e)}static create(e){const t={completed:!0,expanded:e,expandedHeight:null,shouldFixHeight:!1,temporaryExpanded:null},n=Ne.createCore(t);return new Hr(n)}get styleExpanded(){var e;return(e=this.get("temporaryExpanded"))!==null&&e!==void 0?e:this.get("expanded")}get styleHeight(){if(!this.styleExpanded)return"0";const e=this.get("expandedHeight");return this.get("shouldFixHeight")&&!Ve(e)?`${e}px`:"auto"}bindExpandedClass(e,t){const n=()=>{this.styleExpanded?e.classList.add(t):e.classList.remove(t)};Et(this,"expanded",n),Et(this,"temporaryExpanded",n)}cleanUpTransition(){this.set("shouldFixHeight",!1),this.set("expandedHeight",null),this.set("completed",!0)}}function il(r,e){let t=0;return Qa(e,()=>{r.set("expandedHeight",null),r.set("temporaryExpanded",!0),ai(e),t=e.clientHeight,r.set("temporaryExpanded",null),ai(e)}),t}function no(r,e){e.style.height=r.styleHeight}function li(r,e){r.value("expanded").emitter.on("beforechange",()=>{r.set("completed",!1),Ve(r.get("expandedHeight"))&&r.set("expandedHeight",il(r,e)),r.set("shouldFixHeight",!0),ai(e)}),r.emitter.on("change",()=>{no(r,e)}),no(r,e),e.addEventListener("transitionend",t=>{t.propertyName==="height"&&r.cleanUpTransition()})}class Ct extends H{constructor(e,t){super(e),this.rackApi_=t}}function $i(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"button"}))}function io(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"folder"}))}function al(r,e){const t=e!=null?e:{};return r.addBlade(Object.assign(Object.assign({},t),{view:"separator"}))}function ol(r,e){return r.addBlade(Object.assign(Object.assign({},e),{view:"tab"}))}class Ki{constructor(e){this.emitter=new Ye,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}get items(){return this.items_}allItems(){return Array.from(this.cache_)}find(e){for(const t of this.allItems())if(e(t))return t;return null}includes(e){return this.cache_.has(e)}add(e,t){if(this.includes(e))throw De.shouldNeverHappen();const n=t!==void 0?t:this.items_.length;this.items_.splice(n,0,e),this.cache_.add(e);const a=this.extract_(e);a&&(a.emitter.on("add",this.onSubListAdd_),a.emitter.on("remove",this.onSubListRemove_),a.allItems().forEach(m=>{this.cache_.add(m)})),this.emitter.emit("add",{index:n,item:e,root:this,target:this})}remove(e){const t=this.items_.indexOf(e);if(t<0)return;this.items_.splice(t,1),this.cache_.delete(e);const n=this.extract_(e);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{index:t,item:e,root:this,target:this})}onSubListAdd_(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})}onSubListRemove_(e){this.cache_.delete(e.item),this.emitter.emit("remove",{index:e.index,item:e.item,root:this,target:e.target})}}class Xi extends H{constructor(e){super(e),this.onBindingChange_=this.onBindingChange_.bind(this),this.emitter_=new Ye,this.controller_.binding.emitter.on("change",this.onBindingChange_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}refresh(){this.controller_.binding.read()}onBindingChange_(e){const t=e.sender.target.read();this.emitter_.emit("change",{event:new Te(this,t,this.controller_.binding.target.presetKey,e.options.last)})}}class Ut extends si{constructor(e,t){super(e,t),this.binding=t.binding}}class ui extends H{constructor(e){super(e),this.onBindingUpdate_=this.onBindingUpdate_.bind(this),this.emitter_=new Ye,this.controller_.binding.emitter.on("update",this.onBindingUpdate_)}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}refresh(){this.controller_.binding.read()}onBindingUpdate_(e){const t=e.sender.target.read();this.emitter_.emit("update",{event:new Se(this,t,this.controller_.binding.target.presetKey)})}}class Wt extends si{constructor(e,t){super(e,t),this.binding=t.binding,this.viewProps.bindDisabled(this.binding.ticker),this.viewProps.handleDispose(()=>{this.binding.dispose()})}}function sl(r){return r instanceof ci?r.apiSet_:r instanceof Ct?r.rackApi_.apiSet_:null}function An(r,e){const t=r.find(n=>n.controller_===e);if(!t)throw De.shouldNeverHappen();return t}function At(r,e,t){if(!xt.isBindable(r))throw De.notBindable();return new xt(r,e,t)}class ci extends H{constructor(e,t){super(e),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this),this.onRackInputChange_=this.onRackInputChange_.bind(this),this.onRackMonitorUpdate_=this.onRackMonitorUpdate_.bind(this),this.emitter_=new Ye,this.apiSet_=new Ki(sl),this.pool_=t;const n=this.controller_.rack;n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),n.emitter.on("inputchange",this.onRackInputChange_),n.emitter.on("monitorupdate",this.onRackMonitorUpdate_),n.children.forEach(a=>{this.setUpApi_(a)})}get children(){return this.controller_.rack.children.map(e=>An(this.apiSet_,e))}addInput(e,t,n){const a=n!=null?n:{},m=this.controller_.view.element.ownerDocument,P=this.pool_.createInput(m,At(e,t,a.presetKey),a),te=new Xi(P);return this.add(te,a.index)}addMonitor(e,t,n){const a=n!=null?n:{},m=this.controller_.view.element.ownerDocument,P=this.pool_.createMonitor(m,At(e,t),a),te=new ui(P);return this.add(te,a.index)}addFolder(e){return io(this,e)}addButton(e){return $i(this,e)}addSeparator(e){return al(this,e)}addTab(e){return ol(this,e)}add(e,t){this.controller_.rack.add(e.controller_,t);const n=this.apiSet_.find(a=>a.controller_===e.controller_);return n&&this.apiSet_.remove(n),this.apiSet_.add(e),e}remove(e){this.controller_.rack.remove(e.controller_)}addBlade(e){const t=this.controller_.view.element.ownerDocument,n=this.pool_.createBlade(t,e),a=this.pool_.createBladeApi(n);return this.add(a,e.index)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}setUpApi_(e){this.apiSet_.find(n=>n.controller_===e)||this.apiSet_.add(this.pool_.createBladeApi(e))}onRackAdd_(e){this.setUpApi_(e.bladeController)}onRackRemove_(e){if(e.isRoot){const t=An(this.apiSet_,e.bladeController);this.apiSet_.remove(t)}}onRackInputChange_(e){const t=e.bladeController;if(t instanceof Ut){const n=An(this.apiSet_,t),a=t.binding;this.emitter_.emit("change",{event:new Te(n,a.target.read(),a.target.presetKey,e.options.last)})}else if(t instanceof Ar){const n=An(this.apiSet_,t);this.emitter_.emit("change",{event:new Te(n,t.value.rawValue,void 0,e.options.last)})}}onRackMonitorUpdate_(e){if(!(e.bladeController instanceof Wt))throw De.shouldNeverHappen();const t=An(this.apiSet_,e.bladeController),n=e.bladeController.binding;this.emitter_.emit("update",{event:new Se(t,n.target.read(),n.target.presetKey)})}}class qi extends Ct{constructor(e,t){super(e,new ci(e.rackController,t)),this.emitter_=new Ye,this.controller_.foldable.value("expanded").emitter.on("change",n=>{this.emitter_.emit("fold",{event:new Qe(this,n.sender.rawValue)})}),this.rackApi_.on("change",n=>{this.emitter_.emit("change",{event:n})}),this.rackApi_.on("update",n=>{this.emitter_.emit("update",{event:n})})}get expanded(){return this.controller_.foldable.get("expanded")}set expanded(e){this.controller_.foldable.set("expanded",e)}get title(){return this.controller_.props.get("title")}set title(e){this.controller_.props.set("title",e)}get children(){return this.rackApi_.children}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addFolder(e){return this.rackApi_.addFolder(e)}addButton(e){return this.rackApi_.addButton(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){return this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addBlade(e){return this.rackApi_.addBlade(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}}class Wi extends xn{constructor(e){super({blade:e.blade,view:e.view,viewProps:e.rackController.viewProps}),this.rackController=e.rackController}}class ll{constructor(e,t){const n=Ge(t.viewName);this.element=e.createElement("div"),this.element.classList.add(n()),t.viewProps.bindClassModifiers(this.element)}}function ul(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(n instanceof Ut&&n.binding===e)return n}return null}function cl(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(n instanceof Wt&&n.binding===e)return n}return null}function dl(r,e){for(let t=0;t<r.length;t++){const n=r[t];if(n instanceof Ar&&n.value===e)return n}return null}function Yi(r){return r instanceof qe?r.rack:r instanceof Wi?r.rackController.rack:null}function ao(r){const e=Yi(r);return e?e.bcSet_:null}class oo{constructor(e){var t;this.onBladePositionsChange_=this.onBladePositionsChange_.bind(this),this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildPositionsChange_=this.onChildPositionsChange_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildValueChange_=this.onChildValueChange_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendantMonitorUpdate_=this.onDescendantMonitorUpdate_.bind(this),this.emitter=new Ye,this.blade_=e!=null?e:null,(t=this.blade_)===null||t===void 0||t.value("positions").emitter.on("change",this.onBladePositionsChange_),this.bcSet_=new Ki(ao),this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}get children(){return this.bcSet_.items}add(e,t){e.parent&&e.parent.remove(e),e.parent_=this,this.bcSet_.add(e,t)}remove(e){e.parent_=null,this.bcSet_.remove(e)}find(e){return this.bcSet_.allItems().filter(t=>t instanceof e)}onSetAdd_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),!t)return;const n=e.item;if(n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.value("positions").emitter.on("change",this.onChildPositionsChange_),n.viewProps.handleDispose(this.onChildDispose_),n instanceof Ut)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof Wt)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof Ar)n.value.emitter.on("change",this.onChildValueChange_);else{const a=Yi(n);if(a){const m=a.emitter;m.on("layout",this.onDescendantLayout_),m.on("inputchange",this.onDescendantInputChange_),m.on("monitorupdate",this.onDescendantMonitorUpdate_)}}}onSetRemove_(e){this.updatePositions_();const t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),!t)return;const n=e.item;if(n instanceof Ut)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof Wt)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof Ar)n.value.emitter.off("change",this.onChildValueChange_);else{const a=Yi(n);if(a){const m=a.emitter;m.off("layout",this.onDescendantLayout_),m.off("inputchange",this.onDescendantInputChange_),m.off("monitorupdate",this.onDescendantMonitorUpdate_)}}}updatePositions_(){const e=this.bcSet_.items.filter(a=>!a.viewProps.get("hidden")),t=e[0],n=e[e.length-1];this.bcSet_.items.forEach(a=>{const m=[];a===t&&(m.push("first"),(!this.blade_||this.blade_.get("positions").includes("veryfirst"))&&m.push("veryfirst")),a===n&&(m.push("last"),(!this.blade_||this.blade_.get("positions").includes("verylast"))&&m.push("verylast")),a.blade.set("positions",m)})}onChildPositionsChange_(){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildViewPropsChange_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onChildDispose_(){this.bcSet_.items.filter(t=>t.viewProps.get("disposed")).forEach(t=>{this.bcSet_.remove(t)})}onChildInputChange_(e){const t=ul(this.find(Ut),e.sender);if(!t)throw De.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onChildMonitorUpdate_(e){const t=cl(this.find(Wt),e.sender);if(!t)throw De.shouldNeverHappen();this.emitter.emit("monitorupdate",{bladeController:t,sender:this})}onChildValueChange_(e){const t=dl(this.find(Ar),e.sender);if(!t)throw De.shouldNeverHappen();this.emitter.emit("inputchange",{bladeController:t,options:e.options,sender:this})}onDescendantLayout_(e){this.updatePositions_(),this.emitter.emit("layout",{sender:this})}onDescendantInputChange_(e){this.emitter.emit("inputchange",{bladeController:e.bladeController,options:e.options,sender:this})}onDescendantMonitorUpdate_(e){this.emitter.emit("monitorupdate",{bladeController:e.bladeController,sender:this})}onBladePositionsChange_(){this.updatePositions_()}}class qe extends xn{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new ll(e,{viewName:"brk",viewProps:t.viewProps})})),this.onRackAdd_=this.onRackAdd_.bind(this),this.onRackRemove_=this.onRackRemove_.bind(this);const n=new oo(t.root?void 0:t.blade);n.emitter.on("add",this.onRackAdd_),n.emitter.on("remove",this.onRackRemove_),this.rack=n,this.viewProps.handleDispose(()=>{for(let a=this.rack.children.length-1;a>=0;a--)this.rack.children[a].viewProps.set("disposed",!0)})}onRackAdd_(e){!e.isRoot||Hi(this.view.element,e.bladeController.view.element,e.index)}onRackRemove_(e){!e.isRoot||En(e.bladeController.view.element)}}const so=Ge("cnt");class fl{constructor(e,t){var n;this.className_=Ge((n=t.viewName)!==null&&n!==void 0?n:"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_(),so()),t.viewProps.bindClassModifiers(this.element),this.foldable_=t.foldable,this.foldable_.bindExpandedClass(this.element,this.className_(void 0,"expanded")),Et(this.foldable_,"completed",jr(this.element,this.className_(void 0,"cpl")));const a=e.createElement("button");a.classList.add(this.className_("b")),Et(t.props,"title",xe=>{Ve(xe)?this.element.classList.add(this.className_(void 0,"not")):this.element.classList.remove(this.className_(void 0,"not"))}),t.viewProps.bindDisabled(a),this.element.appendChild(a),this.buttonElement=a;const m=e.createElement("div");m.classList.add(this.className_("t")),zi(t.props.value("title"),m),this.buttonElement.appendChild(m),this.titleElement=m;const P=e.createElement("div");P.classList.add(this.className_("m")),this.buttonElement.appendChild(P);const te=t.containerElement;te.classList.add(this.className_("c")),this.element.appendChild(te),this.containerElement=te}}class Qi extends Wi{constructor(e,t){var n;const a=Hr.create((n=t.expanded)!==null&&n!==void 0?n:!0),m=new qe(e,{blade:t.blade,root:t.root,viewProps:t.viewProps});super(Object.assign(Object.assign({},t),{rackController:m,view:new fl(e,{containerElement:m.view.element,foldable:a,props:t.props,viewName:t.root?"rot":void 0,viewProps:t.viewProps})})),this.onTitleClick_=this.onTitleClick_.bind(this),this.props=t.props,this.foldable=a,li(this.foldable,this.view.containerElement),this.rackController.rack.emitter.on("add",()=>{this.foldable.cleanUpTransition()}),this.rackController.rack.emitter.on("remove",()=>{this.foldable.cleanUpTransition()}),this.view.buttonElement.addEventListener("click",this.onTitleClick_)}get document(){return this.view.element.ownerDocument}onTitleClick_(){this.foldable.set("expanded",!this.foldable.get("expanded"))}}const pl={id:"folder",type:"blade",accept(r){const e=Ze,t=ht(r,{title:e.required.string,view:e.required.constant("folder"),expanded:e.optional.boolean});return t?{params:t}:null},controller(r){return new Qi(r.document,{blade:r.blade,expanded:r.params.expanded,props:Ne.fromObject({title:r.params.title}),viewProps:r.viewProps})},api(r){return r.controller instanceof Qi?new qi(r.controller,r.pool):null}};class $r extends Ar{constructor(e,t){const n=t.valueController.viewProps;super(Object.assign(Object.assign({},t),{value:t.valueController.value,view:new ro(e,{props:t.props,viewProps:n}),viewProps:n})),this.props=t.props,this.valueController=t.valueController,this.view.valueElement.appendChild(this.valueController.view.element)}}class lo extends H{}const uo=Ge("spr");class hl{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(uo()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("hr");n.classList.add(uo("r")),this.element.appendChild(n)}}class co extends xn{constructor(e,t){super(Object.assign(Object.assign({},t),{view:new hl(e,{viewProps:t.viewProps})}))}}const vl={id:"separator",type:"blade",accept(r){const t=ht(r,{view:Ze.required.constant("separator")});return t?{params:t}:null},controller(r){return new co(r.document,{blade:r.blade,viewProps:r.viewProps})},api(r){return r.controller instanceof co?new lo(r.controller):null}},ml=Ge("");function fo(r,e){return jr(r,ml(void 0,e))}class ir extends Ne{constructor(e){super(e)}static create(e){var t,n;const a=e!=null?e:{},m={disabled:(t=a.disabled)!==null&&t!==void 0?t:!1,disposed:!1,hidden:(n=a.hidden)!==null&&n!==void 0?n:!1},P=Ne.createCore(m);return new ir(P)}bindClassModifiers(e){Et(this,"disabled",fo(e,"disabled")),Et(this,"hidden",fo(e,"hidden"))}bindDisabled(e){Et(this,"disabled",t=>{e.disabled=t})}bindTabIndex(e){Et(this,"disabled",t=>{e.tabIndex=t?-1:0})}handleDispose(e){this.value("disposed").emitter.on("change",t=>{t&&e()})}}const Sn=Ge("tbi");class bl{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Sn()),t.viewProps.bindClassModifiers(this.element),Et(t.props,"selected",m=>{m?this.element.classList.add(Sn(void 0,"sel")):this.element.classList.remove(Sn(void 0,"sel"))});const n=e.createElement("button");n.classList.add(Sn("b")),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.buttonElement=n;const a=e.createElement("div");a.classList.add(Sn("t")),zi(t.props.value("title"),a),this.buttonElement.appendChild(a),this.titleElement=a}}class _l{constructor(e,t){this.emitter=new Ye,this.onClick_=this.onClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new bl(e,{props:t.props,viewProps:t.viewProps}),this.view.buttonElement.addEventListener("click",this.onClick_)}onClick_(){this.emitter.emit("click",{sender:this})}}class po{constructor(e,t){this.onItemClick_=this.onItemClick_.bind(this),this.ic_=new _l(e,{props:t.itemProps,viewProps:ir.create()}),this.ic_.emitter.on("click",this.onItemClick_),this.cc_=new qe(e,{blade:qt(),viewProps:ir.create()}),this.props=t.props,Et(this.props,"selected",n=>{this.itemController.props.set("selected",n),this.contentController.viewProps.set("hidden",!n)})}get itemController(){return this.ic_}get contentController(){return this.cc_}onItemClick_(){this.props.set("selected",!0)}}class ho{constructor(e,t){this.controller_=e,this.rackApi_=t}get title(){var e;return(e=this.controller_.itemController.props.get("title"))!==null&&e!==void 0?e:""}set title(e){this.controller_.itemController.props.set("title",e)}get selected(){return this.controller_.props.get("selected")}set selected(e){this.controller_.props.set("selected",e)}get children(){return this.rackApi_.children}addButton(e){return this.rackApi_.addButton(e)}addFolder(e){return this.rackApi_.addFolder(e)}addSeparator(e){return this.rackApi_.addSeparator(e)}addTab(e){return this.rackApi_.addTab(e)}add(e,t){this.rackApi_.add(e,t)}remove(e){this.rackApi_.remove(e)}addInput(e,t,n){return this.rackApi_.addInput(e,t,n)}addMonitor(e,t,n){return this.rackApi_.addMonitor(e,t,n)}addBlade(e){return this.rackApi_.addBlade(e)}}class vo extends Ct{constructor(e,t){super(e,new ci(e.rackController,t)),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.onSelect_=this.onSelect_.bind(this),this.emitter_=new Ye,this.pageApiMap_=new Map,this.rackApi_.on("change",n=>{this.emitter_.emit("change",{event:n})}),this.rackApi_.on("update",n=>{this.emitter_.emit("update",{event:n})}),this.controller_.tab.selectedIndex.emitter.on("change",this.onSelect_),this.controller_.pageSet.emitter.on("add",this.onPageAdd_),this.controller_.pageSet.emitter.on("remove",this.onPageRemove_),this.controller_.pageSet.items.forEach(n=>{this.setUpPageApi_(n)})}get pages(){return this.controller_.pageSet.items.map(e=>{const t=this.pageApiMap_.get(e);if(!t)throw De.shouldNeverHappen();return t})}addPage(e){const t=this.controller_.view.element.ownerDocument,n=new po(t,{itemProps:Ne.fromObject({selected:!1,title:e.title}),props:Ne.fromObject({selected:!1})});this.controller_.add(n,e.index);const a=this.pageApiMap_.get(n);if(!a)throw De.shouldNeverHappen();return a}removePage(e){this.controller_.remove(e)}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}setUpPageApi_(e){const t=this.rackApi_.apiSet_.find(a=>a.controller_===e.contentController);if(!t)throw De.shouldNeverHappen();const n=new ho(e,t);this.pageApiMap_.set(e,n)}onPageAdd_(e){this.setUpPageApi_(e.item)}onPageRemove_(e){if(!this.pageApiMap_.get(e.item))throw De.shouldNeverHappen();this.pageApiMap_.delete(e.item)}onSelect_(e){this.emitter_.emit("select",{event:new Xe(this,e.rawValue)})}}const mo=-1;class gl{constructor(){this.onItemSelectedChange_=this.onItemSelectedChange_.bind(this),this.empty=mt(!0),this.selectedIndex=mt(mo),this.items_=[]}add(e,t){const n=t!=null?t:this.items_.length;this.items_.splice(n,0,e),e.emitter.on("change",this.onItemSelectedChange_),this.keepSelection_()}remove(e){const t=this.items_.indexOf(e);t<0||(this.items_.splice(t,1),e.emitter.off("change",this.onItemSelectedChange_),this.keepSelection_())}keepSelection_(){if(this.items_.length===0){this.selectedIndex.rawValue=mo,this.empty.rawValue=!0;return}const e=this.items_.findIndex(t=>t.rawValue);e<0?(this.items_.forEach((t,n)=>{t.rawValue=n===0}),this.selectedIndex.rawValue=0):(this.items_.forEach((t,n)=>{t.rawValue=n===e}),this.selectedIndex.rawValue=e),this.empty.rawValue=!1}onItemSelectedChange_(e){if(e.rawValue){const t=this.items_.findIndex(n=>n===e.sender);this.items_.forEach((n,a)=>{n.rawValue=a===t}),this.selectedIndex.rawValue=t}else this.keepSelection_()}}const di=Ge("tab");class wl{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(di(),so()),t.viewProps.bindClassModifiers(this.element),Er(t.empty,jr(this.element,di(void 0,"nop")));const n=e.createElement("div");n.classList.add(di("i")),this.element.appendChild(n),this.itemsElement=n;const a=t.contentsElement;a.classList.add(di("c")),this.element.appendChild(a),this.contentsElement=a}}class bo extends Wi{constructor(e,t){const n=new qe(e,{blade:t.blade,viewProps:t.viewProps}),a=new gl;super({blade:t.blade,rackController:n,view:new wl(e,{contentsElement:n.view.element,empty:a.empty,viewProps:t.viewProps})}),this.onPageAdd_=this.onPageAdd_.bind(this),this.onPageRemove_=this.onPageRemove_.bind(this),this.pageSet_=new Ki(()=>null),this.pageSet_.emitter.on("add",this.onPageAdd_),this.pageSet_.emitter.on("remove",this.onPageRemove_),this.tab=a}get pageSet(){return this.pageSet_}add(e,t){this.pageSet_.add(e,t)}remove(e){this.pageSet_.remove(this.pageSet_.items[e])}onPageAdd_(e){const t=e.item;Hi(this.view.itemsElement,t.itemController.view.element,e.index),this.rackController.rack.add(t.contentController,e.index),this.tab.add(t.props.value("selected"))}onPageRemove_(e){const t=e.item;En(t.itemController.view.element),this.rackController.rack.remove(t.contentController),this.tab.remove(t.props.value("selected"))}}const _o={id:"tab",type:"blade",accept(r){const e=Ze,t=ht(r,{pages:e.required.array(e.required.object({title:e.required.string})),view:e.required.constant("tab")});return!t||t.pages.length===0?null:{params:t}},controller(r){const e=new bo(r.document,{blade:r.blade,viewProps:r.viewProps});return r.params.pages.forEach(t=>{const n=new po(r.document,{itemProps:Ne.fromObject({selected:!1,title:t.title}),props:Ne.fromObject({selected:!1})});e.add(n)}),e},api(r){return r.controller instanceof bo?new vo(r.controller,r.pool):null}};function yl(r,e){const t=r.accept(e.params);if(!t)return null;const n=Ze.optional.boolean(e.params.disabled).value,a=Ze.optional.boolean(e.params.hidden).value;return r.controller({blade:qt(),document:e.document,params:Object.assign(Object.assign({},t.params),{disabled:n,hidden:a}),viewProps:ir.create({disabled:n,hidden:a})})}class xl{constructor(){this.disabled=!1,this.emitter=new Ye}dispose(){}tick(){this.disabled||this.emitter.emit("tick",{sender:this})}}class fi{constructor(e,t){this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new Ye,this.interval_=t,this.setTimer_()}get disabled(){return this.disabled_}set disabled(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()}dispose(){this.clearTimer_()}clearTimer_(){if(this.timerId_===null)return;const e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}setTimer_(){if(this.clearTimer_(),this.interval_<=0)return;const e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}onTick_(){this.disabled_||this.emitter.emit("tick",{sender:this})}}class Kr{constructor(e){this.constraints=e}constrain(e){return this.constraints.reduce((t,n)=>n.constrain(t),e)}}function zt(r,e){if(r instanceof e)return r;if(r instanceof Kr){const t=r.constraints.reduce((n,a)=>n||(a instanceof e?a:null),null);if(t)return t}return null}class Pn{constructor(e){this.options=e}constrain(e){const t=this.options;return t.length===0||t.filter(a=>a.value===e).length>0?e:t[0].value}}class jt{constructor(e){this.maxValue=e.max,this.minValue=e.min}constrain(e){let t=e;return Ve(this.minValue)||(t=Math.max(t,this.minValue)),Ve(this.maxValue)||(t=Math.min(t,this.maxValue)),t}}class Xr{constructor(e,t=0){this.step=e,this.origin=t}constrain(e){const t=this.origin%this.step,n=Math.round((e-t)/this.step);return t+n*this.step}}const pi=Ge("lst");class Zi{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(pi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("select");n.classList.add(pi("s")),Et(this.props_,"options",m=>{to(n),m.forEach((P,te)=>{const xe=e.createElement("option");xe.dataset.index=String(te),xe.textContent=P.text,xe.value=String(P.value),n.appendChild(xe)})}),t.viewProps.bindDisabled(n),this.element.appendChild(n),this.selectElement=n;const a=e.createElement("div");a.classList.add(pi("m")),a.appendChild(bt(e,"dropdown")),this.element.appendChild(a),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}update_(){this.selectElement.value=String(this.value_.rawValue)}onValueChange_(){this.update_()}}class Tn{constructor(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Zi(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}onSelectChange_(e){const n=e.currentTarget.selectedOptions.item(0);if(!n)return;const a=Number(n.dataset.index);this.value.rawValue=this.props.get("options")[a].value}}const go=Ge("pop");class El{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(go()),t.viewProps.bindClassModifiers(this.element),Er(t.shows,jr(this.element,go(void 0,"v")))}}class wo{constructor(e,t){this.shows=mt(!1),this.viewProps=t.viewProps,this.view=new El(e,{shows:this.shows,viewProps:this.viewProps})}}const Lt=Ge("txt");class Tt{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Lt()),t.viewProps.bindClassModifiers(this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);const n=e.createElement("input");n.classList.add(Lt("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.refresh()}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)}onChange_(){this.refresh()}}class Sr{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Tt(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const n=e.currentTarget.value,a=this.parser_(n);Ve(a)||(this.value.rawValue=a),this.view.refresh()}}function Cl(r){return String(r)}function yo(r){return r==="false"?!1:!!r}function Ji(r){return Cl(r)}class xo{constructor(e){this.text=e}evaluate(){return Number(this.text)}toString(){return this.text}}const Al={"**":(r,e)=>Math.pow(r,e),"*":(r,e)=>r*e,"/":(r,e)=>r/e,"%":(r,e)=>r%e,"+":(r,e)=>r+e,"-":(r,e)=>r-e,"<<":(r,e)=>r<<e,">>":(r,e)=>r>>e,">>>":(r,e)=>r>>>e,"&":(r,e)=>r&e,"^":(r,e)=>r^e,"|":(r,e)=>r|e};class Sl{constructor(e,t,n){this.left=t,this.operator=e,this.right=n}evaluate(){const e=Al[this.operator];if(!e)throw new Error(`unexpected binary operator: '${this.operator}`);return e(this.left.evaluate(),this.right.evaluate())}toString(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")}}const ea={"+":r=>r,"-":r=>-r,"~":r=>~r};class Pl{constructor(e,t){this.operator=e,this.expression=t}evaluate(){const e=ea[this.operator];if(!e)throw new Error(`unexpected unary operator: '${this.operator}`);return e(this.expression.evaluate())}toString(){return["u(",this.operator,this.expression.toString(),")"].join(" ")}}function ta(r){return(e,t)=>{for(let n=0;n<r.length;n++){const a=r[n](e,t);if(a!=="")return a}return""}}function kn(r,e){var t;const n=r.substr(e).match(/^\s+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Tl(r,e){const t=r.substr(e,1);return t.match(/^[1-9]$/)?t:""}function Ln(r,e){var t;const n=r.substr(e).match(/^[0-9]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function kl(r,e){const t=Ln(r,e);if(t!=="")return t;const n=r.substr(e,1);if(e+=1,n!=="-"&&n!=="+")return"";const a=Ln(r,e);return a===""?"":n+a}function ra(r,e){const t=r.substr(e,1);if(e+=1,t.toLowerCase()!=="e")return"";const n=kl(r,e);return n===""?"":t+n}function Eo(r,e){const t=r.substr(e,1);if(t==="0")return t;const n=Tl(r,e);return e+=n.length,n===""?"":n+Ln(r,e)}function Pr(r,e){const t=Eo(r,e);if(e+=t.length,t==="")return"";const n=r.substr(e,1);if(e+=n.length,n!==".")return"";const a=Ln(r,e);return e+=a.length,t+n+a+ra(r,e)}function Ll(r,e){const t=r.substr(e,1);if(e+=t.length,t!==".")return"";const n=Ln(r,e);return e+=n.length,n===""?"":t+n+ra(r,e)}function Rl(r,e){const t=Eo(r,e);return e+=t.length,t===""?"":t+ra(r,e)}const hi=ta([Pr,Ll,Rl]);function na(r,e){var t;const n=r.substr(e).match(/^[01]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Co(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0b")return"";const n=na(r,e);return n===""?"":t+n}function Ao(r,e){var t;const n=r.substr(e).match(/^[0-7]+/);return(t=n&&n[0])!==null&&t!==void 0?t:""}function Ol(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0o")return"";const n=Ao(r,e);return n===""?"":t+n}function ia(r,e){var t;const n=r.substr(e).match(/^[0-9a-f]+/i);return(t=n&&n[0])!==null&&t!==void 0?t:""}function aa(r,e){const t=r.substr(e,2);if(e+=t.length,t.toLowerCase()!=="0x")return"";const n=ia(r,e);return n===""?"":t+n}const ar=ta([Co,Ol,aa]),vi=ta([ar,hi]);function So(r,e){const t=vi(r,e);return e+=t.length,t===""?null:{evaluable:new xo(t),cursor:e}}function Po(r,e){const t=r.substr(e,1);if(e+=t.length,t!=="(")return null;const n=ko(r,e);if(!n)return null;e=n.cursor,e+=kn(r,e).length;const a=r.substr(e,1);return e+=a.length,a!==")"?null:{evaluable:n.evaluable,cursor:e}}function Dl(r,e){var t;return(t=So(r,e))!==null&&t!==void 0?t:Po(r,e)}function To(r,e){const t=Dl(r,e);if(t)return t;const n=r.substr(e,1);if(e+=n.length,n!=="+"&&n!=="-"&&n!=="~")return null;const a=To(r,e);return a?(e=a.cursor,{cursor:e,evaluable:new Pl(n,a.evaluable)}):null}function Fl(r,e,t){t+=kn(e,t).length;const n=r.filter(a=>e.startsWith(a,t))[0];return n?(t+=n.length,t+=kn(e,t).length,{cursor:t,operator:n}):null}function Vl(r,e){return(t,n)=>{const a=r(t,n);if(!a)return null;n=a.cursor;let m=a.evaluable;for(;;){const P=Fl(e,t,n);if(!P)break;n=P.cursor;const te=r(t,n);if(!te)return null;n=te.cursor,m=new Sl(P.operator,m,te.evaluable)}return m?{cursor:n,evaluable:m}:null}}const Nl=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((r,e)=>Vl(r,e),To);function ko(r,e){return e+=kn(r,e).length,Nl(r,e)}function Bl(r){const e=ko(r,0);return!e||e.cursor+kn(r,e.cursor).length!==r.length?null:e.evaluable}function _t(r){var e;const t=Bl(r);return(e=t==null?void 0:t.evaluate())!==null&&e!==void 0?e:null}function Lo(r){if(typeof r=="number")return r;if(typeof r=="string"){const e=_t(r);if(!Ve(e))return e}return 0}function Ml(r){return String(r)}function rt(r){return e=>e.toFixed(Math.max(Math.min(r,20),0))}const Il=rt(0);function Yt(r){return Il(r)+"%"}function oa(r){return String(r)}function or(r){return r}function sa(r,e){for(;r.length<e;)r.push(void 0)}function Tr(r){const e=[];return sa(e,r),mt(e)}function la(r){const e=r.indexOf(void 0);return e<0?r:r.slice(0,e)}function Gl(r,e){const t=[...la(r),e];return t.length>r.length?t.splice(0,t.length-r.length):sa(t,r.length),t}function Rn({primary:r,secondary:e,forward:t,backward:n}){let a=!1;function m(P){a||(a=!0,P(),a=!1)}r.emitter.on("change",P=>{m(()=>{e.setRawValue(t(r,e),P.options)})}),e.emitter.on("change",P=>{m(()=>{r.setRawValue(n(r,e),P.options)}),m(()=>{e.setRawValue(t(r,e),P.options)})}),m(()=>{e.setRawValue(t(r,e),{forceEmit:!1,last:!0})})}function St(r,e){const t=r*(e.altKey?.1:1)*(e.shiftKey?10:1);return e.upKey?+t:e.downKey?-t:0}function qr(r){return{altKey:r.altKey,downKey:r.key==="ArrowDown",shiftKey:r.shiftKey,upKey:r.key==="ArrowUp"}}function Qt(r){return{altKey:r.altKey,downKey:r.key==="ArrowLeft",shiftKey:r.shiftKey,upKey:r.key==="ArrowRight"}}function Ul(r){return r==="ArrowUp"||r==="ArrowDown"}function ua(r){return Ul(r)||r==="ArrowLeft"||r==="ArrowRight"}function Ke(r,e){var t,n;const a=e.ownerDocument.defaultView,m=e.getBoundingClientRect();return{x:r.pageX-(((t=a&&a.scrollX)!==null&&t!==void 0?t:0)+m.left),y:r.pageY-(((n=a&&a.scrollY)!==null&&n!==void 0?n:0)+m.top)}}class sr{constructor(e){this.lastTouch_=null,this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new Ye,e.addEventListener("touchstart",this.onTouchStart_,{passive:!1}),e.addEventListener("touchmove",this.onTouchMove_,{passive:!0}),e.addEventListener("touchend",this.onTouchEnd_),e.addEventListener("mousedown",this.onMouseDown_)}computePosition_(e){const t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}}onMouseDown_(e){var t;e.preventDefault(),(t=e.currentTarget)===null||t===void 0||t.focus();const n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(Ke(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseMove_(e){this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(Ke(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onDocumentMouseUp_(e){const t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(Ke(e,this.elem_)),sender:this,shiftKey:e.shiftKey})}onTouchStart_(e){e.preventDefault();const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchMove_(e){const t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{altKey:e.altKey,data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this,shiftKey:e.shiftKey}),this.lastTouch_=t}onTouchEnd_(e){var t;const n=(t=e.targetTouches.item(0))!==null&&t!==void 0?t:this.lastTouch_,a=this.elem_.getBoundingClientRect();this.emitter.emit("up",{altKey:e.altKey,data:this.computePosition_(n?{x:n.clientX-a.left,y:n.clientY-a.top}:void 0),sender:this,shiftKey:e.shiftKey})}}function Je(r,e,t,n,a){const m=(r-e)/(t-e);return n+m*(a-n)}function Ft(r){return String(r.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function nt(r,e,t){return Math.min(Math.max(r,e),t)}function On(r,e){return(r%e+e)%e}const dt=Ge("txt");class ca{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(dt(),dt(void 0,"num")),t.arrayPosition&&this.element.classList.add(dt(void 0,t.arrayPosition)),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(dt("i")),n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(dt()),this.inputElement.classList.add(dt("i"));const a=e.createElement("div");a.classList.add(dt("k")),this.element.appendChild(a),this.knobElement=a;const m=e.createElementNS(Gt,"svg");m.classList.add(dt("g")),this.knobElement.appendChild(m);const P=e.createElementNS(Gt,"path");P.classList.add(dt("gb")),m.appendChild(P),this.guideBodyElem_=P;const te=e.createElementNS(Gt,"path");te.classList.add(dt("gh")),m.appendChild(te),this.guideHeadElem_=te;const xe=e.createElement("div");xe.classList.add(Ge("tt")()),this.knobElement.appendChild(xe),this.tooltipElem_=xe,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.refresh()}onDraggingChange_(e){if(e.rawValue===null){this.element.classList.remove(dt(void 0,"drg"));return}this.element.classList.add(dt(void 0,"drg"));const t=e.rawValue/this.props_.get("draggingScale"),n=t+(t>0?-1:t<0?1:0),a=nt(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",[`M ${n+a},0 L${n},4 L${n+a},8`,`M ${t},-1 L${t},9`].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d",`M 0,4 L${t},4`);const m=this.props_.get("formatter");this.tooltipElem_.textContent=m(this.value.rawValue),this.tooltipElem_.style.left=`${t}px`}refresh(){const e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)}onChange_(){this.refresh()}}class lr{constructor(e,t){var n;this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onInputKeyUp_=this.onInputKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.sliderProps_=(n=t.sliderProps)!==null&&n!==void 0?n:null,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=mt(null),this.view=new ca(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_),this.view.inputElement.addEventListener("keyup",this.onInputKeyUp_);const a=new sr(this.view.knobElement);a.emitter.on("down",this.onPointerDown_),a.emitter.on("move",this.onPointerMove_),a.emitter.on("up",this.onPointerUp_)}constrainValue_(e){var t,n;const a=(t=this.sliderProps_)===null||t===void 0?void 0:t.get("minValue"),m=(n=this.sliderProps_)===null||n===void 0?void 0:n.get("maxValue");let P=e;return a!==void 0&&(P=Math.max(P,a)),m!==void 0&&(P=Math.min(P,m)),P}onInputChange_(e){const n=e.currentTarget.value,a=this.parser_(n);Ve(a)||(this.value.rawValue=this.constrainValue_(a)),this.view.refresh()}onInputKeyDown_(e){const t=St(this.baseStep_,qr(e));t!==0&&this.value.setRawValue(this.constrainValue_(this.value.rawValue+t),{forceEmit:!1,last:!1})}onInputKeyUp_(e){St(this.baseStep_,qr(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}onPointerDown_(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0}computeDraggingValue_(e){if(!e.point)return null;const t=e.point.x-e.bounds.width/2;return this.constrainValue_(this.originRawValue_+t*this.props.get("draggingScale"))}onPointerMove_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!1,last:!1}),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_)}onPointerUp_(e){const t=this.computeDraggingValue_(e.data);t!==null&&(this.value.setRawValue(t,{forceEmit:!0,last:!0}),this.dragging_.rawValue=null)}}const kr=Ge("sld");class mi{constructor(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(kr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(kr("t")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.trackElement=n;const a=e.createElement("div");a.classList.add(kr("k")),this.trackElement.appendChild(a),this.knobElement=a,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}update_(){const e=nt(Je(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=`${e}%`}onChange_(){this.update_()}}class Ro{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDownOrMove_=this.onPointerDownOrMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new mi(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new sr(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("move",this.onPointerDownOrMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_),this.view.trackElement.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){!e.point||this.value.setRawValue(Je(nt(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")),t)}onPointerDownOrMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=St(this.baseStep_,Qt(e));t!==0&&this.value.setRawValue(this.value.rawValue+t,{forceEmit:!1,last:!1})}onKeyUp_(e){St(this.baseStep_,Qt(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Dn=Ge("sldtxt");class Oo{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Dn());const n=e.createElement("div");n.classList.add(Dn("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);const a=e.createElement("div");a.classList.add(Dn("t")),this.textView_=t.textView,a.appendChild(this.textView_.element),this.element.appendChild(a)}}class da{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Ro(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new lr(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,sliderProps:t.sliderProps,value:t.value,viewProps:t.viewProps}),this.view=new Oo(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}get sliderController(){return this.sliderC_}get textController(){return this.textC_}}function Fn(r,e){r.write(e)}function bi(r){const e=Ze;if(Array.isArray(r))return e.required.array(e.required.object({text:e.required.string,value:e.required.raw}))(r).value;if(typeof r=="object")return e.required.raw(r).value}function Do(r){if(r==="inline"||r==="popup")return r}function Ht(r){const e=Ze;return e.required.object({max:e.optional.number,min:e.optional.number,step:e.optional.number})(r).value}function Vn(r){if(Array.isArray(r))return r;const e=[];return Object.keys(r).forEach(t=>{e.push({text:t,value:r[t]})}),e}function Nn(r){return Ve(r)?null:new Pn(Vn(r))}function Bn(r){const e=r?zt(r,Pn):null;return e?e.options:null}function Wr(r){const e=r?zt(r,Xr):null;return e?e.step:null}function Yr(r,e){const t=r&&zt(r,Xr);return t?Ft(t.step):Math.max(Ft(e),2)}function ur(r){const e=Wr(r);return e!=null?e:1}function cr(r,e){var t;const n=r&&zt(r,Xr),a=Math.abs((t=n==null?void 0:n.step)!==null&&t!==void 0?t:e);return a===0?.1:Math.pow(10,Math.floor(Math.log10(a))-1)}const Qr=Ge("ckb");class Fo{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Qr()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("label");n.classList.add(Qr("l")),this.element.appendChild(n);const a=e.createElement("input");a.classList.add(Qr("i")),a.type="checkbox",n.appendChild(a),this.inputElement=a,t.viewProps.bindDisabled(this.inputElement);const m=e.createElement("div");m.classList.add(Qr("w")),n.appendChild(m);const P=bt(e,"check");m.appendChild(P),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}update_(){this.inputElement.checked=this.value.rawValue}onValueChange_(){this.update_()}}class Vo{constructor(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Fo(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}onInputChange_(e){const t=e.currentTarget;this.value.rawValue=t.checked}}function No(r){const e=[],t=Nn(r.options);return t&&e.push(t),new Kr(e)}const Bo={id:"input-bool",type:"input",accept:(r,e)=>{if(typeof r!="boolean")return null;const n=ht(e,{options:Ze.optional.custom(bi)});return n?{initialValue:r,params:n}:null},binding:{reader:r=>yo,constraint:r=>No(r.params),writer:r=>Fn},controller:r=>{var e;const t=r.document,n=r.value,a=r.constraint;return a&&zt(a,Pn)?new Tn(t,{props:Ne.fromObject({options:(e=Bn(a))!==null&&e!==void 0?e:[]}),value:n,viewProps:r.viewProps}):new Vo(t,{value:n,viewProps:r.viewProps})}},dr=Ge("col");class Mo{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(dr()),t.foldable.bindExpandedClass(this.element,dr(void 0,"expanded")),Et(t.foldable,"completed",jr(this.element,dr(void 0,"cpl")));const n=e.createElement("div");n.classList.add(dr("h")),this.element.appendChild(n);const a=e.createElement("div");a.classList.add(dr("s")),n.appendChild(a),this.swatchElement=a;const m=e.createElement("div");if(m.classList.add(dr("t")),n.appendChild(m),this.textElement=m,t.pickerLayout==="inline"){const P=e.createElement("div");P.classList.add(dr("p")),this.element.appendChild(P),this.pickerElement=P}else this.pickerElement=null}}function Io(r,e,t){const n=nt(r/255,0,1),a=nt(e/255,0,1),m=nt(t/255,0,1),P=Math.max(n,a,m),te=Math.min(n,a,m),xe=P-te;let ke=0,je=0;const He=(te+P)/2;return xe!==0&&(je=xe/(1-Math.abs(P+te-1)),n===P?ke=(a-m)/xe:a===P?ke=2+(m-n)/xe:ke=4+(n-a)/xe,ke=ke/6+(ke<0?1:0)),[ke*360,je*100,He*100]}function Go(r,e,t){const n=(r%360+360)%360,a=nt(e/100,0,1),m=nt(t/100,0,1),P=(1-Math.abs(2*m-1))*a,te=P*(1-Math.abs(n/60%2-1)),xe=m-P/2;let ke,je,He;return n>=0&&n<60?[ke,je,He]=[P,te,0]:n>=60&&n<120?[ke,je,He]=[te,P,0]:n>=120&&n<180?[ke,je,He]=[0,P,te]:n>=180&&n<240?[ke,je,He]=[0,te,P]:n>=240&&n<300?[ke,je,He]=[te,0,P]:[ke,je,He]=[P,0,te],[(ke+xe)*255,(je+xe)*255,(He+xe)*255]}function Zr(r,e,t){const n=nt(r/255,0,1),a=nt(e/255,0,1),m=nt(t/255,0,1),P=Math.max(n,a,m),te=Math.min(n,a,m),xe=P-te;let ke;xe===0?ke=0:P===n?ke=60*(((a-m)/xe%6+6)%6):P===a?ke=60*((m-n)/xe+2):ke=60*((n-a)/xe+4);const je=P===0?0:xe/P,He=P;return[ke,je*100,He*100]}function _i(r,e,t){const n=On(r,360),a=nt(e/100,0,1),m=nt(t/100,0,1),P=m*a,te=P*(1-Math.abs(n/60%2-1)),xe=m-P;let ke,je,He;return n>=0&&n<60?[ke,je,He]=[P,te,0]:n>=60&&n<120?[ke,je,He]=[te,P,0]:n>=120&&n<180?[ke,je,He]=[0,P,te]:n>=180&&n<240?[ke,je,He]=[0,te,P]:n>=240&&n<300?[ke,je,He]=[te,0,P]:[ke,je,He]=[P,0,te],[(ke+xe)*255,(je+xe)*255,(He+xe)*255]}function fa(r,e,t){const n=t+e*(100-Math.abs(2*t-100))/200;return[r,n!==0?e*(100-Math.abs(2*t-100))/n:0,t+e*(100-Math.abs(2*t-100))/(2*100)]}function Mn(r,e,t){const n=100-Math.abs(t*(200-e)/100-100);return[r,n!==0?e*t/n:0,t*(200-e)/(2*100)]}function Lr(r){return[r[0],r[1],r[2]]}function Uo(r,e){return[r[0],r[1],r[2],e]}const zl={hsl:{hsl:(r,e,t)=>[r,e,t],hsv:fa,rgb:Go},hsv:{hsl:Mn,hsv:(r,e,t)=>[r,e,t],rgb:_i},rgb:{hsl:Io,hsv:Zr,rgb:(r,e,t)=>[r,e,t]}};function Jr(r,e){return[e==="float"?1:r==="rgb"?255:360,e==="float"?1:r==="rgb"?255:100,e==="float"?1:r==="rgb"?255:100]}function jl(r,e,t){var n;const a=Jr(e,t);return[e==="rgb"?nt(r[0],0,a[0]):On(r[0],a[0]),nt(r[1],0,a[1]),nt(r[2],0,a[2]),nt((n=r[3])!==null&&n!==void 0?n:1,0,1)]}function zo(r,e,t,n){const a=Jr(e,t),m=Jr(e,n);return r.map((P,te)=>P/a[te]*m[te])}function Hl(r,e,t){const n=zo(r,e.mode,e.type,"int"),a=zl[e.mode][t.mode](...n);return zo(a,t.mode,"int",t.type)}function en(r,e){return typeof r!="object"||Ve(r)?!1:e in r&&typeof r[e]=="number"}class Me{constructor(e,t,n="int"){this.mode=t,this.type=n,this.comps_=jl(e,t,n)}static black(e="int"){return new Me([0,0,0],"rgb",e)}static fromObject(e,t="int"){const n="a"in e?[e.r,e.g,e.b,e.a]:[e.r,e.g,e.b];return new Me(n,"rgb",t)}static toRgbaObject(e,t="int"){return e.toRgbaObject(t)}static isRgbColorObject(e){return en(e,"r")&&en(e,"g")&&en(e,"b")}static isRgbaColorObject(e){return this.isRgbColorObject(e)&&en(e,"a")}static isColorObject(e){return this.isRgbColorObject(e)}static equals(e,t){if(e.mode!==t.mode)return!1;const n=e.comps_,a=t.comps_;for(let m=0;m<n.length;m++)if(n[m]!==a[m])return!1;return!0}getComponents(e,t="int"){return Uo(Hl(Lr(this.comps_),{mode:this.mode,type:this.type},{mode:e!=null?e:this.mode,type:t}),this.comps_[3])}toRgbaObject(e="int"){const t=this.getComponents("rgb",e);return{r:t[0],g:t[1],b:t[2],a:t[3]}}}const $t=Ge("colp");class jo{constructor(e,t){this.alphaViews_=null,this.element=e.createElement("div"),this.element.classList.add($t());const n=e.createElement("div");n.classList.add($t("hsv"));const a=e.createElement("div");a.classList.add($t("sv")),this.svPaletteView_=t.svPaletteView,a.appendChild(this.svPaletteView_.element),n.appendChild(a);const m=e.createElement("div");m.classList.add($t("h")),this.hPaletteView_=t.hPaletteView,m.appendChild(this.hPaletteView_.element),n.appendChild(m),this.element.appendChild(n);const P=e.createElement("div");if(P.classList.add($t("rgb")),this.textView_=t.textView,P.appendChild(this.textView_.element),this.element.appendChild(P),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};const te=e.createElement("div");te.classList.add($t("a"));const xe=e.createElement("div");xe.classList.add($t("ap")),xe.appendChild(this.alphaViews_.palette.element),te.appendChild(xe);const ke=e.createElement("div");ke.classList.add($t("at")),ke.appendChild(this.alphaViews_.text.element),te.appendChild(ke),this.element.appendChild(te)}}get allFocusableElements(){const e=[this.svPaletteView_.element,this.hPaletteView_.element,this.textView_.modeSelectElement,...this.textView_.textViews.map(t=>t.inputElement)];return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),e}}function Ho(r){return r==="int"?"int":r==="float"?"float":void 0}function In(r){const e=Ze;return ht(r,{alpha:e.optional.boolean,color:e.optional.object({alpha:e.optional.boolean,type:e.optional.custom(Ho)}),expanded:e.optional.boolean,picker:e.optional.custom(Do)})}function Rr(r){return r?.1:1}function Kt(r){var e;return(e=r.color)===null||e===void 0?void 0:e.type}function $l(r,e){return r.alpha===e.alpha&&r.mode===e.mode&&r.notation===e.notation&&r.type===e.type}function Rt(r,e){const t=r.match(/^(.+)%$/);return Math.min(t?parseFloat(t[1])*.01*e:parseFloat(r),e)}const Kl={deg:r=>r,grad:r=>r*360/400,rad:r=>r*360/(2*Math.PI),turn:r=>r*360};function $o(r){const e=r.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!e)return parseFloat(r);const t=parseFloat(e[1]),n=e[2];return Kl[n](t)}function Ko(r){const e=r.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Rt(e[1],255),Rt(e[2],255),Rt(e[3],255)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Xo(r){return e=>{const t=Ko(e);return t?new Me(t,"rgb",r):null}}function qo(r){const e=r.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[Rt(e[1],255),Rt(e[2],255),Rt(e[3],255),Rt(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function pa(r){return e=>{const t=qo(e);return t?new Me(t,"rgb",r):null}}function tn(r){const e=r.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[$o(e[1]),Rt(e[2],100),Rt(e[3],100)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function Wo(r){return e=>{const t=tn(e);return t?new Me(t,"hsl",r):null}}function Gn(r){const e=r.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!e)return null;const t=[$o(e[1]),Rt(e[2],100),Rt(e[3],100),Rt(e[4],1)];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function kt(r){return e=>{const t=Gn(e);return t?new Me(t,"hsl",r):null}}function Or(r){const e=r.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)];const t=r.match(/^(?:#|0x)([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)]:null}function Yo(r){const e=Or(r);return e?new Me(e,"rgb","int"):null}function ha(r){const e=r.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(e)return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),Je(parseInt(e[4]+e[4],16),0,255,0,1)];const t=r.match(/^(?:#|0x)?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16),Je(parseInt(t[4],16),0,255,0,1)]:null}function Qo(r){const e=ha(r);return e?new Me(e,"rgb","int"):null}function va(r){const e=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])?null:t}function ma(r){return e=>{const t=va(e);return t?new Me(t,"rgb",r):null}}function ba(r){const e=r.match(/^\{\s*r\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*g\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*b\s*:\s*([0-9A-Fa-f.]+%?)\s*,\s*a\s*:\s*([0-9A-Fa-f.]+%?)\s*\}$/);if(!e)return null;const t=[parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]),parseFloat(e[4])];return isNaN(t[0])||isNaN(t[1])||isNaN(t[2])||isNaN(t[3])?null:t}function Zo(r){return e=>{const t=ba(e);return t?new Me(t,"rgb",r):null}}const rn=[{parser:Or,result:{alpha:!1,mode:"rgb",notation:"hex"}},{parser:ha,result:{alpha:!0,mode:"rgb",notation:"hex"}},{parser:Ko,result:{alpha:!1,mode:"rgb",notation:"func"}},{parser:qo,result:{alpha:!0,mode:"rgb",notation:"func"}},{parser:tn,result:{alpha:!1,mode:"hsl",notation:"func"}},{parser:Gn,result:{alpha:!0,mode:"hsl",notation:"func"}},{parser:va,result:{alpha:!1,mode:"rgb",notation:"object"}},{parser:ba,result:{alpha:!0,mode:"rgb",notation:"object"}}];function ft(r){return rn.reduce((e,{parser:t,result:n})=>e||(t(r)?n:null),null)}function gi(r,e="int"){const t=ft(r);return t?t.notation==="hex"&&e!=="float"?Object.assign(Object.assign({},t),{type:"int"}):t.notation==="func"?Object.assign(Object.assign({},t),{type:e}):null:null}const _a={int:[Yo,Qo,Xo("int"),pa("int"),Wo("int"),kt("int"),ma("int"),Zo("int")],float:[Xo("float"),pa("float"),Wo("float"),kt("float"),ma("float"),Zo("float")]};function Dr(r){const e=_a[r];return t=>{if(typeof t!="string")return Me.black(r);const n=e.reduce((a,m)=>a||m(t),null);return n!=null?n:Me.black(r)}}function wi(r){const e=_a[r];return t=>e.reduce((n,a)=>n||a(t),null)}function ga(r){const e=nt(Math.floor(r),0,255).toString(16);return e.length===1?`0${e}`:e}function Jo(r,e="#"){const t=Lr(r.getComponents("rgb")).map(ga).join("");return`${e}${t}`}function wa(r,e="#"){const t=r.getComponents("rgb"),n=[t[0],t[1],t[2],t[3]*255].map(ga).join("");return`${e}${n}`}function es(r,e){const t=rt(e==="float"?2:0);return`rgb(${Lr(r.getComponents("rgb",e)).map(a=>t(a)).join(", ")})`}function Xl(r){return e=>es(e,r)}function nn(r,e){const t=rt(2),n=rt(e==="float"?2:0);return`rgba(${r.getComponents("rgb",e).map((m,P)=>(P===3?t:n)(m)).join(", ")})`}function ts(r){return e=>nn(e,r)}function ql(r){const e=[rt(0),Yt,Yt];return`hsl(${Lr(r.getComponents("hsl")).map((n,a)=>e[a](n)).join(", ")})`}function rs(r){const e=[rt(0),Yt,Yt,rt(2)];return`hsla(${r.getComponents("hsl").map((n,a)=>e[a](n)).join(", ")})`}function ya(r,e){const t=rt(e==="float"?2:0),n=["r","g","b"];return`{${Lr(r.getComponents("rgb",e)).map((m,P)=>`${n[P]}: ${t(m)}`).join(", ")}}`}function Wl(r){return e=>ya(e,r)}function Un(r,e){const t=rt(2),n=rt(e==="float"?2:0),a=["r","g","b","a"];return`{${r.getComponents("rgb",e).map((P,te)=>{const xe=te===3?t:n;return`${a[te]}: ${xe(P)}`}).join(", ")}}`}function Yl(r){return e=>Un(e,r)}const fr=[{format:{alpha:!1,mode:"rgb",notation:"hex",type:"int"},stringifier:Jo},{format:{alpha:!0,mode:"rgb",notation:"hex",type:"int"},stringifier:wa},{format:{alpha:!1,mode:"hsl",notation:"func",type:"int"},stringifier:ql},{format:{alpha:!0,mode:"hsl",notation:"func",type:"int"},stringifier:rs},...["int","float"].reduce((r,e)=>[...r,{format:{alpha:!1,mode:"rgb",notation:"func",type:e},stringifier:Xl(e)},{format:{alpha:!0,mode:"rgb",notation:"func",type:e},stringifier:ts(e)},{format:{alpha:!1,mode:"rgb",notation:"object",type:e},stringifier:Wl(e)},{format:{alpha:!0,mode:"rgb",notation:"object",type:e},stringifier:Yl(e)}],[])];function an(r){return fr.reduce((e,t)=>e||($l(t.format,r)?t.stringifier:null),null)}const on=Ge("apl");class ns{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(on()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(on("b")),this.element.appendChild(n);const a=e.createElement("div");a.classList.add(on("c")),n.appendChild(a),this.colorElem_=a;const m=e.createElement("div");m.classList.add(on("m")),this.element.appendChild(m),this.markerElem_=m;const P=e.createElement("div");P.classList.add(on("p")),this.markerElem_.appendChild(P),this.previewElem_=P,this.update_()}update_(){const e=this.value.rawValue,t=e.getComponents("rgb"),n=new Me([t[0],t[1],t[2],0],"rgb"),a=new Me([t[0],t[1],t[2],255],"rgb"),m=["to right",nn(n),nn(a)];this.colorElem_.style.background=`linear-gradient(${m.join(",")})`,this.previewElem_.style.backgroundColor=nn(e);const P=Je(t[3],0,1,0,100);this.markerElem_.style.left=`${P}%`}onValueChange_(){this.update_()}}class is{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new ns(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new sr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=e.point.x/e.bounds.width,a=this.value.rawValue,[m,P,te]=a.getComponents("hsv");this.value.setRawValue(new Me([m,P,te,n],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=St(Rr(!0),Qt(e));if(t===0)return;const n=this.value.rawValue,[a,m,P,te]=n.getComponents("hsv");this.value.setRawValue(new Me([a,m,P,te+t],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){St(Rr(!0),Qt(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const Fr=Ge("coltxt");function as(r){const e=r.createElement("select"),t=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return e.appendChild(t.reduce((n,a)=>{const m=r.createElement("option");return m.textContent=a.text,m.value=a.value,n.appendChild(m),n},r.createDocumentFragment())),e}class os{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(Fr());const n=e.createElement("div");n.classList.add(Fr("m")),this.modeElem_=as(e),this.modeElem_.classList.add(Fr("ms")),n.appendChild(this.modeSelectElement);const a=e.createElement("div");a.classList.add(Fr("mm")),a.appendChild(bt(e,"dropdown")),n.appendChild(a),this.element.appendChild(n);const m=e.createElement("div");m.classList.add(Fr("w")),this.element.appendChild(m),this.textsElem_=m,this.textViews_=t.textViews,this.applyTextViews_(),Er(t.colorMode,P=>{this.modeElem_.value=P})}get modeSelectElement(){return this.modeElem_}get textViews(){return this.textViews_}set textViews(e){this.textViews_=e,this.applyTextViews_()}applyTextViews_(){to(this.textsElem_);const e=this.element.ownerDocument;this.textViews_.forEach(t=>{const n=e.createElement("div");n.classList.add(Fr("c")),n.appendChild(t.element),this.textsElem_.appendChild(n)})}}function ss(r){return rt(r==="float"?2:0)}function ls(r,e,t){const n=Jr(r,e)[t];return new jt({min:0,max:n})}function yi(r,e,t){return new lr(r,{arrayPosition:t===0?"fst":t===3-1?"lst":"mid",baseStep:Rr(!1),parser:e.parser,props:Ne.fromObject({draggingScale:e.colorType==="float"?.01:1,formatter:ss(e.colorType)}),value:mt(0,{constraint:ls(e.colorMode,e.colorType,t)}),viewProps:e.viewProps})}class Vt{constructor(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.colorType_=t.colorType,this.parser_=t.parser,this.value=t.value,this.viewProps=t.viewProps,this.colorMode=mt(this.value.rawValue.mode),this.ccs_=this.createComponentControllers_(e),this.view=new os(e,{colorMode:this.colorMode,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}createComponentControllers_(e){const t={colorMode:this.colorMode.rawValue,colorType:this.colorType_,parser:this.parser_,viewProps:this.viewProps},n=[yi(e,t,0),yi(e,t,1),yi(e,t,2)];return n.forEach((a,m)=>{Rn({primary:this.value,secondary:a.value,forward:P=>P.rawValue.getComponents(this.colorMode.rawValue,this.colorType_)[m],backward:(P,te)=>{const xe=this.colorMode.rawValue,ke=P.rawValue.getComponents(xe,this.colorType_);return ke[m]=te.rawValue,new Me(Uo(Lr(ke),ke[3]),xe,this.colorType_)}})}),n}onModeSelectChange_(e){const t=e.currentTarget;this.colorMode.rawValue=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}}const xi=Ge("hpl");class Ql{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(xi()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("div");n.classList.add(xi("c")),this.element.appendChild(n);const a=e.createElement("div");a.classList.add(xi("m")),this.element.appendChild(a),this.markerElem_=a,this.update_()}update_(){const e=this.value.rawValue,[t]=e.getComponents("hsv");this.markerElem_.style.backgroundColor=es(new Me([t,100,100],"hsv"));const n=Je(t,0,360,0,100);this.markerElem_.style.left=`${n}%`}onValueChange_(){this.update_()}}class Zt{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Ql(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new sr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Je(nt(e.point.x,0,e.bounds.width),0,e.bounds.width,0,359),a=this.value.rawValue,[,m,P,te]=a.getComponents("hsv");this.value.setRawValue(new Me([n,m,P,te],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){const t=St(Rr(!1),Qt(e));if(t===0)return;const n=this.value.rawValue,[a,m,P,te]=n.getComponents("hsv");this.value.setRawValue(new Me([a+t,m,P,te],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){St(Rr(!1),Qt(e))!==0&&this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}const zn=Ge("svp"),pr=64;class Ei{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(zn()),t.viewProps.bindTabIndex(this.element);const n=e.createElement("canvas");n.height=pr,n.width=pr,n.classList.add(zn("c")),this.element.appendChild(n),this.canvasElement=n;const a=e.createElement("div");a.classList.add(zn("m")),this.element.appendChild(a),this.markerElem_=a,this.update_()}update_(){const e=eo(this.canvasElement);if(!e)return;const n=this.value.rawValue.getComponents("hsv"),a=this.canvasElement.width,m=this.canvasElement.height,P=e.getImageData(0,0,a,m),te=P.data;for(let je=0;je<m;je++)for(let He=0;He<a;He++){const rr=Je(He,0,a,0,100),Gr=Je(je,0,m,100,0),_r=_i(n[0],rr,Gr),nr=(je*a+He)*4;te[nr]=_r[0],te[nr+1]=_r[1],te[nr+2]=_r[2],te[nr+3]=255}e.putImageData(P,0,0);const xe=Je(n[1],0,100,0,100);this.markerElem_.style.left=`${xe}%`;const ke=Je(n[2],0,100,100,0);this.markerElem_.style.top=`${ke}%`}onValueChange_(){this.update_()}}class us{constructor(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onKeyUp_=this.onKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Ei(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new sr(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.element.addEventListener("keyup",this.onKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=Je(e.point.x,0,e.bounds.width,0,100),a=Je(e.point.y,0,e.bounds.height,100,0),[m,,,P]=this.value.rawValue.getComponents("hsv");this.value.setRawValue(new Me([m,n,a,P],"hsv"),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onKeyDown_(e){ua(e.key)&&e.preventDefault();const[t,n,a,m]=this.value.rawValue.getComponents("hsv"),P=Rr(!1),te=St(P,Qt(e)),xe=St(P,qr(e));te===0&&xe===0||this.value.setRawValue(new Me([t,n+te,a+xe,m],"hsv"),{forceEmit:!1,last:!1})}onKeyUp_(e){const t=Rr(!1),n=St(t,Qt(e)),a=St(t,qr(e));n===0&&a===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class cs{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.hPaletteC_=new Zt(e,{value:this.value,viewProps:this.viewProps}),this.svPaletteC_=new us(e,{value:this.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new is(e,{value:this.value,viewProps:this.viewProps}),text:new lr(e,{parser:_t,baseStep:.1,props:Ne.fromObject({draggingScale:.01,formatter:rt(2)}),value:mt(0,{constraint:new jt({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Rn({primary:this.value,secondary:this.alphaIcs_.text.value,forward:n=>n.rawValue.getComponents()[3],backward:(n,a)=>{const m=n.rawValue.getComponents();return m[3]=a.rawValue,new Me(m,n.rawValue.mode)}}),this.textC_=new Vt(e,{colorType:t.colorType,parser:_t,value:this.value,viewProps:this.viewProps}),this.view=new jo(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,hPaletteView:this.hPaletteC_.view,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteC_.view,textView:this.textC_.view})}get textController(){return this.textC_}}const Ci=Ge("colsw");class ds{constructor(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Ci()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("div");n.classList.add(Ci("sw")),this.element.appendChild(n),this.swatchElem_=n;const a=e.createElement("button");a.classList.add(Ci("b")),t.viewProps.bindDisabled(a),this.element.appendChild(a),this.buttonElement=a,this.update_()}update_(){const e=this.value.rawValue;this.swatchElem_.style.backgroundColor=wa(e)}onValueChange_(){this.update_()}}class fs{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new ds(e,{value:this.value,viewProps:this.viewProps})}}class xa{constructor(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Hr.create(t.expanded),this.swatchC_=new fs(e,{value:this.value,viewProps:this.viewProps});const n=this.swatchC_.view.buttonElement;n.addEventListener("blur",this.onButtonBlur_),n.addEventListener("click",this.onButtonClick_),this.textC_=new Sr(e,{parser:t.parser,props:Ne.fromObject({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Mo(e,{foldable:this.foldable_,pickerLayout:t.pickerLayout}),this.view.swatchElement.appendChild(this.swatchC_.view.element),this.view.textElement.appendChild(this.textC_.view.element),this.popC_=t.pickerLayout==="popup"?new wo(e,{viewProps:this.viewProps}):null;const a=new cs(e,{colorType:t.colorType,supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps});a.view.allFocusableElements.forEach(m=>{m.addEventListener("blur",this.onPopupChildBlur_),m.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=a,this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(a.view.element),Rn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:m=>m.rawValue,backward:(m,P)=>P.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),li(this.foldable_,this.view.pickerElement))}get textController(){return this.textC_}onButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=l(e);n&&t.contains(n)||n&&n===this.swatchC_.view.buttonElement&&!oi(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.swatchC_.view.buttonElement.focus()}}function Zl(r,e){return Me.isColorObject(r)?Me.fromObject(r,e):Me.black(e)}function Jl(r){return Lr(r.getComponents("rgb")).reduce((e,t)=>e<<8|Math.floor(t)&255,0)}function eu(r){return r.getComponents("rgb").reduce((e,t,n)=>{const a=Math.floor(n===3?t*255:t)&255;return e<<8|a},0)>>>0}function tu(r){return new Me([r>>16&255,r>>8&255,r&255],"rgb")}function ru(r){return new Me([r>>24&255,r>>16&255,r>>8&255,Je(r&255,0,255,0,1)],"rgb")}function nu(r){return typeof r!="number"?Me.black():tu(r)}function ps(r){return typeof r!="number"?Me.black():ru(r)}function hs(r){const e=an(r);return e?(t,n)=>{Fn(t,e(n))}:null}function iu(r){const e=r?eu:Jl;return(t,n)=>{Fn(t,e(n))}}function au(r,e,t){const n=e.toRgbaObject(t);r.writeProperty("r",n.r),r.writeProperty("g",n.g),r.writeProperty("b",n.b),r.writeProperty("a",n.a)}function Ea(r,e,t){const n=e.toRgbaObject(t);r.writeProperty("r",n.r),r.writeProperty("g",n.g),r.writeProperty("b",n.b)}function Ai(r,e){return(t,n)=>{r?au(t,n,e):Ea(t,n,e)}}function Ca(r){var e;return!!((r==null?void 0:r.alpha)||((e=r==null?void 0:r.color)===null||e===void 0?void 0:e.alpha))}function ou(r){return r?e=>wa(e,"0x"):e=>Jo(e,"0x")}function su(r){return"color"in r||"view"in r&&r.view==="color"}const lu={id:"input-color-number",type:"input",accept:(r,e)=>{if(typeof r!="number"||!su(e))return null;const t=In(e);return t?{initialValue:r,params:t}:null},binding:{reader:r=>Ca(r.params)?ps:nu,equals:Me.equals,writer:r=>iu(Ca(r.params))},controller:r=>{const e=Ca(r.params),t="expanded"in r.params?r.params.expanded:void 0,n="picker"in r.params?r.params.picker:void 0;return new xa(r.document,{colorType:"int",expanded:t!=null?t:!1,formatter:ou(e),parser:wi("int"),pickerLayout:n!=null?n:"popup",supportsAlpha:e,value:r.value,viewProps:r.viewProps})}};function uu(r){return Me.isRgbaColorObject(r)}function vs(r){return e=>Zl(e,r)}function cu(r,e){return t=>r?Un(t,e):ya(t,e)}const du={id:"input-color-object",type:"input",accept:(r,e)=>{if(!Me.isColorObject(r))return null;const t=In(e);return t?{initialValue:r,params:t}:null},binding:{reader:r=>vs(Kt(r.params)),equals:Me.equals,writer:r=>Ai(uu(r.initialValue),Kt(r.params))},controller:r=>{var e;const t=Me.isRgbaColorObject(r.initialValue),n="expanded"in r.params?r.params.expanded:void 0,a="picker"in r.params?r.params.picker:void 0,m=(e=Kt(r.params))!==null&&e!==void 0?e:"int";return new xa(r.document,{colorType:m,expanded:n!=null?n:!1,formatter:cu(t,m),parser:wi(m),pickerLayout:a!=null?a:"popup",supportsAlpha:t,value:r.value,viewProps:r.viewProps})}},fu={id:"input-color-string",type:"input",accept:(r,e)=>{if(typeof r!="string"||"view"in e&&e.view==="text")return null;const t=gi(r,Kt(e));if(!t||!an(t))return null;const a=In(e);return a?{initialValue:r,params:a}:null},binding:{reader:r=>{var e;return Dr((e=Kt(r.params))!==null&&e!==void 0?e:"int")},equals:Me.equals,writer:r=>{const e=gi(r.initialValue,Kt(r.params));if(!e)throw De.shouldNeverHappen();const t=hs(e);if(!t)throw De.notBindable();return t}},controller:r=>{const e=gi(r.initialValue,Kt(r.params));if(!e)throw De.shouldNeverHappen();const t=an(e);if(!t)throw De.shouldNeverHappen();const n="expanded"in r.params?r.params.expanded:void 0,a="picker"in r.params?r.params.picker:void 0;return new xa(r.document,{colorType:e.type,expanded:n!=null?n:!1,formatter:t,parser:wi(e.type),pickerLayout:a!=null?a:"popup",supportsAlpha:e.alpha,value:r.value,viewProps:r.viewProps})}};class hr{constructor(e){this.components=e.components,this.asm_=e.assembly}constrain(e){const t=this.asm_.toComponents(e).map((n,a)=>{var m,P;return(P=(m=this.components[a])===null||m===void 0?void 0:m.constrain(n))!==null&&P!==void 0?P:n});return this.asm_.fromComponents(t)}}const ms=Ge("pndtxt");class sn{constructor(e,t){this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(ms()),this.textViews.forEach(n=>{const a=e.createElement("div");a.classList.add(ms("a")),a.appendChild(n.element),this.element.appendChild(a)})}}function pu(r,e,t){return new lr(r,{arrayPosition:t===0?"fst":t===e.axes.length-1?"lst":"mid",baseStep:e.axes[t].baseStep,parser:e.parser,props:e.axes[t].textProps,value:mt(0,{constraint:e.axes[t].constraint}),viewProps:e.viewProps})}class Aa{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((n,a)=>pu(e,t,a)),this.acs_.forEach((n,a)=>{Rn({primary:this.value,secondary:n.value,forward:m=>t.assembly.toComponents(m.rawValue)[a],backward:(m,P)=>{const te=t.assembly.toComponents(m.rawValue);return te[a]=P.rawValue,t.assembly.fromComponents(te)}})}),this.view=new sn(e,{textViews:this.acs_.map(n=>n.view)})}}function Sa(r,e){return"step"in r&&!Ve(r.step)?new Xr(r.step,e):null}function jn(r){return"max"in r&&!Ve(r.max)||"min"in r&&!Ve(r.min)?new jt({max:r.max,min:r.min}):null}function bs(r,e){const t=[],n=Sa(r,e);n&&t.push(n);const a=jn(r);a&&t.push(a);const m=Nn(r.options);return m&&t.push(m),new Kr(t)}function Pa(r){const e=r?zt(r,jt):null;return e?[e.minValue,e.maxValue]:[void 0,void 0]}function hu(r){const[e,t]=Pa(r);return[e!=null?e:0,t!=null?t:100]}const _s={id:"input-number",type:"input",accept:(r,e)=>{if(typeof r!="number")return null;const t=Ze,n=ht(e,{format:t.optional.function,max:t.optional.number,min:t.optional.number,options:t.optional.custom(bi),step:t.optional.number});return n?{initialValue:r,params:n}:null},binding:{reader:r=>Lo,constraint:r=>bs(r.params,r.initialValue),writer:r=>Fn},controller:r=>{var e,t;const n=r.value,a=r.constraint;if(a&&zt(a,Pn))return new Tn(r.document,{props:Ne.fromObject({options:(e=Bn(a))!==null&&e!==void 0?e:[]}),value:n,viewProps:r.viewProps});const m=(t="format"in r.params?r.params.format:void 0)!==null&&t!==void 0?t:rt(Yr(a,n.rawValue));if(a&&zt(a,jt)){const[P,te]=hu(a);return new da(r.document,{baseStep:ur(a),parser:_t,sliderProps:Ne.fromObject({maxValue:te,minValue:P}),textProps:Ne.fromObject({draggingScale:cr(a,n.rawValue),formatter:m}),value:n,viewProps:r.viewProps})}return new lr(r.document,{baseStep:ur(a),parser:_t,props:Ne.fromObject({draggingScale:cr(a,n.rawValue),formatter:m}),value:n,viewProps:r.viewProps})}};class vr{constructor(e=0,t=0){this.x=e,this.y=t}getComponents(){return[this.x,this.y]}static isObject(e){if(Ve(e))return!1;const t=e.x,n=e.y;return!(typeof t!="number"||typeof n!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y}toObject(){return{x:this.x,y:this.y}}}const gs={toComponents:r=>r.getComponents(),fromComponents:r=>new vr(...r)},ln=Ge("p2d");class vu{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(ln()),t.viewProps.bindClassModifiers(this.element),Er(t.expanded,jr(this.element,ln(void 0,"expanded")));const n=e.createElement("div");n.classList.add(ln("h")),this.element.appendChild(n);const a=e.createElement("button");a.classList.add(ln("b")),a.appendChild(bt(e,"p2dpad")),t.viewProps.bindDisabled(a),n.appendChild(a),this.buttonElement=a;const m=e.createElement("div");if(m.classList.add(ln("t")),n.appendChild(m),this.textElement=m,t.pickerLayout==="inline"){const P=e.createElement("div");P.classList.add(ln("p")),this.element.appendChild(P),this.pickerElement=P}else this.pickerElement=null}}const mr=Ge("p2dp");class Hn{constructor(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add(mr()),t.layout==="popup"&&this.element.classList.add(mr(void 0,"p"));const n=e.createElement("div");n.classList.add(mr("p")),t.viewProps.bindTabIndex(n),this.element.appendChild(n),this.padElement=n;const a=e.createElementNS(Gt,"svg");a.classList.add(mr("g")),this.padElement.appendChild(a),this.svgElem_=a;const m=e.createElementNS(Gt,"line");m.classList.add(mr("ax")),m.setAttributeNS(null,"x1","0"),m.setAttributeNS(null,"y1","50%"),m.setAttributeNS(null,"x2","100%"),m.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(m);const P=e.createElementNS(Gt,"line");P.classList.add(mr("ax")),P.setAttributeNS(null,"x1","50%"),P.setAttributeNS(null,"y1","0"),P.setAttributeNS(null,"x2","50%"),P.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(P);const te=e.createElementNS(Gt,"line");te.classList.add(mr("l")),te.setAttributeNS(null,"x1","50%"),te.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(te),this.lineElem_=te;const xe=e.createElement("div");xe.classList.add(mr("m")),this.padElement.appendChild(xe),this.markerElem_=xe,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}get allFocusableElements(){return[this.padElement]}update_(){const[e,t]=this.value.rawValue.getComponents(),n=this.maxValue_,a=Je(e,-n,+n,0,100),m=Je(t,-n,+n,0,100),P=this.invertsY_?100-m:m;this.lineElem_.setAttributeNS(null,"x2",`${a}%`),this.lineElem_.setAttributeNS(null,"y2",`${P}%`),this.markerElem_.style.left=`${a}%`,this.markerElem_.style.top=`${P}%`}onValueChange_(){this.update_()}onFoldableChange_(){this.update_()}}function ws(r,e,t){return[St(e[0],Qt(r)),St(e[1],qr(r))*(t?1:-1)]}class Si{constructor(e,t){this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPadKeyUp_=this.onPadKeyUp_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new Hn(e,{invertsY:this.invertsY_,layout:t.layout,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new sr(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.padElement.addEventListener("keyup",this.onPadKeyUp_)}handlePointerEvent_(e,t){if(!e.point)return;const n=this.maxValue_,a=Je(e.point.x,0,e.bounds.width,-n,+n),m=Je(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-n,+n);this.value.setRawValue(new vr(a,m),t)}onPointerDown_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerMove_(e){this.handlePointerEvent_(e.data,{forceEmit:!1,last:!1})}onPointerUp_(e){this.handlePointerEvent_(e.data,{forceEmit:!0,last:!0})}onPadKeyDown_(e){ua(e.key)&&e.preventDefault();const[t,n]=ws(e,this.baseSteps_,this.invertsY_);t===0&&n===0||this.value.setRawValue(new vr(this.value.rawValue.x+t,this.value.rawValue.y+n),{forceEmit:!1,last:!1})}onPadKeyUp_(e){const[t,n]=ws(e,this.baseSteps_,this.invertsY_);t===0&&n===0||this.value.setRawValue(this.value.rawValue,{forceEmit:!0,last:!0})}}class mu{constructor(e,t){var n,a;this.onPopupChildBlur_=this.onPopupChildBlur_.bind(this),this.onPopupChildKeydown_=this.onPopupChildKeydown_.bind(this),this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.foldable_=Hr.create(t.expanded),this.popC_=t.pickerLayout==="popup"?new wo(e,{viewProps:this.viewProps}):null;const m=new Si(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,layout:t.pickerLayout,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps});m.view.allFocusableElements.forEach(P=>{P.addEventListener("blur",this.onPopupChildBlur_),P.addEventListener("keydown",this.onPopupChildKeydown_)}),this.pickerC_=m,this.textC_=new Aa(e,{assembly:gs,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new vu(e,{expanded:this.foldable_.value("expanded"),pickerLayout:t.pickerLayout,viewProps:this.viewProps}),this.view.textElement.appendChild(this.textC_.view.element),(n=this.view.buttonElement)===null||n===void 0||n.addEventListener("blur",this.onPadButtonBlur_),(a=this.view.buttonElement)===null||a===void 0||a.addEventListener("click",this.onPadButtonClick_),this.popC_?(this.view.element.appendChild(this.popC_.view.element),this.popC_.view.element.appendChild(this.pickerC_.view.element),Rn({primary:this.foldable_.value("expanded"),secondary:this.popC_.shows,forward:P=>P.rawValue,backward:(P,te)=>te.rawValue})):this.view.pickerElement&&(this.view.pickerElement.appendChild(this.pickerC_.view.element),li(this.foldable_,this.view.pickerElement))}onPadButtonBlur_(e){if(!this.popC_)return;const t=this.view.element,n=e.relatedTarget;(!n||!t.contains(n))&&(this.popC_.shows.rawValue=!1)}onPadButtonClick_(){this.foldable_.set("expanded",!this.foldable_.get("expanded")),this.foldable_.get("expanded")&&this.pickerC_.view.allFocusableElements[0].focus()}onPopupChildBlur_(e){if(!this.popC_)return;const t=this.popC_.view.element,n=l(e);n&&t.contains(n)||n&&n===this.view.buttonElement&&!oi(t.ownerDocument)||(this.popC_.shows.rawValue=!1)}onPopupChildKeydown_(e){this.popC_?e.key==="Escape"&&(this.popC_.shows.rawValue=!1):this.view.pickerElement&&e.key==="Escape"&&this.view.buttonElement.focus()}}function un(r){return vr.isObject(r)?new vr(r.x,r.y):new vr}function cn(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y)}function Jt(r,e){if(!r)return;const t=[],n=Sa(r,e);n&&t.push(n);const a=jn(r);return a&&t.push(a),new Kr(t)}function dn(r,e){return new hr({assembly:gs,components:[Jt("x"in r?r.x:void 0,e.x),Jt("y"in r?r.y:void 0,e.y)]})}function Ta(r,e){var t,n;const a=r&&zt(r,jt);if(a)return Math.max(Math.abs((t=a.minValue)!==null&&t!==void 0?t:0),Math.abs((n=a.maxValue)!==null&&n!==void 0?n:0));const m=ur(r);return Math.max(Math.abs(m)*10,Math.abs(e)*10)}function fn(r,e){const t=e instanceof hr?e.components[0]:void 0,n=e instanceof hr?e.components[1]:void 0,a=Ta(t,r.x),m=Ta(n,r.y);return Math.max(a,m)}function Pi(r,e){return{baseStep:ur(e),constraint:e,textProps:Ne.fromObject({draggingScale:cr(e,r),formatter:rt(Yr(e,r))})}}function ka(r){if(!("y"in r))return!1;const e=r.y;return e&&"inverted"in e?!!e.inverted:!1}const La={id:"input-point2d",type:"input",accept:(r,e)=>{if(!vr.isObject(r))return null;const t=Ze,n=ht(e,{expanded:t.optional.boolean,picker:t.optional.custom(Do),x:t.optional.custom(Ht),y:t.optional.object({inverted:t.optional.boolean,max:t.optional.number,min:t.optional.number,step:t.optional.number})});return n?{initialValue:r,params:n}:null},binding:{reader:r=>un,constraint:r=>dn(r.params,r.initialValue),equals:vr.equals,writer:r=>cn},controller:r=>{const e=r.document,t=r.value,n=r.constraint;if(!(n instanceof hr))throw De.shouldNeverHappen();const a="expanded"in r.params?r.params.expanded:void 0,m="picker"in r.params?r.params.picker:void 0;return new mu(e,{axes:[Pi(t.rawValue.x,n.components[0]),Pi(t.rawValue.y,n.components[1])],expanded:a!=null?a:!1,invertsY:ka(r.params),maxValue:fn(t.rawValue,n),parser:_t,pickerLayout:m!=null?m:"popup",value:t,viewProps:r.viewProps})}};class br{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}getComponents(){return[this.x,this.y,this.z]}static isObject(e){if(Ve(e))return!1;const t=e.x,n=e.y,a=e.z;return!(typeof t!="number"||typeof n!="number"||typeof a!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}toObject(){return{x:this.x,y:this.y,z:this.z}}}const Ti={toComponents:r=>r.getComponents(),fromComponents:r=>new br(...r)};function ki(r){return br.isObject(r)?new br(r.x,r.y,r.z):new br}function ys(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z)}function xs(r,e){return new hr({assembly:Ti,components:[Jt("x"in r?r.x:void 0,e.x),Jt("y"in r?r.y:void 0,e.y),Jt("z"in r?r.z:void 0,e.z)]})}function Li(r,e){return{baseStep:ur(e),constraint:e,textProps:Ne.fromObject({draggingScale:cr(e,r),formatter:rt(Yr(e,r))})}}const Es={id:"input-point3d",type:"input",accept:(r,e)=>{if(!br.isObject(r))return null;const t=Ze,n=ht(e,{x:t.optional.custom(Ht),y:t.optional.custom(Ht),z:t.optional.custom(Ht)});return n?{initialValue:r,params:n}:null},binding:{reader:r=>ki,constraint:r=>xs(r.params,r.initialValue),equals:br.equals,writer:r=>ys},controller:r=>{const e=r.value,t=r.constraint;if(!(t instanceof hr))throw De.shouldNeverHappen();return new Aa(r.document,{assembly:Ti,axes:[Li(e.rawValue.x,t.components[0]),Li(e.rawValue.y,t.components[1]),Li(e.rawValue.z,t.components[2])],parser:_t,value:e,viewProps:r.viewProps})}};class Vr{constructor(e=0,t=0,n=0,a=0){this.x=e,this.y=t,this.z=n,this.w=a}getComponents(){return[this.x,this.y,this.z,this.w]}static isObject(e){if(Ve(e))return!1;const t=e.x,n=e.y,a=e.z,m=e.w;return!(typeof t!="number"||typeof n!="number"||typeof a!="number"||typeof m!="number")}static equals(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w}toObject(){return{x:this.x,y:this.y,z:this.z,w:this.w}}}const Ri={toComponents:r=>r.getComponents(),fromComponents:r=>new Vr(...r)};function Ra(r){return Vr.isObject(r)?new Vr(r.x,r.y,r.z,r.w):new Vr}function Cs(r,e){r.writeProperty("x",e.x),r.writeProperty("y",e.y),r.writeProperty("z",e.z),r.writeProperty("w",e.w)}function As(r,e){return new hr({assembly:Ri,components:[Jt("x"in r?r.x:void 0,e.x),Jt("y"in r?r.y:void 0,e.y),Jt("z"in r?r.z:void 0,e.z),Jt("w"in r?r.w:void 0,e.w)]})}function Ss(r,e){return{baseStep:ur(e),constraint:e,textProps:Ne.fromObject({draggingScale:cr(e,r),formatter:rt(Yr(e,r))})}}const Ps={id:"input-point4d",type:"input",accept:(r,e)=>{if(!Vr.isObject(r))return null;const t=Ze,n=ht(e,{x:t.optional.custom(Ht),y:t.optional.custom(Ht),z:t.optional.custom(Ht),w:t.optional.custom(Ht)});return n?{initialValue:r,params:n}:null},binding:{reader:r=>Ra,constraint:r=>As(r.params,r.initialValue),equals:Vr.equals,writer:r=>Cs},controller:r=>{const e=r.value,t=r.constraint;if(!(t instanceof hr))throw De.shouldNeverHappen();return new Aa(r.document,{assembly:Ri,axes:e.rawValue.getComponents().map((n,a)=>Ss(n,t.components[a])),parser:_t,value:e,viewProps:r.viewProps})}};function Oa(r){const e=[],t=Nn(r.options);return t&&e.push(t),new Kr(e)}const Ts={id:"input-string",type:"input",accept:(r,e)=>{if(typeof r!="string")return null;const n=ht(e,{options:Ze.optional.custom(bi)});return n?{initialValue:r,params:n}:null},binding:{reader:r=>oa,constraint:r=>Oa(r.params),writer:r=>Fn},controller:r=>{var e;const t=r.document,n=r.value,a=r.constraint;return a&&zt(a,Pn)?new Tn(t,{props:Ne.fromObject({options:(e=Bn(a))!==null&&e!==void 0?e:[]}),value:n,viewProps:r.viewProps}):new Sr(t,{parser:m=>m,props:Ne.fromObject({formatter:or}),value:n,viewProps:r.viewProps})}},pn={monitor:{defaultInterval:200,defaultLineCount:3}},Oi=Ge("mll");class Da{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Oi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("textarea");n.classList.add(Oi("i")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,n.readOnly=!0,t.viewProps.bindDisabled(n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.textareaElem_,t=e.scrollTop===e.scrollHeight-e.clientHeight,n=[];this.value.rawValue.forEach(a=>{a!==void 0&&n.push(this.formatter_(a))}),e.textContent=n.join(`
`),t&&(e.scrollTop=e.scrollHeight)}onValueUpdate_(){this.update_()}}class Di{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new Da(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}}const Fi=Ge("sgl");class ks{constructor(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(Fi()),t.viewProps.bindClassModifiers(this.element);const n=e.createElement("input");n.classList.add(Fi("i")),n.readOnly=!0,n.type="text",t.viewProps.bindDisabled(n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}update_(){const e=this.value.rawValue,t=e[e.length-1];this.inputElement.value=t!==void 0?this.formatter_(t):""}onValueUpdate_(){this.update_()}}class Vi{constructor(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new ks(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}}const Fa={id:"monitor-bool",type:"monitor",accept:(r,e)=>{if(typeof r!="boolean")return null;const n=ht(e,{lineCount:Ze.optional.number});return n?{initialValue:r,params:n}:null},binding:{reader:r=>yo},controller:r=>{var e;return r.value.rawValue.length===1?new Vi(r.document,{formatter:Ji,value:r.value,viewProps:r.viewProps}):new Di(r.document,{formatter:Ji,lineCount:(e=r.params.lineCount)!==null&&e!==void 0?e:pn.monitor.defaultLineCount,value:r.value,viewProps:r.viewProps})}},er=Ge("grl");class Ls{constructor(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(er()),t.viewProps.bindClassModifiers(this.element),this.formatter_=t.formatter,this.props_=t.props,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);const n=e.createElementNS(Gt,"svg");n.classList.add(er("g")),n.style.height=`calc(var(--bld-us) * ${t.lineCount})`,this.element.appendChild(n),this.svgElem_=n;const a=e.createElementNS(Gt,"polyline");this.svgElem_.appendChild(a),this.lineElem_=a;const m=e.createElement("div");m.classList.add(er("t"),Ge("tt")()),this.element.appendChild(m),this.tooltipElem_=m,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}get graphElement(){return this.svgElem_}update_(){const e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.props_.get("minValue"),a=this.props_.get("maxValue"),m=[];this.value.rawValue.forEach((je,He)=>{if(je===void 0)return;const rr=Je(He,0,t,0,e.width),Gr=Je(je,n,a,e.height,0);m.push([rr,Gr].join(","))}),this.lineElem_.setAttributeNS(null,"points",m.join(" "));const P=this.tooltipElem_,te=this.value.rawValue[this.cursor_.rawValue];if(te===void 0){P.classList.remove(er("t","a"));return}const xe=Je(this.cursor_.rawValue,0,t,0,e.width),ke=Je(te,n,a,e.height,0);P.style.left=`${xe}px`,P.style.top=`${ke}px`,P.textContent=`${this.formatter_(te)}`,P.classList.contains(er("t","a"))||(P.classList.add(er("t","a"),er("t","in")),ai(P),P.classList.remove(er("t","in")))}onValueUpdate_(){this.update_()}onCursorChange_(){this.update_()}}class Va{constructor(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.props_=t.props,this.value=t.value,this.viewProps=t.viewProps,this.cursor_=mt(-1),this.view=new Ls(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,props:this.props_,value:this.value,viewProps:this.viewProps}),!oi(e))this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_);else{const n=new sr(this.view.element);n.emitter.on("down",this.onGraphPointerDown_),n.emitter.on("move",this.onGraphPointerMove_),n.emitter.on("up",this.onGraphPointerUp_)}}onGraphMouseLeave_(){this.cursor_.rawValue=-1}onGraphMouseMove_(e){const t=this.view.element.getBoundingClientRect();this.cursor_.rawValue=Math.floor(Je(e.offsetX,0,t.width,0,this.value.rawValue.length))}onGraphPointerDown_(e){this.onGraphPointerMove_(e)}onGraphPointerMove_(e){if(!e.data.point){this.cursor_.rawValue=-1;return}this.cursor_.rawValue=Math.floor(Je(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length))}onGraphPointerUp_(){this.cursor_.rawValue=-1}}function $n(r){return"format"in r&&!Ve(r.format)?r.format:rt(2)}function Kn(r){var e;return r.value.rawValue.length===1?new Vi(r.document,{formatter:$n(r.params),value:r.value,viewProps:r.viewProps}):new Di(r.document,{formatter:$n(r.params),lineCount:(e=r.params.lineCount)!==null&&e!==void 0?e:pn.monitor.defaultLineCount,value:r.value,viewProps:r.viewProps})}function Rs(r){var e,t,n;return new Va(r.document,{formatter:$n(r.params),lineCount:(e=r.params.lineCount)!==null&&e!==void 0?e:pn.monitor.defaultLineCount,props:Ne.fromObject({maxValue:(t="max"in r.params?r.params.max:null)!==null&&t!==void 0?t:100,minValue:(n="min"in r.params?r.params.min:null)!==null&&n!==void 0?n:0}),value:r.value,viewProps:r.viewProps})}function Xn(r){return"view"in r&&r.view==="graph"}const tr={id:"monitor-number",type:"monitor",accept:(r,e)=>{if(typeof r!="number")return null;const t=Ze,n=ht(e,{format:t.optional.function,lineCount:t.optional.number,max:t.optional.number,min:t.optional.number,view:t.optional.string});return n?{initialValue:r,params:n}:null},binding:{defaultBufferSize:r=>Xn(r)?64:1,reader:r=>Lo},controller:r=>Xn(r.params)?Rs(r):Kn(r)},qn={id:"monitor-string",type:"monitor",accept:(r,e)=>{if(typeof r!="string")return null;const t=Ze,n=ht(e,{lineCount:t.optional.number,multiline:t.optional.boolean});return n?{initialValue:r,params:n}:null},binding:{reader:r=>oa},controller:r=>{var e;const t=r.value;return t.rawValue.length>1||"multiline"in r.params&&r.params.multiline?new Di(r.document,{formatter:or,lineCount:(e=r.params.lineCount)!==null&&e!==void 0?e:pn.monitor.defaultLineCount,value:t,viewProps:r.viewProps}):new Vi(r.document,{formatter:or,value:t,viewProps:r.viewProps})}};class Nr{constructor(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new Ye,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}read(){const e=this.target.read();e!==void 0&&(this.value.rawValue=this.reader(e))}write_(e){this.writer(this.target,e)}onValueChange_(e){this.write_(e.rawValue),this.emitter.emit("change",{options:e.options,rawValue:e.rawValue,sender:this})}}function Wn(r,e){const t=r.accept(e.target.read(),e.params);if(Ve(t))return null;const n=Ze,a={target:e.target,initialValue:t.initialValue,params:t.params},m=r.binding.reader(a),P=r.binding.constraint?r.binding.constraint(a):void 0,te=mt(m(t.initialValue),{constraint:P,equals:r.binding.equals}),xe=new Nr({reader:m,target:e.target,value:te,writer:r.binding.writer(a)}),ke=n.optional.boolean(e.params.disabled).value,je=n.optional.boolean(e.params.hidden).value,He=r.controller({constraint:P,document:e.document,initialValue:t.initialValue,params:t.params,value:xe.value,viewProps:ir.create({disabled:ke,hidden:je})}),rr=n.optional.string(e.params.label).value;return new Ut(e.document,{binding:xe,blade:qt(),props:Ne.fromObject({label:rr!=null?rr:e.target.key}),valueController:He})}class Yn{constructor(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new Ye,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}dispose(){this.ticker.dispose()}read(){const e=this.target.read();if(e===void 0)return;const t=this.value.rawValue,n=this.reader_(e);this.value.rawValue=Gl(t,n),this.emitter.emit("update",{rawValue:n,sender:this})}onTick_(e){this.read()}}function Br(r,e){return e===0?new xl:new fi(r,e!=null?e:pn.monitor.defaultInterval)}function Mr(r,e){var t,n,a;const m=Ze,P=r.accept(e.target.read(),e.params);if(Ve(P))return null;const te={target:e.target,initialValue:P.initialValue,params:P.params},xe=r.binding.reader(te),ke=(n=(t=m.optional.number(e.params.bufferSize).value)!==null&&t!==void 0?t:r.binding.defaultBufferSize&&r.binding.defaultBufferSize(P.params))!==null&&n!==void 0?n:1,je=m.optional.number(e.params.interval).value,He=new Yn({reader:xe,target:e.target,ticker:Br(e.document,je),value:Tr(ke)}),rr=m.optional.boolean(e.params.disabled).value,Gr=m.optional.boolean(e.params.hidden).value,_r=r.controller({document:e.document,params:P.params,value:He.value,viewProps:ir.create({disabled:rr,hidden:Gr})}),nr=(a=m.optional.string(e.params.label).value)!==null&&a!==void 0?a:e.target.key;return new Wt(e.document,{binding:He,blade:qt(),props:Ne.fromObject({label:nr}),valueController:_r})}class Ir{constructor(){this.pluginsMap_={blades:[],inputs:[],monitors:[]}}getAll(){return[...this.pluginsMap_.blades,...this.pluginsMap_.inputs,...this.pluginsMap_.monitors]}register(e){e.type==="blade"?this.pluginsMap_.blades.unshift(e):e.type==="input"?this.pluginsMap_.inputs.unshift(e):e.type==="monitor"&&this.pluginsMap_.monitors.unshift(e)}createInput(e,t,n){const a=t.read();if(Ve(a))throw new De({context:{key:t.key},type:"nomatchingcontroller"});const m=this.pluginsMap_.inputs.reduce((P,te)=>P!=null?P:Wn(te,{document:e,target:t,params:n}),null);if(m)return m;throw new De({context:{key:t.key},type:"nomatchingcontroller"})}createMonitor(e,t,n){const a=this.pluginsMap_.monitors.reduce((m,P)=>m!=null?m:Mr(P,{document:e,params:n,target:t}),null);if(a)return a;throw new De({context:{key:t.key},type:"nomatchingcontroller"})}createBlade(e,t){const n=this.pluginsMap_.blades.reduce((a,m)=>a!=null?a:yl(m,{document:e,params:t}),null);if(!n)throw new De({type:"nomatchingview",context:{params:t}});return n}createBladeApi(e){if(e instanceof Ut)return new Xi(e);if(e instanceof Wt)return new ui(e);if(e instanceof qe)return new ci(e,this);const t=this.pluginsMap_.blades.reduce((n,a)=>n!=null?n:a.api({controller:e,pool:this}),null);if(!t)throw De.shouldNeverHappen();return t}}function Ni(){const r=new Ir;return[La,Es,Ps,Ts,_s,fu,du,lu,Bo,Fa,qn,tr,Cr,pl,vl,_o].forEach(e=>{r.register(e)}),r}class Qn extends H{constructor(e){super(e),this.emitter_=new Ye,this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new Te(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get options(){return this.controller_.valueController.props.get("options")}set options(e){this.controller_.valueController.props.set("options",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}}class hn extends H{constructor(e){super(e),this.emitter_=new Ye,this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new Te(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get maxValue(){return this.controller_.valueController.sliderController.props.get("maxValue")}set maxValue(e){this.controller_.valueController.sliderController.props.set("maxValue",e)}get minValue(){return this.controller_.valueController.sliderController.props.get("minValue")}set minValue(e){this.controller_.valueController.sliderController.props.set("minValue",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}}class Bi extends H{constructor(e){super(e),this.emitter_=new Ye,this.controller_.valueController.value.emitter.on("change",t=>{this.emitter_.emit("change",{event:new Te(this,t.rawValue)})})}get label(){return this.controller_.props.get("label")}set label(e){this.controller_.props.set("label",e)}get formatter(){return this.controller_.valueController.props.get("formatter")}set formatter(e){this.controller_.valueController.props.set("formatter",e)}get value(){return this.controller_.valueController.value.rawValue}set value(e){this.controller_.valueController.value.rawValue=e}on(e,t){const n=t.bind(this);return this.emitter_.on(e,a=>{n(a.event)}),this}}const Na=function(){return{id:"list",type:"blade",accept(r){const e=Ze,t=ht(r,{options:e.required.custom(bi),value:e.required.raw,view:e.required.constant("list"),label:e.optional.string});return t?{params:t}:null},controller(r){const e=new Tn(r.document,{props:Ne.fromObject({options:Vn(r.params.options)}),value:mt(r.params.value),viewProps:r.viewProps});return new $r(r.document,{blade:r.blade,props:Ne.fromObject({label:r.params.label}),valueController:e})},api(r){return!(r.controller instanceof $r)||!(r.controller.valueController instanceof Tn)?null:new Qn(r.controller)}}}();function vn(r){return r.reduce((e,t)=>Object.assign(e,{[t.presetKey]:t.read()}),{})}function mn(r,e){r.forEach(t=>{const n=e[t.presetKey];n!==void 0&&t.write(n)})}class bu extends qi{constructor(e,t){super(e,t)}get element(){return this.controller_.view.element}importPreset(e){const t=this.controller_.rackController.rack.find(Ut).map(n=>n.binding.target);mn(t,e),this.refresh()}exportPreset(){const e=this.controller_.rackController.rack.find(Ut).map(t=>t.binding.target);return vn(e)}refresh(){this.controller_.rackController.rack.find(Ut).forEach(e=>{e.binding.read()}),this.controller_.rackController.rack.find(Wt).forEach(e=>{e.binding.read()})}}class _u extends Qi{constructor(e,t){super(e,{expanded:t.expanded,blade:t.blade,props:t.props,root:!0,viewProps:t.viewProps})}}const Os={id:"slider",type:"blade",accept(r){const e=Ze,t=ht(r,{max:e.required.number,min:e.required.number,view:e.required.constant("slider"),format:e.optional.function,label:e.optional.string,value:e.optional.number});return t?{params:t}:null},controller(r){var e,t;const n=(e=r.params.value)!==null&&e!==void 0?e:0,a=new da(r.document,{baseStep:1,parser:_t,sliderProps:Ne.fromObject({maxValue:r.params.max,minValue:r.params.min}),textProps:Ne.fromObject({draggingScale:cr(void 0,n),formatter:(t=r.params.format)!==null&&t!==void 0?t:Ml}),value:mt(n),viewProps:r.viewProps});return new $r(r.document,{blade:r.blade,props:Ne.fromObject({label:r.params.label}),valueController:a})},api(r){return!(r.controller instanceof $r)||!(r.controller.valueController instanceof da)?null:new hn(r.controller)}},Ds=function(){return{id:"text",type:"blade",accept(r){const e=Ze,t=ht(r,{parse:e.required.function,value:e.required.raw,view:e.required.constant("text"),format:e.optional.function,label:e.optional.string});return t?{params:t}:null},controller(r){var e;const t=new Sr(r.document,{parser:r.params.parse,props:Ne.fromObject({formatter:(e=r.params.format)!==null&&e!==void 0?e:n=>String(n)}),value:mt(r.params.value),viewProps:r.viewProps});return new $r(r.document,{blade:r.blade,props:Ne.fromObject({label:r.params.label}),valueController:t})},api(r){return!(r.controller instanceof $r)||!(r.controller.valueController instanceof Sr)?null:new Bi(r.controller)}}}();function Fs(r){const e=r.createElement("div");return e.classList.add(Ge("dfw")()),r.body&&r.body.appendChild(e),e}function Vs(r,e,t){if(r.querySelector(`style[data-tp-style=${e}]`))return;const n=r.createElement("style");n.dataset.tpStyle=e,n.textContent=t,r.head.appendChild(n)}class bn extends bu{constructor(e){var t,n;const a=e!=null?e:{},m=(t=a.document)!==null&&t!==void 0?t:Ja(),P=Ni(),te=new _u(m,{expanded:a.expanded,blade:qt(),props:Ne.fromObject({title:a.title}),viewProps:ir.create()});super(te,P),this.pool_=P,this.containerElem_=(n=a.container)!==null&&n!==void 0?n:Fs(m),this.containerElem_.appendChild(this.element),this.doc_=m,this.usesDefaultWrapper_=!a.container,this.setUpDefaultPlugins_()}get document(){if(!this.doc_)throw De.alreadyDisposed();return this.doc_}dispose(){const e=this.containerElem_;if(!e)throw De.alreadyDisposed();if(this.usesDefaultWrapper_){const t=e.parentElement;t&&t.removeChild(e)}this.containerElem_=null,this.doc_=null,super.dispose()}registerPlugin(e){("plugin"in e?[e.plugin]:"plugins"in e?e.plugins:[]).forEach(n=>{this.pool_.register(n),this.embedPluginStyle_(n)})}embedPluginStyle_(e){e.css&&Vs(this.document,`plugin-${e.id}`,e.css)}setUpDefaultPlugins_(){Vs(this.document,"default",'.tp-tbiv_b,.tp-coltxtv_ms,.tp-ckbv_i,.tp-rotv_b,.tp-fldv_b,.tp-mllv_i,.tp-sglv_i,.tp-grlv_g,.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw,.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-p2dv_b,.tp-btnv_b,.tp-lstv_s{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-us);line-height:var(--bld-us);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-p2dv_b:hover,.tp-btnv_b:hover,.tp-lstv_s:hover{background-color:var(--btn-bg-h)}.tp-p2dv_b:focus,.tp-btnv_b:focus,.tp-lstv_s:focus{background-color:var(--btn-bg-f)}.tp-p2dv_b:active,.tp-btnv_b:active,.tp-lstv_s:active{background-color:var(--btn-bg-a)}.tp-p2dv_b:disabled,.tp-btnv_b:disabled,.tp-lstv_s:disabled{opacity:.5}.tp-txtv_i,.tp-p2dpv_p,.tp-colswv_sw{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-txtv_i:hover,.tp-p2dpv_p:hover,.tp-colswv_sw:hover{background-color:var(--in-bg-h)}.tp-txtv_i:focus,.tp-p2dpv_p:focus,.tp-colswv_sw:focus{background-color:var(--in-bg-f)}.tp-txtv_i:active,.tp-p2dpv_p:active,.tp-colswv_sw:active{background-color:var(--in-bg-a)}.tp-txtv_i:disabled,.tp-p2dpv_p:disabled,.tp-colswv_sw:disabled{opacity:.5}.tp-mllv_i,.tp-sglv_i,.tp-grlv_g{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-us);scrollbar-color:currentColor transparent;scrollbar-width:thin;width:100%}.tp-mllv_i::-webkit-scrollbar,.tp-sglv_i::-webkit-scrollbar,.tp-grlv_g::-webkit-scrollbar{height:8px;width:8px}.tp-mllv_i::-webkit-scrollbar-corner,.tp-sglv_i::-webkit-scrollbar-corner,.tp-grlv_g::-webkit-scrollbar-corner{background-color:transparent}.tp-mllv_i::-webkit-scrollbar-thumb,.tp-sglv_i::-webkit-scrollbar-thumb,.tp-grlv_g::-webkit-scrollbar-thumb{background-clip:padding-box;background-color:currentColor;border:transparent solid 2px;border-radius:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono, Source Code Pro, Menlo, Courier, monospace);--bs-br: var(--tp-base-border-radius, 6px);--cnt-h-p: var(--tp-container-horizontal-padding, 4px);--cnt-v-p: var(--tp-container-vertical-padding, 4px);--elm-br: var(--tp-element-border-radius, 2px);--bld-s: var(--tp-blade-spacing, 4px);--bld-us: var(--tp-blade-unit-size, 20px);--bs-bg: var(--tp-base-background-color, #28292e);--bs-sh: var(--tp-base-shadow-color, rgba(0, 0, 0, 0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #28292e);--cnt-bg: var(--tp-container-background-color, rgba(187, 188, 196, 0.1));--cnt-bg-a: var(--tp-container-background-color-active, rgba(187, 188, 196, 0.25));--cnt-bg-f: var(--tp-container-background-color-focus, rgba(187, 188, 196, 0.2));--cnt-bg-h: var(--tp-container-background-color-hover, rgba(187, 188, 196, 0.15));--cnt-fg: var(--tp-container-foreground-color, #bbbcc4);--in-bg: var(--tp-input-background-color, rgba(187, 188, 196, 0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(187, 188, 196, 0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(187, 188, 196, 0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(187, 188, 196, 0.15));--in-fg: var(--tp-input-foreground-color, #bbbcc4);--lbl-fg: var(--tp-label-foreground-color, rgba(187, 188, 196, 0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0, 0, 0, 0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(187, 188, 196, 0.7));--grv-fg: var(--tp-groove-foreground-color, rgba(187, 188, 196, 0.1))}.tp-rotv_c>.tp-cntv.tp-v-lst,.tp-tabv_c .tp-brkv>.tp-cntv.tp-v-lst,.tp-fldv_c>.tp-cntv.tp-v-lst{margin-bottom:calc(-1*var(--cnt-v-p))}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_c,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_c{border-bottom-left-radius:0}.tp-rotv_c>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-tabv_c .tp-brkv>.tp-fldv.tp-v-lst .tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-v-lst .tp-fldv_b{border-bottom-left-radius:0}.tp-rotv_c>*:not(.tp-v-fst),.tp-tabv_c .tp-brkv>*:not(.tp-v-fst),.tp-fldv_c>*:not(.tp-v-fst){margin-top:var(--bld-s)}.tp-rotv_c>.tp-sprv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-fst),.tp-fldv_c>.tp-sprv:not(.tp-v-fst),.tp-rotv_c>.tp-cntv:not(.tp-v-fst),.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-fst),.tp-fldv_c>.tp-cntv:not(.tp-v-fst){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-sprv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-cntv+*:not(.tp-v-hidden),.tp-tabv_c .tp-brkv>.tp-cntv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-cntv+*:not(.tp-v-hidden){margin-top:var(--cnt-v-p)}.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-tabv_c .tp-brkv>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-tabv_c .tp-brkv>.tp-cntv:not(.tp-v-hidden)+.tp-cntv,.tp-fldv_c>.tp-cntv:not(.tp-v-hidden)+.tp-cntv{margin-top:0}.tp-tabv_c .tp-brkv>.tp-cntv,.tp-fldv_c>.tp-cntv{margin-left:4px}.tp-tabv_c .tp-brkv>.tp-fldv>.tp-fldv_b,.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-fldv.tp-fldv-expanded>.tp-fldv_b,.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-tabv_c .tp-brkv .tp-fldv>.tp-fldv_c,.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv>.tp-tabv>.tp-tabv_i,.tp-fldv_c>.tp-tabv>.tp-tabv_i{border-top-left-radius:var(--elm-br)}.tp-tabv_c .tp-brkv .tp-tabv>.tp-tabv_c,.tp-fldv_c .tp-tabv>.tp-tabv_c{border-bottom-left-radius:var(--elm-br)}.tp-rotv_b,.tp-fldv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);overflow:hidden;padding-left:var(--cnt-h-p);padding-right:calc(4px + var(--bld-us) + var(--cnt-h-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-rotv_b:hover,.tp-fldv_b:hover{background-color:var(--cnt-bg-h)}.tp-rotv_b:focus,.tp-fldv_b:focus{background-color:var(--cnt-bg-f)}.tp-rotv_b:active,.tp-fldv_b:active{background-color:var(--cnt-bg-a)}.tp-rotv_b:disabled,.tp-fldv_b:disabled{opacity:.5}.tp-rotv_m,.tp-fldv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:"";display:block;height:6px;right:calc(var(--cnt-h-p) + (var(--bld-us) + 4px - 6px)/2 - 2px);margin:auto;opacity:.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-rotv.tp-rotv-expanded .tp-rotv_m,.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m{transform:none}.tp-rotv_c,.tp-fldv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-rotv.tp-rotv-cpl:not(.tp-rotv-expanded) .tp-rotv_c,.tp-fldv.tp-fldv-cpl:not(.tp-fldv-expanded)>.tp-fldv_c{display:none}.tp-rotv.tp-rotv-expanded .tp-rotv_c,.tp-fldv.tp-fldv-expanded>.tp-fldv_c{opacity:1;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-lstv,.tp-coltxtv_m{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m,.tp-coltxtv_mm{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-lstv_m svg,.tp-coltxtv_mm svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-lstv_m svg path,.tp-coltxtv_mm svg path{fill:currentColor}.tp-pndtxtv,.tp-coltxtv_w{display:flex}.tp-pndtxtv_a,.tp-coltxtv_c{width:100%}.tp-pndtxtv_a+.tp-pndtxtv_a,.tp-coltxtv_c+.tp-pndtxtv_a,.tp-pndtxtv_a+.tp-coltxtv_c,.tp-coltxtv_c+.tp-coltxtv_c{margin-left:2px}.tp-btnv_b{width:100%}.tp-btnv_t{text-align:center}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-us);position:relative;width:var(--bld-us)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:.5}.tp-colv{position:relative}.tp-colv_h{display:flex}.tp-colv_s{flex-grow:0;flex-shrink:0;width:var(--bld-us)}.tp-colv_t{flex:1;margin-left:4px}.tp-colv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-colv.tp-colv-cpl .tp-colv_p{overflow:visible}.tp-colv.tp-colv-expanded .tp-colv_p{margin-top:var(--bld-s);opacity:1}.tp-colv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-colpv_h,.tp-colpv_ap{margin-left:6px;margin-right:6px}.tp-colpv_h{margin-top:var(--bld-s)}.tp-colpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-colpv_a{display:flex;margin-top:var(--cnt-v-p);padding-top:calc(var(--cnt-v-p) + 2px);position:relative}.tp-colpv_a:before{background-color:var(--grv-fg);content:"";height:2px;left:calc(-1*var(--cnt-h-p));position:absolute;right:calc(-1*var(--cnt-h-p));top:0}.tp-colpv_ap{align-items:center;display:flex;flex:3}.tp-colpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-us)*4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0, 0, 0, 0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-us);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-colswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br);overflow:hidden}.tp-colswv.tp-v-disabled{opacity:.5}.tp-colswv_sw{border-radius:0}.tp-colswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-us);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-us)}.tp-colswv_b:focus::after{border:rgba(255,255,255,.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:"";display:block;left:0;position:absolute;right:0;top:0}.tp-coltxtv{display:flex;width:100%}.tp-coltxtv_m{margin-right:4px}.tp-coltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-us);line-height:var(--bld-us);padding:0 18px 0 4px}.tp-coltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-coltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-coltxtv_ms:active{background-color:var(--in-bg-a)}.tp-coltxtv_mm{color:var(--lbl-fg)}.tp-coltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv_t{padding-left:4px}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-us)*3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left .05s,top .05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-h-p);padding-right:var(--cnt-h-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:160px}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:.5}.tp-mllv_i{display:block;height:calc(var(--bld-us)*3);line-height:var(--bld-us);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:.5}.tp-p2dv{position:relative}.tp-p2dv_h{display:flex}.tp-p2dv_b{height:var(--bld-us);margin-right:4px;position:relative;width:var(--bld-us)}.tp-p2dv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dv_b svg circle{fill:currentColor}.tp-p2dv_t{flex:1}.tp-p2dv_p{height:0;margin-top:0;opacity:0;overflow:hidden;transition:height .2s ease-in-out,opacity .2s linear,margin .2s ease-in-out}.tp-p2dv.tp-p2dv-expanded .tp-p2dv_p{margin-top:var(--bld-s);opacity:1}.tp-p2dv .tp-popv{left:calc(-1*var(--cnt-h-p));right:calc(-1*var(--cnt-h-p));top:var(--bld-us)}.tp-p2dpv{padding-left:calc(var(--bld-us) + 4px)}.tp-p2dpv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpv_ax{opacity:.1;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_l{opacity:.5;stroke:var(--in-fg);stroke-dasharray:1}.tp-p2dpv_m{border:var(--in-fg) solid 1px;border-radius:50%;box-sizing:border-box;height:4px;margin-left:-2px;margin-top:-2px;position:absolute;width:4px}.tp-p2dpv_p:focus .tp-p2dpv_m{background-color:var(--in-fg);border-width:0}.tp-popv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-v-p) var(--cnt-h-p);position:absolute;visibility:hidden;z-index:1000}.tp-popv.tp-popv-v{display:block;visibility:visible}.tp-sprv_r{background-color:var(--grv-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-us);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:"";display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-tabv.tp-v-disabled{opacity:.5}.tp-tabv_i{align-items:flex-end;display:flex;overflow:hidden}.tp-tabv.tp-tabv-nop .tp-tabv_i{height:calc(var(--bld-us) + 4px);position:relative}.tp-tabv.tp-tabv-nop .tp-tabv_i::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:0;position:absolute;right:0}.tp-tabv_c{border-left:var(--cnt-bg) solid 4px;padding-bottom:var(--cnt-v-p);padding-top:var(--cnt-v-p)}.tp-tbiv{flex:1;min-width:0;position:relative}.tp-tbiv+.tp-tbiv{margin-left:2px}.tp-tbiv+.tp-tbiv::before{background-color:var(--cnt-bg);bottom:0;content:"";height:2px;left:-2px;position:absolute;width:2px}.tp-tbiv_b{background-color:var(--cnt-bg);display:block;padding-left:calc(var(--cnt-h-p) + 4px);padding-right:calc(var(--cnt-h-p) + 4px);width:100%}.tp-tbiv_b:hover{background-color:var(--cnt-bg-h)}.tp-tbiv_b:focus{background-color:var(--cnt-bg-f)}.tp-tbiv_b:active{background-color:var(--cnt-bg-a)}.tp-tbiv_b:disabled{opacity:.5}.tp-tbiv_t{color:var(--cnt-fg);height:calc(var(--bld-us) + 4px);line-height:calc(var(--bld-us) + 4px);opacity:.5;overflow:hidden;text-overflow:ellipsis}.tp-tbiv.tp-tbiv-sel .tp-tbiv_t{opacity:1}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:.3}.tp-txtv_k{cursor:pointer;height:100%;left:-3px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:"";height:calc(var(--bld-us) - 4px);left:50%;margin-bottom:auto;margin-left:-1px;margin-top:auto;opacity:.1;position:absolute;top:0;transition:border-radius .1s,height .1s,transform .1s,width .1s;width:2px}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:50%;height:4px;transform:translateX(-1px);width:4px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:1}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:"";font-size:.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(4px + var(--bld-us) + var(--cnt-h-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-lst>.tp-fldv_c,.tp-rotv_c>.tp-tabv.tp-v-lst>.tp-tabv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-lst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c .tp-fldv.tp-v-vlst:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-fldv.tp-v-fst>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst{margin-top:calc(-1*var(--cnt-v-p))}.tp-rotv.tp-rotv-not .tp-rotv_c>.tp-tabv.tp-v-fst>.tp-tabv_i{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}'),this.pool_.getAll().forEach(e=>{this.embedPluginStyle_(e)}),this.registerPlugin({plugins:[Os,Na,_o,Ds]})}}const Ba=new pe("3.1.0");Z.BladeApi=H,Z.ButtonApi=zr,Z.FolderApi=qi,Z.InputBindingApi=Xi,Z.ListApi=Qn,Z.MonitorBindingApi=ui,Z.Pane=bn,Z.SeparatorApi=lo,Z.SliderApi=hn,Z.TabApi=vo,Z.TabPageApi=ho,Z.TextApi=Bi,Z.TpChangeEvent=Te,Z.VERSION=Ba,Object.defineProperty(Z,"__esModule",{value:!0})})})(Tu,Tu.exports);var Yu={exports:{}};(function(Ie,me){(function(Z,pe){Ie.exports=pe()})(ku,function(){var Z=function(i){return i instanceof Uint8Array||i instanceof Uint16Array||i instanceof Uint32Array||i instanceof Int8Array||i instanceof Int16Array||i instanceof Int32Array||i instanceof Float32Array||i instanceof Float64Array||i instanceof Uint8ClampedArray},pe=function(i,s){for(var h=Object.keys(s),T=0;T<h.length;++T)i[h[T]]=s[h[T]];return i},H=`
`;function Ae(i){return typeof atob!="undefined"?atob(i):"base64:"+i}function Te(i){var s=new Error("(regl) "+i);throw console.error(s),s}function Se(i,s){i||Te(s)}function Qe(i){return i?": "+i:""}function Xe(i,s,h){i in s||Te("unknown parameter ("+i+")"+Qe(h)+". possible values: "+Object.keys(s).join())}function Mt(i,s){Z(i)||Te("invalid parameter type"+Qe(s)+". must be a typed array")}function Ve(i,s){switch(s){case"number":return typeof i=="number";case"object":return typeof i=="object";case"string":return typeof i=="string";case"boolean":return typeof i=="boolean";case"function":return typeof i=="function";case"undefined":return typeof i=="undefined";case"symbol":return typeof i=="symbol"}}function Pt(i,s,h){Ve(i,s)||Te("invalid parameter type"+Qe(h)+". expected "+s+", got "+typeof i)}function Gi(i,s){i>=0&&(i|0)===i||Te("invalid parameter type, ("+i+")"+Qe(s)+". must be a nonnegative integer")}function De(i,s,h){s.indexOf(i)<0&&Te("invalid value"+Qe(h)+". must be one of: "+s)}var xt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function zr(i){Object.keys(i).forEach(function(s){xt.indexOf(s)<0&&Te('invalid regl constructor argument "'+s+'". must be one of '+xt)})}function Ye(i,s){for(i=i+"";i.length<s;)i=" "+i;return i}function Ui(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Ge(i,s){this.number=i,this.line=s,this.errors=[]}function $a(i,s,h){this.file=i,this.line=s,this.message=h}function xr(){var i=new Error,s=(i.stack||i).toString(),h=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(s);if(h)return h[1];var T=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(s);return T?T[1]:"unknown"}function Er(){var i=new Error,s=(i.stack||i).toString(),h=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(s);if(h)return h[1];var T=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(s);return T?T[1]:"unknown"}function Et(i,s){var h=i.split(`
`),T=1,V=0,S={unknown:new Ui,0:new Ui};S.unknown.name=S[0].name=s||xr(),S.unknown.lines.push(new Ge(0,""));for(var R=0;R<h.length;++R){var U=h[R],G=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(U);if(G)switch(G[1]){case"line":var X=/(\d+)(\s+\d+)?/.exec(G[2]);X&&(T=X[1]|0,X[2]&&(V=X[2]|0,V in S||(S[V]=new Ui)));break;case"define":var W=/SHADER_NAME(_B64)?\s+(.*)$/.exec(G[2]);W&&(S[V].name=W[1]?Ae(W[2]):W[2]);break}S[V].lines.push(new Ge(T++,U))}return Object.keys(S).forEach(function(q){var Q=S[q];Q.lines.forEach(function(z){Q.index[z.number]=z})}),S}function Ws(i){var s=[];return i.split(`
`).forEach(function(h){if(!(h.length<5)){var T=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(h);T?s.push(new $a(T[1]|0,T[2]|0,T[3].trim())):h.length>0&&s.push(new $a("unknown",0,h))}}),s}function jr(i,s){s.forEach(function(h){var T=i[h.file];if(T){var V=T.index[h.line];if(V){V.errors.push(h),T.hasErrors=!0;return}}i.unknown.hasErrors=!0,i.unknown.lines[0].errors.push(h)})}function zi(i,s,h,T,V){if(!i.getShaderParameter(s,i.COMPILE_STATUS)){var S=i.getShaderInfoLog(s),R=T===i.FRAGMENT_SHADER?"fragment":"vertex";Ne(h,"string",R+" shader source must be a string",V);var U=Et(h,V),G=Ws(S);jr(U,G),Object.keys(U).forEach(function(X){var W=U[X];if(!W.hasErrors)return;var q=[""],Q=[""];function z(K,y){q.push(K),Q.push(y||"")}z("file number "+X+": "+W.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),W.lines.forEach(function(K){if(K.errors.length>0){z(Ye(K.number,4)+"|  ","background-color:yellow; font-weight:bold"),z(K.line+H,"color:red; background-color:yellow; font-weight:bold");var y=0;K.errors.forEach(function(L){var $=L.message,se=/^\s*'(.*)'\s*:\s*(.*)$/.exec($);if(se){var I=se[1];switch($=se[2],I){case"assign":I="=";break}y=Math.max(K.line.indexOf(I,y),0)}else y=0;z(Ye("| ",6)),z(Ye("^^^",y+3)+H,"font-weight:bold"),z(Ye("| ",6)),z($+H,"font-weight:bold")}),z(Ye("| ",6)+H)}else z(Ye(K.number,4)+"|  "),z(K.line+H,"color:red")}),typeof document!="undefined"&&!window.chrome?(Q[0]=q.join("%c"),console.log.apply(console,Q)):console.log(q.join(""))}),Se.raise("Error compiling "+R+" shader, "+U[0].name)}}function ji(i,s,h,T,V){if(!i.getProgramParameter(s,i.LINK_STATUS)){var S=i.getProgramInfoLog(s),R=Et(h,V),U=Et(T,V),G='Error linking program with vertex shader, "'+U[0].name+'", and fragment shader "'+R[0].name+'"';typeof document!="undefined"?console.log("%c"+G+H+"%c"+S,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(G+H+S),Se.raise(G)}}function Ka(i){i._commandRef=xr()}function Xa(i,s,h,T){Ka(i);function V(G){return G?T.id(G):0}i._fragId=V(i.static.frag),i._vertId=V(i.static.vert);function S(G,X){Object.keys(X).forEach(function(W){G[T.id(W)]=!0})}var R=i._uniformSet={};S(R,s.static),S(R,s.dynamic);var U=i._attributeSet={};S(U,h.static),S(U,h.dynamic),i._hasCount="count"in i.static||"count"in i.dynamic||"elements"in i.static||"elements"in i.dynamic}function ni(i,s){var h=Er();Te(i+" in command "+(s||xr())+(h==="unknown"?"":" called from "+h))}function Ys(i,s,h){i||ni(s,h||xr())}function mt(i,s,h,T){i in s||ni("unknown parameter ("+i+")"+Qe(h)+". possible values: "+Object.keys(s).join(),T||xr())}function Ne(i,s,h,T){Ve(i,s)||ni("invalid parameter type"+Qe(h)+". expected "+s+", got "+typeof i,T||xr())}function Qs(i){i()}function Zs(i,s,h){i.texture?De(i.texture._texture.internalformat,s,"unsupported texture format for attachment"):De(i.renderbuffer._renderbuffer.format,h,"unsupported renderbuffer format for attachment")}var ii=33071,It=9728,qa=9984,Ze=9985,ht=9986,Js=9987,el=5120,Wa=5121,Ya=5122,xn=5123,Gt=5124,ai=5125,Qa=5126,oi=32819,Za=32820,Ja=33635,eo=34042,tl=36193,bt={};bt[el]=bt[Wa]=1,bt[Ya]=bt[xn]=bt[tl]=bt[Ja]=bt[oi]=bt[Za]=2,bt[Gt]=bt[ai]=bt[Qa]=bt[eo]=4;function Hi(i,s){return i===Za||i===oi||i===Ja?2:i===eo?4:bt[i]*s}function En(i){return!(i&i-1)&&!!i}function to(i,s,h){var T,V=s.width,S=s.height,R=s.channels;Se(V>0&&V<=h.maxTextureSize&&S>0&&S<=h.maxTextureSize,"invalid texture shape"),(i.wrapS!==ii||i.wrapT!==ii)&&Se(En(V)&&En(S),"incompatible wrap mode for texture, both width and height must be power of 2"),s.mipmask===1?V!==1&&S!==1&&Se(i.minFilter!==qa&&i.minFilter!==ht&&i.minFilter!==Ze&&i.minFilter!==Js,"min filter requires mipmap"):(Se(En(V)&&En(S),"texture must be a square power of 2 to support mipmapping"),Se(s.mipmask===(V<<1)-1,"missing or incomplete mipmap data")),s.type===Qa&&(h.extensions.indexOf("oes_texture_float_linear")<0&&Se(i.minFilter===It&&i.magFilter===It,"filter not supported, must enable oes_texture_float_linear"),Se(!i.genMipmaps,"mipmap generation not supported with float textures"));var U=s.images;for(T=0;T<16;++T)if(U[T]){var G=V>>T,X=S>>T;Se(s.mipmask&1<<T,"missing mipmap data");var W=U[T];if(Se(W.width===G&&W.height===X,"invalid shape for mip images"),Se(W.format===s.format&&W.internalformat===s.internalformat&&W.type===s.type,"incompatible type for mip image"),!W.compressed)if(W.data){var q=Math.ceil(Hi(W.type,R)*G/W.unpackAlignment)*W.unpackAlignment;Se(W.data.byteLength===q*X,"invalid data for image, buffer size is inconsistent with image format")}else W.element||W.copy}else i.genMipmaps||Se((s.mipmask&1<<T)===0,"extra mipmap data");s.compressed&&Se(!i.genMipmaps,"mipmap generation for compressed images not supported")}function rl(i,s,h,T){var V=i.width,S=i.height,R=i.channels;Se(V>0&&V<=T.maxTextureSize&&S>0&&S<=T.maxTextureSize,"invalid texture shape"),Se(V===S,"cube map must be square"),Se(s.wrapS===ii&&s.wrapT===ii,"wrap mode not supported by cube map");for(var U=0;U<h.length;++U){var G=h[U];Se(G.width===V&&G.height===S,"inconsistent cube map face shape"),s.genMipmaps&&(Se(!G.compressed,"can not generate mipmap for compressed textures"),Se(G.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var X=G.images,W=0;W<16;++W){var q=X[W];if(q){var Q=V>>W,z=S>>W;Se(G.mipmask&1<<W,"missing mipmap data"),Se(q.width===Q&&q.height===z,"invalid shape for mip images"),Se(q.format===i.format&&q.internalformat===i.internalformat&&q.type===i.type,"incompatible type for mip image"),q.compressed||(q.data?Se(q.data.byteLength===Q*z*Math.max(Hi(q.type,R),q.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):q.element||q.copy)}}}}var l=pe(Se,{optional:Qs,raise:Te,commandRaise:ni,command:Ys,parameter:Xe,commandParameter:mt,constructor:zr,type:Pt,commandType:Ne,isTypedArray:Mt,nni:Gi,oneOf:De,shaderError:zi,linkError:ji,callSite:Er,saveCommandRef:Ka,saveDrawInfo:Xa,framebufferFormat:Zs,guessCommand:xr,texture2D:to,textureCube:rl}),Cn=0,nl=0,ro=5,si=6;function Cr(i,s){this.id=Cn++,this.type=i,this.data=s}function Ar(i){return i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function qt(i){if(i.length===0)return[];var s=i.charAt(0),h=i.charAt(i.length-1);if(i.length>1&&s===h&&(s==='"'||s==="'"))return['"'+Ar(i.substr(1,i.length-2))+'"'];var T=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(i);if(T)return qt(i.substr(0,T.index)).concat(qt(T[1])).concat(qt(i.substr(T.index+T[0].length)));var V=i.split(".");if(V.length===1)return['"'+Ar(i)+'"'];for(var S=[],R=0;R<V.length;++R)S=S.concat(qt(V[R]));return S}function Hr(i){return"["+qt(i).join("][")+"]"}function il(i,s){return new Cr(i,Hr(s+""))}function no(i){return typeof i=="function"&&!i._reglType||i instanceof Cr}function li(i,s){if(typeof i=="function")return new Cr(nl,i);if(typeof i=="number"||typeof i=="boolean")return new Cr(ro,i);if(Array.isArray(i))return new Cr(si,i.map(function(h,T){return li(h,s+"["+T+"]")}));if(i instanceof Cr)return i;l(!1,"invalid option type in uniform "+s)}var Ct={DynamicVariable:Cr,define:il,isDynamic:no,unbox:li,accessor:Hr},$i={next:typeof requestAnimationFrame=="function"?function(i){return requestAnimationFrame(i)}:function(i){return setTimeout(i,16)},cancel:typeof cancelAnimationFrame=="function"?function(i){return cancelAnimationFrame(i)}:clearTimeout},io=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function al(){var i={"":0},s=[""];return{id:function(h){var T=i[h];return T||(T=i[h]=s.length,s.push(h),T)},str:function(h){return s[h]}}}function ol(i,s,h){var T=document.createElement("canvas");pe(T.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),i.appendChild(T),i===document.body&&(T.style.position="absolute",pe(i.style,{margin:0,padding:0}));function V(){var U=window.innerWidth,G=window.innerHeight;if(i!==document.body){var X=T.getBoundingClientRect();U=X.right-X.left,G=X.bottom-X.top}T.width=h*U,T.height=h*G}var S;i!==document.body&&typeof ResizeObserver=="function"?(S=new ResizeObserver(function(){setTimeout(V)}),S.observe(i)):window.addEventListener("resize",V,!1);function R(){S?S.disconnect():window.removeEventListener("resize",V),i.removeChild(T)}return V(),{canvas:T,onDestroy:R}}function Ki(i,s){function h(T){try{return i.getContext(T,s)}catch{return null}}return h("webgl")||h("experimental-webgl")||h("webgl-experimental")}function Xi(i){return typeof i.nodeName=="string"&&typeof i.appendChild=="function"&&typeof i.getBoundingClientRect=="function"}function Ut(i){return typeof i.drawArrays=="function"||typeof i.drawElements=="function"}function ui(i){return typeof i=="string"?i.split():(l(Array.isArray(i),"invalid extension array"),i)}function Wt(i){return typeof i=="string"?(l(typeof document!="undefined","not supported outside of DOM"),document.querySelector(i)):i}function sl(i){var s=i||{},h,T,V,S,R={},U=[],G=[],X=typeof window=="undefined"?1:window.devicePixelRatio,W=!1,q=function(K){K&&l.raise(K)},Q=function(){};if(typeof s=="string"?(l(typeof document!="undefined","selector queries only supported in DOM enviroments"),h=document.querySelector(s),l(h,"invalid query string for element")):typeof s=="object"?Xi(s)?h=s:Ut(s)?(S=s,V=S.canvas):(l.constructor(s),"gl"in s?S=s.gl:"canvas"in s?V=Wt(s.canvas):"container"in s&&(T=Wt(s.container)),"attributes"in s&&(R=s.attributes,l.type(R,"object","invalid context attributes")),"extensions"in s&&(U=ui(s.extensions)),"optionalExtensions"in s&&(G=ui(s.optionalExtensions)),"onDone"in s&&(l.type(s.onDone,"function","invalid or missing onDone callback"),q=s.onDone),"profile"in s&&(W=!!s.profile),"pixelRatio"in s&&(X=+s.pixelRatio,l(X>0,"invalid pixel ratio"))):l.raise("invalid arguments to regl"),h&&(h.nodeName.toLowerCase()==="canvas"?V=h:T=h),!S){if(!V){l(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var z=ol(T||document.body,q,X);if(!z)return null;V=z.canvas,Q=z.onDestroy}R.premultipliedAlpha===void 0&&(R.premultipliedAlpha=!0),S=Ki(V,R)}return S?{gl:S,canvas:V,container:T,extensions:U,optionalExtensions:G,pixelRatio:X,profile:W,onDone:q,onDestroy:Q}:(Q(),q("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function An(i,s){var h={};function T(R){l.type(R,"string","extension name must be string");var U=R.toLowerCase(),G;try{G=h[U]=i.getExtension(U)}catch{}return!!G}for(var V=0;V<s.extensions.length;++V){var S=s.extensions[V];if(!T(S))return s.onDestroy(),s.onDone('"'+S+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return s.optionalExtensions.forEach(T),{extensions:h,restore:function(){Object.keys(h).forEach(function(R){if(h[R]&&!T(R))throw new Error("(regl): error restoring extension "+R)})}}}function At(i,s){for(var h=Array(i),T=0;T<i;++T)h[T]=s(T);return h}var ci=5120,qi=5121,Wi=5122,ll=5123,ul=5124,cl=5125,dl=5126;function Yi(i){for(var s=16;s<=1<<28;s*=16)if(i<=s)return s;return 0}function ao(i){var s,h;return s=(i>65535)<<4,i>>>=s,h=(i>255)<<3,i>>>=h,s|=h,h=(i>15)<<2,i>>>=h,s|=h,h=(i>3)<<1,i>>>=h,s|=h,s|i>>1}function oo(){var i=At(8,function(){return[]});function s(S){var R=Yi(S),U=i[ao(R)>>2];return U.length>0?U.pop():new ArrayBuffer(R)}function h(S){i[ao(S.byteLength)>>2].push(S)}function T(S,R){var U=null;switch(S){case ci:U=new Int8Array(s(R),0,R);break;case qi:U=new Uint8Array(s(R),0,R);break;case Wi:U=new Int16Array(s(2*R),0,R);break;case ll:U=new Uint16Array(s(2*R),0,R);break;case ul:U=new Int32Array(s(4*R),0,R);break;case cl:U=new Uint32Array(s(4*R),0,R);break;case dl:U=new Float32Array(s(4*R),0,R);break;default:return null}return U.length!==R?U.subarray(0,R):U}function V(S){h(S.buffer)}return{alloc:s,free:h,allocType:T,freeType:V}}var qe=oo();qe.zero=oo();var so=3408,fl=3410,Qi=3411,pl=3412,$r=3413,lo=3414,uo=3415,hl=33901,co=33902,vl=3379,ml=3386,fo=34921,ir=36347,Sn=36348,bl=35661,_l=35660,po=34930,ho=36349,vo=34076,mo=34024,gl=7936,di=7937,wl=7938,bo=35724,_o=34047,yl=36063,xl=34852,fi=3553,Kr=34067,zt=34069,Pn=33984,jt=6408,Xr=5126,pi=5121,Zi=36160,Tn=36053,go=36064,El=16384,wo=function(i,s){var h=1;s.ext_texture_filter_anisotropic&&(h=i.getParameter(_o));var T=1,V=1;s.webgl_draw_buffers&&(T=i.getParameter(xl),V=i.getParameter(yl));var S=!!s.oes_texture_float;if(S){var R=i.createTexture();i.bindTexture(fi,R),i.texImage2D(fi,0,jt,1,1,0,jt,Xr,null);var U=i.createFramebuffer();if(i.bindFramebuffer(Zi,U),i.framebufferTexture2D(Zi,go,fi,R,0),i.bindTexture(fi,null),i.checkFramebufferStatus(Zi)!==Tn)S=!1;else{i.viewport(0,0,1,1),i.clearColor(1,0,0,1),i.clear(El);var G=qe.allocType(Xr,4);i.readPixels(0,0,1,1,jt,Xr,G),i.getError()?S=!1:(i.deleteFramebuffer(U),i.deleteTexture(R),S=G[0]===1),qe.freeType(G)}}var X=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),W=!0;if(!X){var q=i.createTexture(),Q=qe.allocType(pi,36);i.activeTexture(Pn),i.bindTexture(Kr,q),i.texImage2D(zt,0,jt,3,3,0,jt,pi,Q),qe.freeType(Q),i.bindTexture(Kr,null),i.deleteTexture(q),W=!i.getError()}return{colorBits:[i.getParameter(fl),i.getParameter(Qi),i.getParameter(pl),i.getParameter($r)],depthBits:i.getParameter(lo),stencilBits:i.getParameter(uo),subpixelBits:i.getParameter(so),extensions:Object.keys(s).filter(function(z){return!!s[z]}),maxAnisotropic:h,maxDrawbuffers:T,maxColorAttachments:V,pointSizeDims:i.getParameter(hl),lineWidthDims:i.getParameter(co),maxViewportDims:i.getParameter(ml),maxCombinedTextureUnits:i.getParameter(bl),maxCubeMapSize:i.getParameter(vo),maxRenderbufferSize:i.getParameter(mo),maxTextureUnits:i.getParameter(po),maxTextureSize:i.getParameter(vl),maxAttributes:i.getParameter(fo),maxVertexUniforms:i.getParameter(ir),maxVertexTextureUnits:i.getParameter(_l),maxVaryingVectors:i.getParameter(Sn),maxFragmentUniforms:i.getParameter(ho),glsl:i.getParameter(bo),renderer:i.getParameter(di),vendor:i.getParameter(gl),version:i.getParameter(wl),readFloat:S,npotTextureCube:W}};function Lt(i){return!!i&&typeof i=="object"&&Array.isArray(i.shape)&&Array.isArray(i.stride)&&typeof i.offset=="number"&&i.shape.length===i.stride.length&&(Array.isArray(i.data)||Z(i.data))}var Tt=function(i){return Object.keys(i).map(function(s){return i[s]})},Sr={shape:Sl,flatten:Al};function Cl(i,s,h){for(var T=0;T<s;++T)h[T]=i[T]}function yo(i,s,h,T){for(var V=0,S=0;S<s;++S)for(var R=i[S],U=0;U<h;++U)T[V++]=R[U]}function Ji(i,s,h,T,V,S){for(var R=S,U=0;U<s;++U)for(var G=i[U],X=0;X<h;++X)for(var W=G[X],q=0;q<T;++q)V[R++]=W[q]}function xo(i,s,h,T,V){for(var S=1,R=h+1;R<s.length;++R)S*=s[R];var U=s[h];if(s.length-h===4){var G=s[h+1],X=s[h+2],W=s[h+3];for(R=0;R<U;++R)Ji(i[R],G,X,W,T,V),V+=S}else for(R=0;R<U;++R)xo(i[R],s,h+1,T,V),V+=S}function Al(i,s,h,T){var V=1;if(s.length)for(var S=0;S<s.length;++S)V*=s[S];else V=0;var R=T||qe.allocType(h,V);switch(s.length){case 0:break;case 1:Cl(i,s[0],R);break;case 2:yo(i,s[0],s[1],R);break;case 3:Ji(i,s[0],s[1],s[2],R,0);break;default:xo(i,s,0,R,0)}return R}function Sl(i){for(var s=[],h=i;h.length;h=h[0])s.push(h.length);return s}var ea={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Pl=5120,ta=5122,kn=5124,Tl=5121,Ln=5123,kl=5125,ra=5126,Eo=5126,Pr={int8:Pl,int16:ta,int32:kn,uint8:Tl,uint16:Ln,uint32:kl,float:ra,float32:Eo},Ll=35048,Rl=35040,hi={dynamic:Ll,stream:Rl,static:35044},na=Sr.flatten,Co=Sr.shape,Ao=35044,Ol=35040,ia=5121,aa=5126,ar=[];ar[5120]=1,ar[5122]=2,ar[5124]=4,ar[5121]=1,ar[5123]=2,ar[5125]=4,ar[5126]=4;function vi(i){return ea[Object.prototype.toString.call(i)]|0}function So(i,s){for(var h=0;h<s.length;++h)i[h]=s[h]}function Po(i,s,h,T,V,S,R){for(var U=0,G=0;G<h;++G)for(var X=0;X<T;++X)i[U++]=s[V*G+S*X+R]}function Dl(i,s,h,T){var V=0,S={};function R(y){this.id=V++,this.buffer=i.createBuffer(),this.type=y,this.usage=Ao,this.byteLength=0,this.dimension=1,this.dtype=ia,this.persistentData=null,h.profile&&(this.stats={size:0})}R.prototype.bind=function(){i.bindBuffer(this.type,this.buffer)},R.prototype.destroy=function(){Q(this)};var U=[];function G(y,L){var $=U.pop();return $||($=new R(y)),$.bind(),q($,L,Ol,0,1,!1),$}function X(y){U.push(y)}function W(y,L,$){y.byteLength=L.byteLength,i.bufferData(y.type,L,$)}function q(y,L,$,se,I,ae){var ne;if(y.usage=$,Array.isArray(L)){if(y.dtype=se||aa,L.length>0){var ve;if(Array.isArray(L[0])){ne=Co(L);for(var N=1,F=1;F<ne.length;++F)N*=ne[F];y.dimension=N,ve=na(L,ne,y.dtype),W(y,ve,$),ae?y.persistentData=ve:qe.freeType(ve)}else if(typeof L[0]=="number"){y.dimension=I;var ce=qe.allocType(y.dtype,L.length);So(ce,L),W(y,ce,$),ae?y.persistentData=ce:qe.freeType(ce)}else Z(L[0])?(y.dimension=L[0].length,y.dtype=se||vi(L[0])||aa,ve=na(L,[L.length,L[0].length],y.dtype),W(y,ve,$),ae?y.persistentData=ve:qe.freeType(ve)):l.raise("invalid buffer data")}}else if(Z(L))y.dtype=se||vi(L),y.dimension=I,W(y,L,$),ae&&(y.persistentData=new Uint8Array(new Uint8Array(L.buffer)));else if(Lt(L)){ne=L.shape;var J=L.stride,j=L.offset,ee=0,re=0,Ee=0,ye=0;ne.length===1?(ee=ne[0],re=1,Ee=J[0],ye=0):ne.length===2?(ee=ne[0],re=ne[1],Ee=J[0],ye=J[1]):l.raise("invalid shape"),y.dtype=se||vi(L.data)||aa,y.dimension=re;var ie=qe.allocType(y.dtype,ee*re);Po(ie,L.data,ee,re,Ee,ye,j),W(y,ie,$),ae?y.persistentData=ie:qe.freeType(ie)}else L instanceof ArrayBuffer?(y.dtype=ia,y.dimension=I,W(y,L,$),ae&&(y.persistentData=new Uint8Array(new Uint8Array(L)))):l.raise("invalid buffer data")}function Q(y){s.bufferCount--,T(y);var L=y.buffer;l(L,"buffer must not be deleted already"),i.deleteBuffer(L),y.buffer=null,delete S[y.id]}function z(y,L,$,se){s.bufferCount++;var I=new R(L);S[I.id]=I;function ae(N){var F=Ao,ce=null,J=0,j=0,ee=1;return Array.isArray(N)||Z(N)||Lt(N)||N instanceof ArrayBuffer?ce=N:typeof N=="number"?J=N|0:N&&(l.type(N,"object","buffer arguments must be an object, a number or an array"),"data"in N&&(l(ce===null||Array.isArray(ce)||Z(ce)||Lt(ce),"invalid data for buffer"),ce=N.data),"usage"in N&&(l.parameter(N.usage,hi,"invalid buffer usage"),F=hi[N.usage]),"type"in N&&(l.parameter(N.type,Pr,"invalid buffer type"),j=Pr[N.type]),"dimension"in N&&(l.type(N.dimension,"number","invalid dimension"),ee=N.dimension|0),"length"in N&&(l.nni(J,"buffer length must be a nonnegative integer"),J=N.length|0)),I.bind(),ce?q(I,ce,F,j,ee,se):(J&&i.bufferData(I.type,J,F),I.dtype=j||ia,I.usage=F,I.dimension=ee,I.byteLength=J),h.profile&&(I.stats.size=I.byteLength*ar[I.dtype]),ae}function ne(N,F){l(F+N.byteLength<=I.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+N.byteLength+" starting from offset "+F+" to a buffer of size "+I.byteLength),i.bufferSubData(I.type,F,N)}function ve(N,F){var ce=(F||0)|0,J;if(I.bind(),Z(N)||N instanceof ArrayBuffer)ne(N,ce);else if(Array.isArray(N)){if(N.length>0)if(typeof N[0]=="number"){var j=qe.allocType(I.dtype,N.length);So(j,N),ne(j,ce),qe.freeType(j)}else if(Array.isArray(N[0])||Z(N[0])){J=Co(N);var ee=na(N,J,I.dtype);ne(ee,ce),qe.freeType(ee)}else l.raise("invalid buffer data")}else if(Lt(N)){J=N.shape;var re=N.stride,Ee=0,ye=0,ie=0,oe=0;J.length===1?(Ee=J[0],ye=1,ie=re[0],oe=0):J.length===2?(Ee=J[0],ye=J[1],ie=re[0],oe=re[1]):l.raise("invalid shape");var _e=Array.isArray(N.data)?I.dtype:vi(N.data),Ce=qe.allocType(_e,Ee*ye);Po(Ce,N.data,Ee,ye,ie,oe,N.offset),ne(Ce,ce),qe.freeType(Ce)}else l.raise("invalid data for buffer subdata");return ae}return $||ae(y),ae._reglType="buffer",ae._buffer=I,ae.subdata=ve,h.profile&&(ae.stats=I.stats),ae.destroy=function(){Q(I)},ae}function K(){Tt(S).forEach(function(y){y.buffer=i.createBuffer(),i.bindBuffer(y.type,y.buffer),i.bufferData(y.type,y.persistentData||y.byteLength,y.usage)})}return h.profile&&(s.getTotalBufferSize=function(){var y=0;return Object.keys(S).forEach(function(L){y+=S[L].stats.size}),y}),{create:z,createStream:G,destroyStream:X,clear:function(){Tt(S).forEach(Q),U.forEach(Q)},getBuffer:function(y){return y&&y._buffer instanceof R?y._buffer:null},restore:K,_initBuffer:q}}var To=0,Fl=0,Vl=1,Nl=1,ko=4,Bl=4,_t={points:To,point:Fl,lines:Vl,line:Nl,triangles:ko,triangle:Bl,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Lo=0,Ml=1,rt=4,Il=5120,Yt=5121,oa=5122,or=5123,sa=5124,Tr=5125,la=34963,Gl=35040,Rn=35044;function St(i,s,h,T){var V={},S=0,R={uint8:Yt,uint16:or};s.oes_element_index_uint&&(R.uint32=Tr);function U(K){this.id=S++,V[this.id]=this,this.buffer=K,this.primType=rt,this.vertCount=0,this.type=0}U.prototype.bind=function(){this.buffer.bind()};var G=[];function X(K){var y=G.pop();return y||(y=new U(h.create(null,la,!0,!1)._buffer)),q(y,K,Gl,-1,-1,0,0),y}function W(K){G.push(K)}function q(K,y,L,$,se,I,ae){K.buffer.bind();var ne;if(y){var ve=ae;!ae&&(!Z(y)||Lt(y)&&!Z(y.data))&&(ve=s.oes_element_index_uint?Tr:or),h._initBuffer(K.buffer,y,L,ve,3)}else i.bufferData(la,I,L),K.buffer.dtype=ne||Yt,K.buffer.usage=L,K.buffer.dimension=3,K.buffer.byteLength=I;if(ne=ae,!ae){switch(K.buffer.dtype){case Yt:case Il:ne=Yt;break;case or:case oa:ne=or;break;case Tr:case sa:ne=Tr;break;default:l.raise("unsupported type for element array")}K.buffer.dtype=ne}K.type=ne,l(ne!==Tr||!!s.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var N=se;N<0&&(N=K.buffer.byteLength,ne===or?N>>=1:ne===Tr&&(N>>=2)),K.vertCount=N;var F=$;if($<0){F=rt;var ce=K.buffer.dimension;ce===1&&(F=Lo),ce===2&&(F=Ml),ce===3&&(F=rt)}K.primType=F}function Q(K){T.elementsCount--,l(K.buffer!==null,"must not double destroy elements"),delete V[K.id],K.buffer.destroy(),K.buffer=null}function z(K,y){var L=h.create(null,la,!0),$=new U(L._buffer);T.elementsCount++;function se(I){if(!I)L(),$.primType=rt,$.vertCount=0,$.type=Yt;else if(typeof I=="number")L(I),$.primType=rt,$.vertCount=I|0,$.type=Yt;else{var ae=null,ne=Rn,ve=-1,N=-1,F=0,ce=0;Array.isArray(I)||Z(I)||Lt(I)?ae=I:(l.type(I,"object","invalid arguments for elements"),"data"in I&&(ae=I.data,l(Array.isArray(ae)||Z(ae)||Lt(ae),"invalid data for element buffer")),"usage"in I&&(l.parameter(I.usage,hi,"invalid element buffer usage"),ne=hi[I.usage]),"primitive"in I&&(l.parameter(I.primitive,_t,"invalid element buffer primitive"),ve=_t[I.primitive]),"count"in I&&(l(typeof I.count=="number"&&I.count>=0,"invalid vertex count for elements"),N=I.count|0),"type"in I&&(l.parameter(I.type,R,"invalid buffer type"),ce=R[I.type]),"length"in I?F=I.length|0:(F=N,ce===or||ce===oa?F*=2:(ce===Tr||ce===sa)&&(F*=4))),q($,ae,ne,ve,N,F,ce)}return se}return se(K),se._reglType="elements",se._elements=$,se.subdata=function(I,ae){return L.subdata(I,ae),se},se.destroy=function(){Q($)},se}return{create:z,createStream:X,destroyStream:W,getElements:function(K){return typeof K=="function"&&K._elements instanceof U?K._elements:null},clear:function(){Tt(V).forEach(Q)}}}var qr=new Float32Array(1),Qt=new Uint32Array(qr.buffer),Ul=5123;function ua(i){for(var s=qe.allocType(Ul,i.length),h=0;h<i.length;++h)if(isNaN(i[h]))s[h]=65535;else if(i[h]===1/0)s[h]=31744;else if(i[h]===-1/0)s[h]=64512;else{qr[0]=i[h];var T=Qt[0],V=T>>>31<<15,S=(T<<1>>>24)-127,R=T>>13&(1<<10)-1;if(S<-24)s[h]=V;else if(S<-14){var U=-14-S;s[h]=V+(R+(1<<10)>>U)}else S>15?s[h]=V+31744:s[h]=V+(S+15<<10)+R}return s}function Ke(i){return Array.isArray(i)||Z(i)}var sr=function(i){return!(i&i-1)&&!!i},Je=34467,Ft=3553,nt=34067,On=34069,dt=6408,ca=6406,lr=6407,kr=6409,mi=6410,Ro=32854,Dn=32855,Oo=36194,da=32819,Fn=32820,bi=33635,Do=34042,Ht=6402,Vn=34041,Nn=35904,Bn=35906,Wr=36193,Yr=33776,ur=33777,cr=33778,Qr=33779,Fo=35986,Vo=35987,No=34798,Bo=35840,dr=35841,Mo=35842,Io=35843,Go=36196,Zr=5121,_i=5123,fa=5125,Mn=5126,Lr=10242,Uo=10243,zl=10497,Jr=33071,jl=33648,zo=10240,Hl=10241,en=9728,Me=9729,$t=9984,jo=9985,Ho=9986,In=9987,Rr=33170,Kt=4352,$l=4353,Rt=4354,Kl=34046,$o=3317,Ko=37440,Xo=37441,qo=37443,pa=37444,tn=33984,Wo=[$t,Ho,jo,In],Gn=[0,kr,mi,lr,dt],kt={};kt[kr]=kt[ca]=kt[Ht]=1,kt[Vn]=kt[mi]=2,kt[lr]=kt[Nn]=3,kt[dt]=kt[Bn]=4;function Or(i){return"[object "+i+"]"}var Yo=Or("HTMLCanvasElement"),ha=Or("OffscreenCanvas"),Qo=Or("CanvasRenderingContext2D"),va=Or("ImageBitmap"),ma=Or("HTMLImageElement"),ba=Or("HTMLVideoElement"),Zo=Object.keys(ea).concat([Yo,ha,Qo,va,ma,ba]),rn=[];rn[Zr]=1,rn[Mn]=4,rn[Wr]=2,rn[_i]=2,rn[fa]=4;var ft=[];ft[Ro]=2,ft[Dn]=2,ft[Oo]=2,ft[Vn]=4,ft[Yr]=.5,ft[ur]=.5,ft[cr]=1,ft[Qr]=1,ft[Fo]=.5,ft[Vo]=1,ft[No]=1,ft[Bo]=.5,ft[dr]=.25,ft[Mo]=.5,ft[Io]=.25,ft[Go]=.5;function gi(i){return Array.isArray(i)&&(i.length===0||typeof i[0]=="number")}function _a(i){if(!Array.isArray(i))return!1;var s=i.length;return!(s===0||!Ke(i[0]))}function Dr(i){return Object.prototype.toString.call(i)}function wi(i){return Dr(i)===Yo}function ga(i){return Dr(i)===ha}function Jo(i){return Dr(i)===Qo}function wa(i){return Dr(i)===va}function es(i){return Dr(i)===ma}function Xl(i){return Dr(i)===ba}function nn(i){if(!i)return!1;var s=Dr(i);return Zo.indexOf(s)>=0?!0:gi(i)||_a(i)||Lt(i)}function ts(i){return ea[Object.prototype.toString.call(i)]|0}function ql(i,s){var h=s.length;switch(i.type){case Zr:case _i:case fa:case Mn:var T=qe.allocType(i.type,h);T.set(s),i.data=T;break;case Wr:i.data=ua(s);break;default:l.raise("unsupported texture type, must specify a typed array")}}function rs(i,s){return qe.allocType(i.type===Wr?Mn:i.type,s)}function ya(i,s){i.type===Wr?(i.data=ua(s),qe.freeType(s)):i.data=s}function Wl(i,s,h,T,V,S){for(var R=i.width,U=i.height,G=i.channels,X=R*U*G,W=rs(i,X),q=0,Q=0;Q<U;++Q)for(var z=0;z<R;++z)for(var K=0;K<G;++K)W[q++]=s[h*z+T*Q+V*K+S];ya(i,W)}function Un(i,s,h,T,V,S){var R;if(typeof ft[i]!="undefined"?R=ft[i]:R=kt[i]*rn[s],S&&(R*=6),V){for(var U=0,G=h;G>=1;)U+=R*G*G,G/=2;return U}else return R*h*T}function Yl(i,s,h,T,V,S,R){var U={"don't care":Kt,"dont care":Kt,nice:Rt,fast:$l},G={repeat:zl,clamp:Jr,mirror:jl},X={nearest:en,linear:Me},W=pe({mipmap:In,"nearest mipmap nearest":$t,"linear mipmap nearest":jo,"nearest mipmap linear":Ho,"linear mipmap linear":In},X),q={none:0,browser:pa},Q={uint8:Zr,rgba4:da,rgb565:bi,"rgb5 a1":Fn},z={alpha:ca,luminance:kr,"luminance alpha":mi,rgb:lr,rgba:dt,rgba4:Ro,"rgb5 a1":Dn,rgb565:Oo},K={};s.ext_srgb&&(z.srgb=Nn,z.srgba=Bn),s.oes_texture_float&&(Q.float32=Q.float=Mn),s.oes_texture_half_float&&(Q.float16=Q["half float"]=Wr),s.webgl_depth_texture&&(pe(z,{depth:Ht,"depth stencil":Vn}),pe(Q,{uint16:_i,uint32:fa,"depth stencil":Do})),s.webgl_compressed_texture_s3tc&&pe(K,{"rgb s3tc dxt1":Yr,"rgba s3tc dxt1":ur,"rgba s3tc dxt3":cr,"rgba s3tc dxt5":Qr}),s.webgl_compressed_texture_atc&&pe(K,{"rgb atc":Fo,"rgba atc explicit alpha":Vo,"rgba atc interpolated alpha":No}),s.webgl_compressed_texture_pvrtc&&pe(K,{"rgb pvrtc 4bppv1":Bo,"rgb pvrtc 2bppv1":dr,"rgba pvrtc 4bppv1":Mo,"rgba pvrtc 2bppv1":Io}),s.webgl_compressed_texture_etc1&&(K["rgb etc1"]=Go);var y=Array.prototype.slice.call(i.getParameter(Je));Object.keys(K).forEach(function(f){var k=K[f];y.indexOf(k)>=0&&(z[f]=k)});var L=Object.keys(z);h.textureFormats=L;var $=[];Object.keys(z).forEach(function(f){var k=z[f];$[k]=f});var se=[];Object.keys(Q).forEach(function(f){var k=Q[f];se[k]=f});var I=[];Object.keys(X).forEach(function(f){var k=X[f];I[k]=f});var ae=[];Object.keys(W).forEach(function(f){var k=W[f];ae[k]=f});var ne=[];Object.keys(G).forEach(function(f){var k=G[f];ne[k]=f});var ve=L.reduce(function(f,k){var A=z[k];return A===kr||A===ca||A===kr||A===mi||A===Ht||A===Vn||s.ext_srgb&&(A===Nn||A===Bn)?f[A]=A:A===Dn||k.indexOf("rgba")>=0?f[A]=dt:f[A]=lr,f},{});function N(){this.internalformat=dt,this.format=dt,this.type=Zr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=pa,this.width=0,this.height=0,this.channels=0}function F(f,k){f.internalformat=k.internalformat,f.format=k.format,f.type=k.type,f.compressed=k.compressed,f.premultiplyAlpha=k.premultiplyAlpha,f.flipY=k.flipY,f.unpackAlignment=k.unpackAlignment,f.colorSpace=k.colorSpace,f.width=k.width,f.height=k.height,f.channels=k.channels}function ce(f,k){if(!(typeof k!="object"||!k)){if("premultiplyAlpha"in k&&(l.type(k.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),f.premultiplyAlpha=k.premultiplyAlpha),"flipY"in k&&(l.type(k.flipY,"boolean","invalid texture flip"),f.flipY=k.flipY),"alignment"in k&&(l.oneOf(k.alignment,[1,2,4,8],"invalid texture unpack alignment"),f.unpackAlignment=k.alignment),"colorSpace"in k&&(l.parameter(k.colorSpace,q,"invalid colorSpace"),f.colorSpace=q[k.colorSpace]),"type"in k){var A=k.type;l(s.oes_texture_float||!(A==="float"||A==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),l(s.oes_texture_half_float||!(A==="half float"||A==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),l(s.webgl_depth_texture||!(A==="uint16"||A==="uint32"||A==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),l.parameter(A,Q,"invalid texture type"),f.type=Q[A]}var ue=f.width,Le=f.height,u=f.channels,o=!1;"shape"in k?(l(Array.isArray(k.shape)&&k.shape.length>=2,"shape must be an array"),ue=k.shape[0],Le=k.shape[1],k.shape.length===3&&(u=k.shape[2],l(u>0&&u<=4,"invalid number of channels"),o=!0),l(ue>=0&&ue<=h.maxTextureSize,"invalid width"),l(Le>=0&&Le<=h.maxTextureSize,"invalid height")):("radius"in k&&(ue=Le=k.radius,l(ue>=0&&ue<=h.maxTextureSize,"invalid radius")),"width"in k&&(ue=k.width,l(ue>=0&&ue<=h.maxTextureSize,"invalid width")),"height"in k&&(Le=k.height,l(Le>=0&&Le<=h.maxTextureSize,"invalid height")),"channels"in k&&(u=k.channels,l(u>0&&u<=4,"invalid number of channels"),o=!0)),f.width=ue|0,f.height=Le|0,f.channels=u|0;var v=!1;if("format"in k){var w=k.format;l(s.webgl_depth_texture||!(w==="depth"||w==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),l.parameter(w,z,"invalid texture format");var x=f.internalformat=z[w];f.format=ve[x],w in Q&&("type"in k||(f.type=Q[w])),w in K&&(f.compressed=!0),v=!0}!o&&v?f.channels=kt[f.format]:o&&!v?f.channels!==Gn[f.format]&&(f.format=f.internalformat=Gn[f.channels]):v&&o&&l(f.channels===kt[f.format],"number of channels inconsistent with specified format")}}function J(f){i.pixelStorei(Ko,f.flipY),i.pixelStorei(Xo,f.premultiplyAlpha),i.pixelStorei(qo,f.colorSpace),i.pixelStorei($o,f.unpackAlignment)}function j(){N.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function ee(f,k){var A=null;if(nn(k)?A=k:k&&(l.type(k,"object","invalid pixel data type"),ce(f,k),"x"in k&&(f.xOffset=k.x|0),"y"in k&&(f.yOffset=k.y|0),nn(k.data)&&(A=k.data)),l(!f.compressed||A instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),k.copy){l(!A,"can not specify copy and data field for the same texture");var ue=V.viewportWidth,Le=V.viewportHeight;f.width=f.width||ue-f.xOffset,f.height=f.height||Le-f.yOffset,f.needsCopy=!0,l(f.xOffset>=0&&f.xOffset<ue&&f.yOffset>=0&&f.yOffset<Le&&f.width>0&&f.width<=ue&&f.height>0&&f.height<=Le,"copy texture read out of bounds")}else if(!A)f.width=f.width||1,f.height=f.height||1,f.channels=f.channels||4;else if(Z(A))f.channels=f.channels||4,f.data=A,!("type"in k)&&f.type===Zr&&(f.type=ts(A));else if(gi(A))f.channels=f.channels||4,ql(f,A),f.alignment=1,f.needsFree=!0;else if(Lt(A)){var u=A.data;!Array.isArray(u)&&f.type===Zr&&(f.type=ts(u));var o=A.shape,v=A.stride,w,x,_,b,g,c;o.length===3?(_=o[2],c=v[2]):(l(o.length===2,"invalid ndarray pixel data, must be 2 or 3D"),_=1,c=1),w=o[0],x=o[1],b=v[0],g=v[1],f.alignment=1,f.width=w,f.height=x,f.channels=_,f.format=f.internalformat=Gn[_],f.needsFree=!0,Wl(f,u,b,g,c,A.offset)}else if(wi(A)||ga(A)||Jo(A))wi(A)||ga(A)?f.element=A:f.element=A.canvas,f.width=f.element.width,f.height=f.element.height,f.channels=4;else if(wa(A))f.element=A,f.width=A.width,f.height=A.height,f.channels=4;else if(es(A))f.element=A,f.width=A.naturalWidth,f.height=A.naturalHeight,f.channels=4;else if(Xl(A))f.element=A,f.width=A.videoWidth,f.height=A.videoHeight,f.channels=4;else if(_a(A)){var p=f.width||A[0].length,d=f.height||A.length,C=f.channels;Ke(A[0][0])?C=C||A[0][0].length:C=C||1;for(var E=Sr.shape(A),D=1,B=0;B<E.length;++B)D*=E[B];var Y=rs(f,D);Sr.flatten(A,E,"",Y),ya(f,Y),f.alignment=1,f.width=p,f.height=d,f.channels=C,f.format=f.internalformat=Gn[C],f.needsFree=!0}f.type===Mn?l(h.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):f.type===Wr&&l(h.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function re(f,k,A){var ue=f.element,Le=f.data,u=f.internalformat,o=f.format,v=f.type,w=f.width,x=f.height;J(f),ue?i.texImage2D(k,A,o,o,v,ue):f.compressed?i.compressedTexImage2D(k,A,u,w,x,0,Le):f.needsCopy?(T(),i.copyTexImage2D(k,A,o,f.xOffset,f.yOffset,w,x,0)):i.texImage2D(k,A,o,w,x,0,o,v,Le||null)}function Ee(f,k,A,ue,Le){var u=f.element,o=f.data,v=f.internalformat,w=f.format,x=f.type,_=f.width,b=f.height;J(f),u?i.texSubImage2D(k,Le,A,ue,w,x,u):f.compressed?i.compressedTexSubImage2D(k,Le,A,ue,v,_,b,o):f.needsCopy?(T(),i.copyTexSubImage2D(k,Le,A,ue,f.xOffset,f.yOffset,_,b)):i.texSubImage2D(k,Le,A,ue,_,b,w,x,o)}var ye=[];function ie(){return ye.pop()||new j}function oe(f){f.needsFree&&qe.freeType(f.data),j.call(f),ye.push(f)}function _e(){N.call(this),this.genMipmaps=!1,this.mipmapHint=Kt,this.mipmask=0,this.images=Array(16)}function Ce(f,k,A){var ue=f.images[0]=ie();f.mipmask=1,ue.width=f.width=k,ue.height=f.height=A,ue.channels=f.channels=4}function Re(f,k){var A=null;if(nn(k))A=f.images[0]=ie(),F(A,f),ee(A,k),f.mipmask=1;else if(ce(f,k),Array.isArray(k.mipmap))for(var ue=k.mipmap,Le=0;Le<ue.length;++Le)A=f.images[Le]=ie(),F(A,f),A.width>>=Le,A.height>>=Le,ee(A,ue[Le]),f.mipmask|=1<<Le;else A=f.images[0]=ie(),F(A,f),ee(A,k),f.mipmask=1;F(f,f.images[0]),f.compressed&&(f.internalformat===Yr||f.internalformat===ur||f.internalformat===cr||f.internalformat===Qr)&&l(f.width%4===0&&f.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function et(f,k){for(var A=f.images,ue=0;ue<A.length;++ue){if(!A[ue])return;re(A[ue],k,ue)}}var tt=[];function Fe(){var f=tt.pop()||new _e;N.call(f),f.mipmask=0;for(var k=0;k<16;++k)f.images[k]=null;return f}function lt(f){for(var k=f.images,A=0;A<k.length;++A)k[A]&&oe(k[A]),k[A]=null;tt.push(f)}function We(){this.minFilter=en,this.magFilter=en,this.wrapS=Jr,this.wrapT=Jr,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Kt}function st(f,k){if("min"in k){var A=k.min;l.parameter(A,W),f.minFilter=W[A],Wo.indexOf(f.minFilter)>=0&&!("faces"in k)&&(f.genMipmaps=!0)}if("mag"in k){var ue=k.mag;l.parameter(ue,X),f.magFilter=X[ue]}var Le=f.wrapS,u=f.wrapT;if("wrap"in k){var o=k.wrap;typeof o=="string"?(l.parameter(o,G),Le=u=G[o]):Array.isArray(o)&&(l.parameter(o[0],G),l.parameter(o[1],G),Le=G[o[0]],u=G[o[1]])}else{if("wrapS"in k){var v=k.wrapS;l.parameter(v,G),Le=G[v]}if("wrapT"in k){var w=k.wrapT;l.parameter(w,G),u=G[w]}}if(f.wrapS=Le,f.wrapT=u,"anisotropic"in k){var x=k.anisotropic;l(typeof x=="number"&&x>=1&&x<=h.maxAnisotropic,"aniso samples must be between 1 and "),f.anisotropic=k.anisotropic}if("mipmap"in k){var _=!1;switch(typeof k.mipmap){case"string":l.parameter(k.mipmap,U,"invalid mipmap hint"),f.mipmapHint=U[k.mipmap],f.genMipmaps=!0,_=!0;break;case"boolean":_=f.genMipmaps=k.mipmap;break;case"object":l(Array.isArray(k.mipmap),"invalid mipmap type"),f.genMipmaps=!1,_=!0;break;default:l.raise("invalid mipmap type")}_&&!("min"in k)&&(f.minFilter=$t)}}function ut(f,k){i.texParameteri(k,Hl,f.minFilter),i.texParameteri(k,zo,f.magFilter),i.texParameteri(k,Lr,f.wrapS),i.texParameteri(k,Uo,f.wrapT),s.ext_texture_filter_anisotropic&&i.texParameteri(k,Kl,f.anisotropic),f.genMipmaps&&(i.hint(Rr,f.mipmapHint),i.generateMipmap(k))}var ct=0,vt={},gt=h.maxTextureUnits,it=Array(gt).map(function(){return null});function Pe(f){N.call(this),this.mipmask=0,this.internalformat=dt,this.id=ct++,this.refCount=1,this.target=f,this.texture=i.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new We,R.profile&&(this.stats={size:0})}function wt(f){i.activeTexture(tn),i.bindTexture(f.target,f.texture)}function Ue(){var f=it[0];f?i.bindTexture(f.target,f.texture):i.bindTexture(Ft,null)}function be(f){var k=f.texture;l(k,"must not double destroy texture");var A=f.unit,ue=f.target;A>=0&&(i.activeTexture(tn+A),i.bindTexture(ue,null),it[A]=null),i.deleteTexture(k),f.texture=null,f.params=null,f.pixels=null,f.refCount=0,delete vt[f.id],S.textureCount--}pe(Pe.prototype,{bind:function(){var f=this;f.bindCount+=1;var k=f.unit;if(k<0){for(var A=0;A<gt;++A){var ue=it[A];if(ue){if(ue.bindCount>0)continue;ue.unit=-1}it[A]=f,k=A;break}k>=gt&&l.raise("insufficient number of texture units"),R.profile&&S.maxTextureUnits<k+1&&(S.maxTextureUnits=k+1),f.unit=k,i.activeTexture(tn+k),i.bindTexture(f.target,f.texture)}return k},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&be(this)}});function Oe(f,k){var A=new Pe(Ft);vt[A.id]=A,S.textureCount++;function ue(o,v){var w=A.texInfo;We.call(w);var x=Fe();return typeof o=="number"?typeof v=="number"?Ce(x,o|0,v|0):Ce(x,o|0,o|0):o?(l.type(o,"object","invalid arguments to regl.texture"),st(w,o),Re(x,o)):Ce(x,1,1),w.genMipmaps&&(x.mipmask=(x.width<<1)-1),A.mipmask=x.mipmask,F(A,x),l.texture2D(w,x,h),A.internalformat=x.internalformat,ue.width=x.width,ue.height=x.height,wt(A),et(x,Ft),ut(w,Ft),Ue(),lt(x),R.profile&&(A.stats.size=Un(A.internalformat,A.type,x.width,x.height,w.genMipmaps,!1)),ue.format=$[A.internalformat],ue.type=se[A.type],ue.mag=I[w.magFilter],ue.min=ae[w.minFilter],ue.wrapS=ne[w.wrapS],ue.wrapT=ne[w.wrapT],ue}function Le(o,v,w,x){l(!!o,"must specify image data");var _=v|0,b=w|0,g=x|0,c=ie();return F(c,A),c.width=0,c.height=0,ee(c,o),c.width=c.width||(A.width>>g)-_,c.height=c.height||(A.height>>g)-b,l(A.type===c.type&&A.format===c.format&&A.internalformat===c.internalformat,"incompatible format for texture.subimage"),l(_>=0&&b>=0&&_+c.width<=A.width&&b+c.height<=A.height,"texture.subimage write out of bounds"),l(A.mipmask&1<<g,"missing mipmap data"),l(c.data||c.element||c.needsCopy,"missing image data"),wt(A),Ee(c,Ft,_,b,g),Ue(),oe(c),ue}function u(o,v){var w=o|0,x=v|0||w;if(w===A.width&&x===A.height)return ue;ue.width=A.width=w,ue.height=A.height=x,wt(A);for(var _=0;A.mipmask>>_;++_){var b=w>>_,g=x>>_;if(!b||!g)break;i.texImage2D(Ft,_,A.format,b,g,0,A.format,A.type,null)}return Ue(),R.profile&&(A.stats.size=Un(A.internalformat,A.type,w,x,!1,!1)),ue}return ue(f,k),ue.subimage=Le,ue.resize=u,ue._reglType="texture2d",ue._texture=A,R.profile&&(ue.stats=A.stats),ue.destroy=function(){A.decRef()},ue}function Be(f,k,A,ue,Le,u){var o=new Pe(nt);vt[o.id]=o,S.cubeCount++;var v=new Array(6);function w(b,g,c,p,d,C){var E,D=o.texInfo;for(We.call(D),E=0;E<6;++E)v[E]=Fe();if(typeof b=="number"||!b){var B=b|0||1;for(E=0;E<6;++E)Ce(v[E],B,B)}else if(typeof b=="object")if(g)Re(v[0],b),Re(v[1],g),Re(v[2],c),Re(v[3],p),Re(v[4],d),Re(v[5],C);else if(st(D,b),ce(o,b),"faces"in b){var Y=b.faces;for(l(Array.isArray(Y)&&Y.length===6,"cube faces must be a length 6 array"),E=0;E<6;++E)l(typeof Y[E]=="object"&&!!Y[E],"invalid input for cube map face"),F(v[E],o),Re(v[E],Y[E])}else for(E=0;E<6;++E)Re(v[E],b);else l.raise("invalid arguments to cube map");for(F(o,v[0]),l.optional(function(){h.npotTextureCube||l(sr(o.width)&&sr(o.height),"your browser does not support non power or two texture dimensions")}),D.genMipmaps?o.mipmask=(v[0].width<<1)-1:o.mipmask=v[0].mipmask,l.textureCube(o,D,v,h),o.internalformat=v[0].internalformat,w.width=v[0].width,w.height=v[0].height,wt(o),E=0;E<6;++E)et(v[E],On+E);for(ut(D,nt),Ue(),R.profile&&(o.stats.size=Un(o.internalformat,o.type,w.width,w.height,D.genMipmaps,!0)),w.format=$[o.internalformat],w.type=se[o.type],w.mag=I[D.magFilter],w.min=ae[D.minFilter],w.wrapS=ne[D.wrapS],w.wrapT=ne[D.wrapT],E=0;E<6;++E)lt(v[E]);return w}function x(b,g,c,p,d){l(!!g,"must specify image data"),l(typeof b=="number"&&b===(b|0)&&b>=0&&b<6,"invalid face");var C=c|0,E=p|0,D=d|0,B=ie();return F(B,o),B.width=0,B.height=0,ee(B,g),B.width=B.width||(o.width>>D)-C,B.height=B.height||(o.height>>D)-E,l(o.type===B.type&&o.format===B.format&&o.internalformat===B.internalformat,"incompatible format for texture.subimage"),l(C>=0&&E>=0&&C+B.width<=o.width&&E+B.height<=o.height,"texture.subimage write out of bounds"),l(o.mipmask&1<<D,"missing mipmap data"),l(B.data||B.element||B.needsCopy,"missing image data"),wt(o),Ee(B,On+b,C,E,D),Ue(),oe(B),w}function _(b){var g=b|0;if(g!==o.width){w.width=o.width=g,w.height=o.height=g,wt(o);for(var c=0;c<6;++c)for(var p=0;o.mipmask>>p;++p)i.texImage2D(On+c,p,o.format,g>>p,g>>p,0,o.format,o.type,null);return Ue(),R.profile&&(o.stats.size=Un(o.internalformat,o.type,w.width,w.height,!1,!0)),w}}return w(f,k,A,ue,Le,u),w.subimage=x,w.resize=_,w._reglType="textureCube",w._texture=o,R.profile&&(w.stats=o.stats),w.destroy=function(){o.decRef()},w}function at(){for(var f=0;f<gt;++f)i.activeTexture(tn+f),i.bindTexture(Ft,null),it[f]=null;Tt(vt).forEach(be),S.cubeCount=0,S.textureCount=0}R.profile&&(S.getTotalTextureSize=function(){var f=0;return Object.keys(vt).forEach(function(k){f+=vt[k].stats.size}),f});function wr(){for(var f=0;f<gt;++f){var k=it[f];k&&(k.bindCount=0,k.unit=-1,it[f]=null)}Tt(vt).forEach(function(A){A.texture=i.createTexture(),i.bindTexture(A.target,A.texture);for(var ue=0;ue<32;++ue)if((A.mipmask&1<<ue)!==0)if(A.target===Ft)i.texImage2D(Ft,ue,A.internalformat,A.width>>ue,A.height>>ue,0,A.internalformat,A.type,null);else for(var Le=0;Le<6;++Le)i.texImage2D(On+Le,ue,A.internalformat,A.width>>ue,A.height>>ue,0,A.internalformat,A.type,null);ut(A.texInfo,A.target)})}function Jn(){for(var f=0;f<gt;++f){var k=it[f];k&&(k.bindCount=0,k.unit=-1,it[f]=null),i.activeTexture(tn+f),i.bindTexture(Ft,null),i.bindTexture(nt,null)}}return{create2D:Oe,createCube:Be,clear:at,getTexture:function(f){return null},restore:wr,refresh:Jn}}var fr=36161,an=32854,on=32855,ns=36194,is=33189,Fr=36168,as=34041,os=35907,ss=34836,ls=34842,yi=34843,Vt=[];Vt[an]=2,Vt[on]=2,Vt[ns]=2,Vt[is]=2,Vt[Fr]=1,Vt[as]=4,Vt[os]=4,Vt[ss]=16,Vt[ls]=8,Vt[yi]=6;function xi(i,s,h){return Vt[i]*s*h}var Ql=function(i,s,h,T,V){var S={rgba4:an,rgb565:ns,"rgb5 a1":on,depth:is,stencil:Fr,"depth stencil":as};s.ext_srgb&&(S.srgba=os),s.ext_color_buffer_half_float&&(S.rgba16f=ls,S.rgb16f=yi),s.webgl_color_buffer_float&&(S.rgba32f=ss);var R=[];Object.keys(S).forEach(function(z){var K=S[z];R[K]=z});var U=0,G={};function X(z){this.id=U++,this.refCount=1,this.renderbuffer=z,this.format=an,this.width=0,this.height=0,V.profile&&(this.stats={size:0})}X.prototype.decRef=function(){--this.refCount<=0&&W(this)};function W(z){var K=z.renderbuffer;l(K,"must not double destroy renderbuffer"),i.bindRenderbuffer(fr,null),i.deleteRenderbuffer(K),z.renderbuffer=null,z.refCount=0,delete G[z.id],T.renderbufferCount--}function q(z,K){var y=new X(i.createRenderbuffer());G[y.id]=y,T.renderbufferCount++;function L(se,I){var ae=0,ne=0,ve=an;if(typeof se=="object"&&se){var N=se;if("shape"in N){var F=N.shape;l(Array.isArray(F)&&F.length>=2,"invalid renderbuffer shape"),ae=F[0]|0,ne=F[1]|0}else"radius"in N&&(ae=ne=N.radius|0),"width"in N&&(ae=N.width|0),"height"in N&&(ne=N.height|0);"format"in N&&(l.parameter(N.format,S,"invalid renderbuffer format"),ve=S[N.format])}else typeof se=="number"?(ae=se|0,typeof I=="number"?ne=I|0:ne=ae):se?l.raise("invalid arguments to renderbuffer constructor"):ae=ne=1;if(l(ae>0&&ne>0&&ae<=h.maxRenderbufferSize&&ne<=h.maxRenderbufferSize,"invalid renderbuffer size"),!(ae===y.width&&ne===y.height&&ve===y.format))return L.width=y.width=ae,L.height=y.height=ne,y.format=ve,i.bindRenderbuffer(fr,y.renderbuffer),i.renderbufferStorage(fr,ve,ae,ne),l(i.getError()===0,"invalid render buffer format"),V.profile&&(y.stats.size=xi(y.format,y.width,y.height)),L.format=R[y.format],L}function $(se,I){var ae=se|0,ne=I|0||ae;return ae===y.width&&ne===y.height||(l(ae>0&&ne>0&&ae<=h.maxRenderbufferSize&&ne<=h.maxRenderbufferSize,"invalid renderbuffer size"),L.width=y.width=ae,L.height=y.height=ne,i.bindRenderbuffer(fr,y.renderbuffer),i.renderbufferStorage(fr,y.format,ae,ne),l(i.getError()===0,"invalid render buffer format"),V.profile&&(y.stats.size=xi(y.format,y.width,y.height))),L}return L(z,K),L.resize=$,L._reglType="renderbuffer",L._renderbuffer=y,V.profile&&(L.stats=y.stats),L.destroy=function(){y.decRef()},L}V.profile&&(T.getTotalRenderbufferSize=function(){var z=0;return Object.keys(G).forEach(function(K){z+=G[K].stats.size}),z});function Q(){Tt(G).forEach(function(z){z.renderbuffer=i.createRenderbuffer(),i.bindRenderbuffer(fr,z.renderbuffer),i.renderbufferStorage(fr,z.format,z.width,z.height)}),i.bindRenderbuffer(fr,null)}return{create:q,clear:function(){Tt(G).forEach(W)},restore:Q}},Zt=36160,zn=36161,pr=3553,Ei=34069,us=36064,cs=36096,Ci=36128,ds=33306,fs=36053,xa=36054,Zl=36055,Jl=36057,eu=36061,tu=36193,ru=5121,nu=5126,ps=6407,hs=6408,iu=6402,au=[ps,hs],Ea=[];Ea[hs]=4,Ea[ps]=3;var Ai=[];Ai[ru]=1,Ai[nu]=4,Ai[tu]=2;var Ca=32854,ou=32855,su=36194,lu=33189,uu=36168,vs=34041,cu=35907,du=34836,fu=34842,hr=34843,ms=[Ca,ou,su,cu,fu,hr,du],sn={};sn[fs]="complete",sn[xa]="incomplete attachment",sn[Jl]="incomplete dimensions",sn[Zl]="incomplete, missing attachment",sn[eu]="unsupported";function pu(i,s,h,T,V,S){var R={cur:null,next:null,dirty:!1,setFBO:null},U=["rgba"],G=["rgba4","rgb565","rgb5 a1"];s.ext_srgb&&G.push("srgba"),s.ext_color_buffer_half_float&&G.push("rgba16f","rgb16f"),s.webgl_color_buffer_float&&G.push("rgba32f");var X=["uint8"];s.oes_texture_half_float&&X.push("half float","float16"),s.oes_texture_float&&X.push("float","float32");function W(j,ee,re){this.target=j,this.texture=ee,this.renderbuffer=re;var Ee=0,ye=0;ee?(Ee=ee.width,ye=ee.height):re&&(Ee=re.width,ye=re.height),this.width=Ee,this.height=ye}function q(j){j&&(j.texture&&j.texture._texture.decRef(),j.renderbuffer&&j.renderbuffer._renderbuffer.decRef())}function Q(j,ee,re){if(!!j)if(j.texture){var Ee=j.texture._texture,ye=Math.max(1,Ee.width),ie=Math.max(1,Ee.height);l(ye===ee&&ie===re,"inconsistent width/height for supplied texture"),Ee.refCount+=1}else{var oe=j.renderbuffer._renderbuffer;l(oe.width===ee&&oe.height===re,"inconsistent width/height for renderbuffer"),oe.refCount+=1}}function z(j,ee){ee&&(ee.texture?i.framebufferTexture2D(Zt,j,ee.target,ee.texture._texture.texture,0):i.framebufferRenderbuffer(Zt,j,zn,ee.renderbuffer._renderbuffer.renderbuffer))}function K(j){var ee=pr,re=null,Ee=null,ye=j;typeof j=="object"&&(ye=j.data,"target"in j&&(ee=j.target|0)),l.type(ye,"function","invalid attachment data");var ie=ye._reglType;return ie==="texture2d"?(re=ye,l(ee===pr)):ie==="textureCube"?(re=ye,l(ee>=Ei&&ee<Ei+6,"invalid cube map target")):ie==="renderbuffer"?(Ee=ye,ee=zn):l.raise("invalid regl object for attachment"),new W(ee,re,Ee)}function y(j,ee,re,Ee,ye){if(re){var ie=T.create2D({width:j,height:ee,format:Ee,type:ye});return ie._texture.refCount=0,new W(pr,ie,null)}else{var oe=V.create({width:j,height:ee,format:Ee});return oe._renderbuffer.refCount=0,new W(zn,null,oe)}}function L(j){return j&&(j.texture||j.renderbuffer)}function $(j,ee,re){j&&(j.texture?j.texture.resize(ee,re):j.renderbuffer&&j.renderbuffer.resize(ee,re),j.width=ee,j.height=re)}var se=0,I={};function ae(){this.id=se++,I[this.id]=this,this.framebuffer=i.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function ne(j){j.colorAttachments.forEach(q),q(j.depthAttachment),q(j.stencilAttachment),q(j.depthStencilAttachment)}function ve(j){var ee=j.framebuffer;l(ee,"must not double destroy framebuffer"),i.deleteFramebuffer(ee),j.framebuffer=null,S.framebufferCount--,delete I[j.id]}function N(j){var ee;i.bindFramebuffer(Zt,j.framebuffer);var re=j.colorAttachments;for(ee=0;ee<re.length;++ee)z(us+ee,re[ee]);for(ee=re.length;ee<h.maxColorAttachments;++ee)i.framebufferTexture2D(Zt,us+ee,pr,null,0);i.framebufferTexture2D(Zt,ds,pr,null,0),i.framebufferTexture2D(Zt,cs,pr,null,0),i.framebufferTexture2D(Zt,Ci,pr,null,0),z(cs,j.depthAttachment),z(Ci,j.stencilAttachment),z(ds,j.depthStencilAttachment);var Ee=i.checkFramebufferStatus(Zt);!i.isContextLost()&&Ee!==fs&&l.raise("framebuffer configuration not supported, status = "+sn[Ee]),i.bindFramebuffer(Zt,R.next?R.next.framebuffer:null),R.cur=R.next,i.getError()}function F(j,ee){var re=new ae;S.framebufferCount++;function Ee(ie,oe){var _e;l(R.next!==re,"can not update framebuffer which is currently in use");var Ce=0,Re=0,et=!0,tt=!0,Fe=null,lt=!0,We="rgba",st="uint8",ut=1,ct=null,vt=null,gt=null,it=!1;if(typeof ie=="number")Ce=ie|0,Re=oe|0||Ce;else if(!ie)Ce=Re=1;else{l.type(ie,"object","invalid arguments for framebuffer");var Pe=ie;if("shape"in Pe){var wt=Pe.shape;l(Array.isArray(wt)&&wt.length>=2,"invalid shape for framebuffer"),Ce=wt[0],Re=wt[1]}else"radius"in Pe&&(Ce=Re=Pe.radius),"width"in Pe&&(Ce=Pe.width),"height"in Pe&&(Re=Pe.height);("color"in Pe||"colors"in Pe)&&(Fe=Pe.color||Pe.colors,Array.isArray(Fe)&&l(Fe.length===1||s.webgl_draw_buffers,"multiple render targets not supported")),Fe||("colorCount"in Pe&&(ut=Pe.colorCount|0,l(ut>0,"invalid color buffer count")),"colorTexture"in Pe&&(lt=!!Pe.colorTexture,We="rgba4"),"colorType"in Pe&&(st=Pe.colorType,lt?(l(s.oes_texture_float||!(st==="float"||st==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),l(s.oes_texture_half_float||!(st==="half float"||st==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):st==="half float"||st==="float16"?(l(s.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),We="rgba16f"):(st==="float"||st==="float32")&&(l(s.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),We="rgba32f"),l.oneOf(st,X,"invalid color type")),"colorFormat"in Pe&&(We=Pe.colorFormat,U.indexOf(We)>=0?lt=!0:G.indexOf(We)>=0?lt=!1:l.optional(function(){lt?l.oneOf(Pe.colorFormat,U,"invalid color format for texture"):l.oneOf(Pe.colorFormat,G,"invalid color format for renderbuffer")}))),("depthTexture"in Pe||"depthStencilTexture"in Pe)&&(it=!!(Pe.depthTexture||Pe.depthStencilTexture),l(!it||s.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Pe&&(typeof Pe.depth=="boolean"?et=Pe.depth:(ct=Pe.depth,tt=!1)),"stencil"in Pe&&(typeof Pe.stencil=="boolean"?tt=Pe.stencil:(vt=Pe.stencil,et=!1)),"depthStencil"in Pe&&(typeof Pe.depthStencil=="boolean"?et=tt=Pe.depthStencil:(gt=Pe.depthStencil,et=!1,tt=!1))}var Ue=null,be=null,Oe=null,Be=null;if(Array.isArray(Fe))Ue=Fe.map(K);else if(Fe)Ue=[K(Fe)];else for(Ue=new Array(ut),_e=0;_e<ut;++_e)Ue[_e]=y(Ce,Re,lt,We,st);l(s.webgl_draw_buffers||Ue.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),l(Ue.length<=h.maxColorAttachments,"too many color attachments, not supported"),Ce=Ce||Ue[0].width,Re=Re||Ue[0].height,ct?be=K(ct):et&&!tt&&(be=y(Ce,Re,it,"depth","uint32")),vt?Oe=K(vt):tt&&!et&&(Oe=y(Ce,Re,!1,"stencil","uint8")),gt?Be=K(gt):!ct&&!vt&&tt&&et&&(Be=y(Ce,Re,it,"depth stencil","depth stencil")),l(!!ct+!!vt+!!gt<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var at=null;for(_e=0;_e<Ue.length;++_e)if(Q(Ue[_e],Ce,Re),l(!Ue[_e]||Ue[_e].texture&&au.indexOf(Ue[_e].texture._texture.format)>=0||Ue[_e].renderbuffer&&ms.indexOf(Ue[_e].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+_e+" is invalid"),Ue[_e]&&Ue[_e].texture){var wr=Ea[Ue[_e].texture._texture.format]*Ai[Ue[_e].texture._texture.type];at===null?at=wr:l(at===wr,"all color attachments much have the same number of bits per pixel.")}return Q(be,Ce,Re),l(!be||be.texture&&be.texture._texture.format===iu||be.renderbuffer&&be.renderbuffer._renderbuffer.format===lu,"invalid depth attachment for framebuffer object"),Q(Oe,Ce,Re),l(!Oe||Oe.renderbuffer&&Oe.renderbuffer._renderbuffer.format===uu,"invalid stencil attachment for framebuffer object"),Q(Be,Ce,Re),l(!Be||Be.texture&&Be.texture._texture.format===vs||Be.renderbuffer&&Be.renderbuffer._renderbuffer.format===vs,"invalid depth-stencil attachment for framebuffer object"),ne(re),re.width=Ce,re.height=Re,re.colorAttachments=Ue,re.depthAttachment=be,re.stencilAttachment=Oe,re.depthStencilAttachment=Be,Ee.color=Ue.map(L),Ee.depth=L(be),Ee.stencil=L(Oe),Ee.depthStencil=L(Be),Ee.width=re.width,Ee.height=re.height,N(re),Ee}function ye(ie,oe){l(R.next!==re,"can not resize a framebuffer which is currently in use");var _e=Math.max(ie|0,1),Ce=Math.max(oe|0||_e,1);if(_e===re.width&&Ce===re.height)return Ee;for(var Re=re.colorAttachments,et=0;et<Re.length;++et)$(Re[et],_e,Ce);return $(re.depthAttachment,_e,Ce),$(re.stencilAttachment,_e,Ce),$(re.depthStencilAttachment,_e,Ce),re.width=Ee.width=_e,re.height=Ee.height=Ce,N(re),Ee}return Ee(j,ee),pe(Ee,{resize:ye,_reglType:"framebuffer",_framebuffer:re,destroy:function(){ve(re),ne(re)},use:function(ie){R.setFBO({framebuffer:Ee},ie)}})}function ce(j){var ee=Array(6);function re(ye){var ie;l(ee.indexOf(R.next)<0,"can not update framebuffer which is currently in use");var oe={color:null},_e=0,Ce=null,Re="rgba",et="uint8",tt=1;if(typeof ye=="number")_e=ye|0;else if(!ye)_e=1;else{l.type(ye,"object","invalid arguments for framebuffer");var Fe=ye;if("shape"in Fe){var lt=Fe.shape;l(Array.isArray(lt)&&lt.length>=2,"invalid shape for framebuffer"),l(lt[0]===lt[1],"cube framebuffer must be square"),_e=lt[0]}else"radius"in Fe&&(_e=Fe.radius|0),"width"in Fe?(_e=Fe.width|0,"height"in Fe&&l(Fe.height===_e,"must be square")):"height"in Fe&&(_e=Fe.height|0);("color"in Fe||"colors"in Fe)&&(Ce=Fe.color||Fe.colors,Array.isArray(Ce)&&l(Ce.length===1||s.webgl_draw_buffers,"multiple render targets not supported")),Ce||("colorCount"in Fe&&(tt=Fe.colorCount|0,l(tt>0,"invalid color buffer count")),"colorType"in Fe&&(l.oneOf(Fe.colorType,X,"invalid color type"),et=Fe.colorType),"colorFormat"in Fe&&(Re=Fe.colorFormat,l.oneOf(Fe.colorFormat,U,"invalid color format for texture"))),"depth"in Fe&&(oe.depth=Fe.depth),"stencil"in Fe&&(oe.stencil=Fe.stencil),"depthStencil"in Fe&&(oe.depthStencil=Fe.depthStencil)}var We;if(Ce)if(Array.isArray(Ce))for(We=[],ie=0;ie<Ce.length;++ie)We[ie]=Ce[ie];else We=[Ce];else{We=Array(tt);var st={radius:_e,format:Re,type:et};for(ie=0;ie<tt;++ie)We[ie]=T.createCube(st)}for(oe.color=Array(We.length),ie=0;ie<We.length;++ie){var ut=We[ie];l(typeof ut=="function"&&ut._reglType==="textureCube","invalid cube map"),_e=_e||ut.width,l(ut.width===_e&&ut.height===_e,"invalid cube map shape"),oe.color[ie]={target:Ei,data:We[ie]}}for(ie=0;ie<6;++ie){for(var ct=0;ct<We.length;++ct)oe.color[ct].target=Ei+ie;ie>0&&(oe.depth=ee[0].depth,oe.stencil=ee[0].stencil,oe.depthStencil=ee[0].depthStencil),ee[ie]?ee[ie](oe):ee[ie]=F(oe)}return pe(re,{width:_e,height:_e,color:We})}function Ee(ye){var ie,oe=ye|0;if(l(oe>0&&oe<=h.maxCubeMapSize,"invalid radius for cube fbo"),oe===re.width)return re;var _e=re.color;for(ie=0;ie<_e.length;++ie)_e[ie].resize(oe);for(ie=0;ie<6;++ie)ee[ie].resize(oe);return re.width=re.height=oe,re}return re(j),pe(re,{faces:ee,resize:Ee,_reglType:"framebufferCube",destroy:function(){ee.forEach(function(ye){ye.destroy()})}})}function J(){R.cur=null,R.next=null,R.dirty=!0,Tt(I).forEach(function(j){j.framebuffer=i.createFramebuffer(),N(j)})}return pe(R,{getFramebuffer:function(j){if(typeof j=="function"&&j._reglType==="framebuffer"){var ee=j._framebuffer;if(ee instanceof ae)return ee}return null},create:F,createCube:ce,clear:function(){Tt(I).forEach(ve)},restore:J})}var Aa=5126,Sa=34962,jn=34963,bs=["attributes","elements","offset","count","primitive","instances"];function Pa(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Aa,this.offset=0,this.stride=0,this.divisor=0}function hu(i,s,h,T,V,S,R){for(var U=h.maxAttributes,G=new Array(U),X=0;X<U;++X)G[X]=new Pa;var W=0,q={},Q={Record:Pa,scope:{},state:G,currentVAO:null,targetVAO:null,restore:K()?ne:function(){},createVAO:ve,getVAO:L,destroyBuffer:z,setVAO:K()?$:se,clear:K()?I:function(){}};function z(N){for(var F=0;F<G.length;++F){var ce=G[F];ce.buffer===N&&(i.disableVertexAttribArray(F),ce.buffer=null)}}function K(){return s.oes_vertex_array_object}function y(){return s.angle_instanced_arrays}function L(N){return typeof N=="function"&&N._vao?N._vao:null}function $(N){if(N!==Q.currentVAO){var F=K();N?F.bindVertexArrayOES(N.vao):F.bindVertexArrayOES(null),Q.currentVAO=N}}function se(N){if(N!==Q.currentVAO){if(N)N.bindAttrs();else{for(var F=y(),ce=0;ce<G.length;++ce){var J=G[ce];J.buffer?(i.enableVertexAttribArray(ce),J.buffer.bind(),i.vertexAttribPointer(ce,J.size,J.type,J.normalized,J.stride,J.offfset),F&&J.divisor&&F.vertexAttribDivisorANGLE(ce,J.divisor)):(i.disableVertexAttribArray(ce),i.vertexAttrib4f(ce,J.x,J.y,J.z,J.w))}R.elements?i.bindBuffer(jn,R.elements.buffer.buffer):i.bindBuffer(jn,null)}Q.currentVAO=N}}function I(){Tt(q).forEach(function(N){N.destroy()})}function ae(){this.id=++W,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var N=K();N?this.vao=N.createVertexArrayOES():this.vao=null,q[this.id]=this,this.buffers=[]}ae.prototype.bindAttrs=function(){for(var N=y(),F=this.attributes,ce=0;ce<F.length;++ce){var J=F[ce];J.buffer?(i.enableVertexAttribArray(ce),i.bindBuffer(Sa,J.buffer.buffer),i.vertexAttribPointer(ce,J.size,J.type,J.normalized,J.stride,J.offset),N&&J.divisor&&N.vertexAttribDivisorANGLE(ce,J.divisor)):(i.disableVertexAttribArray(ce),i.vertexAttrib4f(ce,J.x,J.y,J.z,J.w))}for(var j=F.length;j<U;++j)i.disableVertexAttribArray(j);var ee=S.getElements(this.elements);ee?i.bindBuffer(jn,ee.buffer.buffer):i.bindBuffer(jn,null)},ae.prototype.refresh=function(){var N=K();N&&(N.bindVertexArrayOES(this.vao),this.bindAttrs(),Q.currentVAO=null,N.bindVertexArrayOES(null))},ae.prototype.destroy=function(){if(this.vao){var N=K();this===Q.currentVAO&&(Q.currentVAO=null,N.bindVertexArrayOES(null)),N.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),q[this.id]&&(delete q[this.id],T.vaoCount-=1)};function ne(){var N=K();N&&Tt(q).forEach(function(F){F.refresh()})}function ve(N){var F=new ae;T.vaoCount+=1;function ce(J){var j;if(Array.isArray(J))j=J,F.elements&&F.ownsElements&&F.elements.destroy(),F.elements=null,F.ownsElements=!1,F.offset=0,F.count=0,F.instances=-1,F.primitive=4;else{if(l(typeof J=="object","invalid arguments for create vao"),l("attributes"in J,"must specify attributes for vao"),J.elements){var ee=J.elements;F.ownsElements?typeof ee=="function"&&ee._reglType==="elements"?(F.elements.destroy(),F.ownsElements=!1):(F.elements(ee),F.ownsElements=!1):S.getElements(J.elements)?(F.elements=J.elements,F.ownsElements=!1):(F.elements=S.create(J.elements),F.ownsElements=!0)}else F.elements=null,F.ownsElements=!1;j=J.attributes,F.offset=0,F.count=-1,F.instances=-1,F.primitive=4,F.elements&&(F.count=F.elements._elements.vertCount,F.primitive=F.elements._elements.primType),"offset"in J&&(F.offset=J.offset|0),"count"in J&&(F.count=J.count|0),"instances"in J&&(F.instances=J.instances|0),"primitive"in J&&(l(J.primitive in _t,"bad primitive type: "+J.primitive),F.primitive=_t[J.primitive]),l.optional(()=>{for(var et=Object.keys(J),tt=0;tt<et.length;++tt)l(bs.indexOf(et[tt])>=0,'invalid option for vao: "'+et[tt]+'" valid options are '+bs)}),l(Array.isArray(j),"attributes must be an array")}l(j.length<U,"too many attributes"),l(j.length>0,"must specify at least one attribute");var re={},Ee=F.attributes;Ee.length=j.length;for(var ye=0;ye<j.length;++ye){var ie=j[ye],oe=Ee[ye]=new Pa,_e=ie.data||ie;if(Array.isArray(_e)||Z(_e)||Lt(_e)){var Ce;F.buffers[ye]&&(Ce=F.buffers[ye],Z(_e)&&Ce._buffer.byteLength>=_e.byteLength?Ce.subdata(_e):(Ce.destroy(),F.buffers[ye]=null)),F.buffers[ye]||(Ce=F.buffers[ye]=V.create(ie,Sa,!1,!0)),oe.buffer=V.getBuffer(Ce),oe.size=oe.buffer.dimension|0,oe.normalized=!1,oe.type=oe.buffer.dtype,oe.offset=0,oe.stride=0,oe.divisor=0,oe.state=1,re[ye]=1}else V.getBuffer(ie)?(oe.buffer=V.getBuffer(ie),oe.size=oe.buffer.dimension|0,oe.normalized=!1,oe.type=oe.buffer.dtype,oe.offset=0,oe.stride=0,oe.divisor=0,oe.state=1):V.getBuffer(ie.buffer)?(oe.buffer=V.getBuffer(ie.buffer),oe.size=(+ie.size||oe.buffer.dimension)|0,oe.normalized=!!ie.normalized||!1,"type"in ie?(l.parameter(ie.type,Pr,"invalid buffer type"),oe.type=Pr[ie.type]):oe.type=oe.buffer.dtype,oe.offset=(ie.offset||0)|0,oe.stride=(ie.stride||0)|0,oe.divisor=(ie.divisor||0)|0,oe.state=1,l(oe.size>=1&&oe.size<=4,"size must be between 1 and 4"),l(oe.offset>=0,"invalid offset"),l(oe.stride>=0&&oe.stride<=255,"stride must be between 0 and 255"),l(oe.divisor>=0,"divisor must be positive"),l(!oe.divisor||!!s.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in ie?(l(ye>0,"first attribute must not be a constant"),oe.x=+ie.x||0,oe.y=+ie.y||0,oe.z=+ie.z||0,oe.w=+ie.w||0,oe.state=2):l(!1,"invalid attribute spec for location "+ye)}for(var Re=0;Re<F.buffers.length;++Re)!re[Re]&&F.buffers[Re]&&(F.buffers[Re].destroy(),F.buffers[Re]=null);return F.refresh(),ce}return ce.destroy=function(){for(var J=0;J<F.buffers.length;++J)F.buffers[J]&&F.buffers[J].destroy();F.buffers.length=0,F.ownsElements&&(F.elements.destroy(),F.elements=null,F.ownsElements=!1),F.destroy()},ce._vao=F,ce._reglType="vao",ce(N)}return Q}var _s=35632,vr=35633,gs=35718,ln=35721;function vu(i,s,h,T){var V={},S={};function R(y,L,$,se){this.name=y,this.id=L,this.location=$,this.info=se}function U(y,L){for(var $=0;$<y.length;++$)if(y[$].id===L.id){y[$].location=L.location;return}y.push(L)}function G(y,L,$){var se=y===_s?V:S,I=se[L];if(!I){var ae=s.str(L);I=i.createShader(y),i.shaderSource(I,ae),i.compileShader(I),l.shaderError(i,I,ae,y,$),se[L]=I}return I}var X={},W=[],q=0;function Q(y,L){this.id=q++,this.fragId=y,this.vertId=L,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,T.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function z(y,L,$){var se,I,ae=G(_s,y.fragId),ne=G(vr,y.vertId),ve=y.program=i.createProgram();if(i.attachShader(ve,ae),i.attachShader(ve,ne),$)for(se=0;se<$.length;++se){var N=$[se];i.bindAttribLocation(ve,N[0],N[1])}i.linkProgram(ve),l.linkError(i,ve,s.str(y.fragId),s.str(y.vertId),L);var F=i.getProgramParameter(ve,gs);T.profile&&(y.stats.uniformsCount=F);var ce=y.uniforms;for(se=0;se<F;++se)if(I=i.getActiveUniform(ve,se),I){if(I.size>1)for(var J=0;J<I.size;++J){var j=I.name.replace("[0]","["+J+"]");U(ce,new R(j,s.id(j),i.getUniformLocation(ve,j),I))}var ee=I.name;I.size>1&&(ee=ee.replace("[0]","")),U(ce,new R(ee,s.id(ee),i.getUniformLocation(ve,ee),I))}var re=i.getProgramParameter(ve,ln);T.profile&&(y.stats.attributesCount=re);var Ee=y.attributes;for(se=0;se<re;++se)I=i.getActiveAttrib(ve,se),I&&U(Ee,new R(I.name,s.id(I.name),i.getAttribLocation(ve,I.name),I))}T.profile&&(h.getMaxUniformsCount=function(){var y=0;return W.forEach(function(L){L.stats.uniformsCount>y&&(y=L.stats.uniformsCount)}),y},h.getMaxAttributesCount=function(){var y=0;return W.forEach(function(L){L.stats.attributesCount>y&&(y=L.stats.attributesCount)}),y});function K(){V={},S={};for(var y=0;y<W.length;++y)z(W[y],null,W[y].attributes.map(function(L){return[L.location,L.name]}))}return{clear:function(){var y=i.deleteShader.bind(i);Tt(V).forEach(y),V={},Tt(S).forEach(y),S={},W.forEach(function(L){i.deleteProgram(L.program)}),W.length=0,X={},h.shaderCount=0},program:function(y,L,$,se){l.command(y>=0,"missing vertex shader",$),l.command(L>=0,"missing fragment shader",$);var I=X[L];I||(I=X[L]={});var ae=I[y];if(ae&&(ae.refCount++,!se))return ae;var ne=new Q(L,y);return h.shaderCount++,z(ne,$,se),ae||(I[y]=ne),W.push(ne),pe(ne,{destroy:function(){if(ne.refCount--,ne.refCount<=0){i.deleteProgram(ne.program);var ve=W.indexOf(ne);W.splice(ve,1),h.shaderCount--}I[ne.vertId].refCount<=0&&(i.deleteShader(S[ne.vertId]),delete S[ne.vertId],delete X[ne.fragId][ne.vertId]),Object.keys(X[ne.fragId]).length||(i.deleteShader(V[ne.fragId]),delete V[ne.fragId],delete X[ne.fragId])}})},restore:K,shader:G,frag:-1,vert:-1}}var mr=6408,Hn=5121,ws=3333,Si=5126;function mu(i,s,h,T,V,S,R){function U(W){var q;s.next===null?(l(V.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),q=Hn):(l(s.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),q=s.next.colorAttachments[0].texture._texture.type,l.optional(function(){S.oes_texture_float?(l(q===Hn||q===Si,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),q===Si&&l(R.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):l(q===Hn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var Q=0,z=0,K=T.framebufferWidth,y=T.framebufferHeight,L=null;Z(W)?L=W:W&&(l.type(W,"object","invalid arguments to regl.read()"),Q=W.x|0,z=W.y|0,l(Q>=0&&Q<T.framebufferWidth,"invalid x offset for regl.read"),l(z>=0&&z<T.framebufferHeight,"invalid y offset for regl.read"),K=(W.width||T.framebufferWidth-Q)|0,y=(W.height||T.framebufferHeight-z)|0,L=W.data||null),L&&(q===Hn?l(L instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):q===Si&&l(L instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),l(K>0&&K+Q<=T.framebufferWidth,"invalid width for read pixels"),l(y>0&&y+z<=T.framebufferHeight,"invalid height for read pixels"),h();var $=K*y*4;return L||(q===Hn?L=new Uint8Array($):q===Si&&(L=L||new Float32Array($))),l.isTypedArray(L,"data buffer for regl.read() must be a typedarray"),l(L.byteLength>=$,"data buffer for regl.read() too small"),i.pixelStorei(ws,4),i.readPixels(Q,z,K,y,mr,q,L),L}function G(W){var q;return s.setFBO({framebuffer:W.framebuffer},function(){q=U(W)}),q}function X(W){return!W||!("framebuffer"in W)?U(W):G(W)}return X}function un(i){return Array.prototype.slice.call(i)}function cn(i){return un(i).join("")}function Jt(){var i=0,s=[],h=[];function T(q){for(var Q=0;Q<h.length;++Q)if(h[Q]===q)return s[Q];var z="g"+i++;return s.push(z),h.push(q),z}function V(){var q=[];function Q(){q.push.apply(q,un(arguments))}var z=[];function K(){var y="v"+i++;return z.push(y),arguments.length>0&&(q.push(y,"="),q.push.apply(q,un(arguments)),q.push(";")),y}return pe(Q,{def:K,toString:function(){return cn([z.length>0?"var "+z.join(",")+";":"",cn(q)])}})}function S(){var q=V(),Q=V(),z=q.toString,K=Q.toString;function y(L,$){Q(L,$,"=",q.def(L,$),";")}return pe(function(){q.apply(q,un(arguments))},{def:q.def,entry:q,exit:Q,save:y,set:function(L,$,se){y(L,$),q(L,$,"=",se,";")},toString:function(){return z()+K()}})}function R(){var q=cn(arguments),Q=S(),z=S(),K=Q.toString,y=z.toString;return pe(Q,{then:function(){return Q.apply(Q,un(arguments)),this},else:function(){return z.apply(z,un(arguments)),this},toString:function(){var L=y();return L&&(L="else{"+L+"}"),cn(["if(",q,"){",K(),"}",L])}})}var U=V(),G={};function X(q,Q){var z=[];function K(){var I="a"+z.length;return z.push(I),I}Q=Q||0;for(var y=0;y<Q;++y)K();var L=S(),$=L.toString,se=G[q]=pe(L,{arg:K,toString:function(){return cn(["function(",z.join(),"){",$(),"}"])}});return se}function W(){var q=['"use strict";',U,"return {"];Object.keys(G).forEach(function(K){q.push('"',K,'":',G[K].toString(),",")}),q.push("}");var Q=cn(q).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),z=Function.apply(null,s.concat(Q));return z.apply(null,h)}return{global:U,link:T,block:V,proc:X,scope:S,cond:R,compile:W}}var dn="xyzw".split(""),Ta=5121,fn=1,Pi=2,ka=0,La=1,br=2,Ti=3,ki=4,ys=5,xs=6,Li="dither",Es="blend.enable",Vr="blend.color",Ri="blend.equation",Ra="blend.func",Cs="depth.enable",As="depth.func",Ss="depth.range",Ps="depth.mask",Oa="colorMask",Ts="cull.enable",pn="cull.face",Oi="frontFace",Da="lineWidth",Di="polygonOffset.enable",Fi="polygonOffset.offset",ks="sample.alpha",Vi="sample.enable",Fa="sample.coverage",er="stencil.enable",Ls="stencil.mask",Va="stencil.func",$n="stencil.opFront",Kn="stencil.opBack",Rs="scissor.enable",Xn="scissor.box",tr="viewport",qn="profile",Nr="framebuffer",Wn="vert",Yn="frag",Br="elements",Mr="primitive",Ir="count",Ni="offset",Qn="instances",hn="vao",Bi="Width",Na="Height",vn=Nr+Bi,mn=Nr+Na,bu=tr+Bi,_u=tr+Na,Os="drawingBuffer",Ds=Os+Bi,Fs=Os+Na,Vs=[Ra,Ri,Va,$n,Kn,Fa,tr,Xn,Fi],bn=34962,Ba=34963,r=35632,e=35633,t=3553,n=34067,a=2884,m=3042,P=3024,te=2960,xe=2929,ke=3089,je=32823,He=32926,rr=32928,Gr=5126,_r=35664,nr=35665,Ns=35666,gu=5124,Bs=35667,Ms=35668,Is=35669,wu=35670,Gs=35671,Us=35672,zs=35673,Ma=35674,Ia=35675,Ga=35676,Ua=35678,za=35680,yu=4,ja=1028,Zn=1029,Lu=2304,xu=2305,Zu=32775,Ju=32776,ec=519,_n=7680,Ru=0,Ou=1,Du=32774,tc=513,Fu=36160,rc=36064,gr={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Vu=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Mi={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},gn={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Nu={frag:r,vert:e},Eu={cw:Lu,ccw:xu};function js(i){return Array.isArray(i)||Z(i)||Lt(i)}function Bu(i){return i.sort(function(s,h){return s===tr?-1:h===tr?1:s<h?-1:1})}function pt(i,s,h,T){this.thisDep=i,this.contextDep=s,this.propDep=h,this.append=T}function wn(i){return i&&!(i.thisDep||i.contextDep||i.propDep)}function ot(i){return new pt(!1,!1,!1,i)}function Ot(i,s){var h=i.type;if(h===ka){var T=i.data.length;return new pt(!0,T>=1,T>=2,s)}else if(h===ki){var V=i.data;return new pt(V.thisDep,V.contextDep,V.propDep,s)}else{if(h===ys)return new pt(!1,!1,!1,s);if(h===xs){for(var S=!1,R=!1,U=!1,G=0;G<i.data.length;++G){var X=i.data[G];if(X.type===La)U=!0;else if(X.type===br)R=!0;else if(X.type===Ti)S=!0;else if(X.type===ka){S=!0;var W=X.data;W>=1&&(R=!0),W>=2&&(U=!0)}else X.type===ki&&(S=S||X.data.thisDep,R=R||X.data.contextDep,U=U||X.data.propDep)}return new pt(S,R,U,s)}else return new pt(h===Ti,h===br,h===La,s)}}var Mu=new pt(!1,!1,!1,function(){});function nc(i,s,h,T,V,S,R,U,G,X,W,q,Q,z,K){var y=X.Record,L={add:32774,subtract:32778,"reverse subtract":32779};h.ext_blend_minmax&&(L.min=Zu,L.max=Ju);var $=h.angle_instanced_arrays,se=h.webgl_draw_buffers,I=h.oes_vertex_array_object,ae={dirty:!0,profile:K.profile},ne={},ve=[],N={},F={};function ce(u){return u.replace(".","_")}function J(u,o,v){var w=ce(u);ve.push(u),ne[w]=ae[w]=!!v,N[w]=o}function j(u,o,v){var w=ce(u);ve.push(u),Array.isArray(v)?(ae[w]=v.slice(),ne[w]=v.slice()):ae[w]=ne[w]=v,F[w]=o}J(Li,P),J(Es,m),j(Vr,"blendColor",[0,0,0,0]),j(Ri,"blendEquationSeparate",[Du,Du]),j(Ra,"blendFuncSeparate",[Ou,Ru,Ou,Ru]),J(Cs,xe,!0),j(As,"depthFunc",tc),j(Ss,"depthRange",[0,1]),j(Ps,"depthMask",!0),j(Oa,Oa,[!0,!0,!0,!0]),J(Ts,a),j(pn,"cullFace",Zn),j(Oi,Oi,xu),j(Da,Da,1),J(Di,je),j(Fi,"polygonOffset",[0,0]),J(ks,He),J(Vi,rr),j(Fa,"sampleCoverage",[1,!1]),J(er,te),j(Ls,"stencilMask",-1),j(Va,"stencilFunc",[ec,0,-1]),j($n,"stencilOpSeparate",[ja,_n,_n,_n]),j(Kn,"stencilOpSeparate",[Zn,_n,_n,_n]),J(Rs,ke),j(Xn,"scissor",[0,0,i.drawingBufferWidth,i.drawingBufferHeight]),j(tr,tr,[0,0,i.drawingBufferWidth,i.drawingBufferHeight]);var ee={gl:i,context:Q,strings:s,next:ne,current:ae,draw:q,elements:S,buffer:V,shader:W,attributes:X.state,vao:X,uniforms:G,framebuffer:U,extensions:h,timer:z,isBufferArgs:js},re={primTypes:_t,compareFuncs:Mi,blendFuncs:gr,blendEquations:L,stencilOps:gn,glTypes:Pr,orientationType:Eu};l.optional(function(){ee.isArrayLike=Ke}),se&&(re.backBuffer=[Zn],re.drawBuffer=At(T.maxDrawbuffers,function(u){return u===0?[0]:At(u,function(o){return rc+o})}));var Ee=0;function ye(){var u=Jt(),o=u.link,v=u.global;u.id=Ee++,u.batchId="0";var w=o(ee),x=u.shared={props:"a0"};Object.keys(ee).forEach(function(p){x[p]=v.def(w,".",p)}),l.optional(function(){u.CHECK=o(l),u.commandStr=l.guessCommand(),u.command=o(u.commandStr),u.assert=function(p,d,C){p("if(!(",d,"))",this.CHECK,".commandRaise(",o(C),",",this.command,");")},re.invalidBlendCombinations=Vu});var _=u.next={},b=u.current={};Object.keys(F).forEach(function(p){Array.isArray(ae[p])&&(_[p]=v.def(x.next,".",p),b[p]=v.def(x.current,".",p))});var g=u.constants={};Object.keys(re).forEach(function(p){g[p]=v.def(JSON.stringify(re[p]))}),u.invoke=function(p,d){switch(d.type){case ka:var C=["this",x.context,x.props,u.batchId];return p.def(o(d.data),".call(",C.slice(0,Math.max(d.data.length+1,4)),")");case La:return p.def(x.props,d.data);case br:return p.def(x.context,d.data);case Ti:return p.def("this",d.data);case ki:return d.data.append(u,p),d.data.ref;case ys:return d.data.toString();case xs:return d.data.map(function(E){return u.invoke(p,E)})}},u.attribCache={};var c={};return u.scopeAttrib=function(p){var d=s.id(p);if(d in c)return c[d];var C=X.scope[d];C||(C=X.scope[d]=new y);var E=c[d]=o(C);return E},u}function ie(u){var o=u.static,v=u.dynamic,w;if(qn in o){var x=!!o[qn];w=ot(function(b,g){return x}),w.enable=x}else if(qn in v){var _=v[qn];w=Ot(_,function(b,g){return b.invoke(g,_)})}return w}function oe(u,o){var v=u.static,w=u.dynamic;if(Nr in v){var x=v[Nr];return x?(x=U.getFramebuffer(x),l.command(x,"invalid framebuffer object"),ot(function(b,g){var c=b.link(x),p=b.shared;g.set(p.framebuffer,".next",c);var d=p.context;return g.set(d,"."+vn,c+".width"),g.set(d,"."+mn,c+".height"),c})):ot(function(b,g){var c=b.shared;g.set(c.framebuffer,".next","null");var p=c.context;return g.set(p,"."+vn,p+"."+Ds),g.set(p,"."+mn,p+"."+Fs),"null"})}else if(Nr in w){var _=w[Nr];return Ot(_,function(b,g){var c=b.invoke(g,_),p=b.shared,d=p.framebuffer,C=g.def(d,".getFramebuffer(",c,")");l.optional(function(){b.assert(g,"!"+c+"||"+C,"invalid framebuffer object")}),g.set(d,".next",C);var E=p.context;return g.set(E,"."+vn,C+"?"+C+".width:"+E+"."+Ds),g.set(E,"."+mn,C+"?"+C+".height:"+E+"."+Fs),C})}else return null}function _e(u,o,v){var w=u.static,x=u.dynamic;function _(c){if(c in w){var p=w[c];l.commandType(p,"object","invalid "+c,v.commandStr);var d=!0,C=p.x|0,E=p.y|0,D,B;return"width"in p?(D=p.width|0,l.command(D>=0,"invalid "+c,v.commandStr)):d=!1,"height"in p?(B=p.height|0,l.command(B>=0,"invalid "+c,v.commandStr)):d=!1,new pt(!d&&o&&o.thisDep,!d&&o&&o.contextDep,!d&&o&&o.propDep,function(he,le){var M=he.shared.context,O=D;"width"in p||(O=le.def(M,".",vn,"-",C));var fe=B;return"height"in p||(fe=le.def(M,".",mn,"-",E)),[C,E,O,fe]})}else if(c in x){var Y=x[c],we=Ot(Y,function(he,le){var M=he.invoke(le,Y);l.optional(function(){he.assert(le,M+"&&typeof "+M+'==="object"',"invalid "+c)});var O=he.shared.context,fe=le.def(M,".x|0"),de=le.def(M,".y|0"),ge=le.def('"width" in ',M,"?",M,".width|0:","(",O,".",vn,"-",fe,")"),ze=le.def('"height" in ',M,"?",M,".height|0:","(",O,".",mn,"-",de,")");return l.optional(function(){he.assert(le,ge+">=0&&"+ze+">=0","invalid "+c)}),[fe,de,ge,ze]});return o&&(we.thisDep=we.thisDep||o.thisDep,we.contextDep=we.contextDep||o.contextDep,we.propDep=we.propDep||o.propDep),we}else return o?new pt(o.thisDep,o.contextDep,o.propDep,function(he,le){var M=he.shared.context;return[0,0,le.def(M,".",vn),le.def(M,".",mn)]}):null}var b=_(tr);if(b){var g=b;b=new pt(b.thisDep,b.contextDep,b.propDep,function(c,p){var d=g.append(c,p),C=c.shared.context;return p.set(C,"."+bu,d[2]),p.set(C,"."+_u,d[3]),d})}return{viewport:b,scissor_box:_(Xn)}}function Ce(u,o){var v=u.static,w=typeof v[Yn]=="string"&&typeof v[Wn]=="string";if(w){if(Object.keys(o.dynamic).length>0)return null;var x=o.static,_=Object.keys(x);if(_.length>0&&typeof x[_[0]]=="number"){for(var b=[],g=0;g<_.length;++g)l(typeof x[_[g]]=="number","must specify all vertex attribute locations when using vaos"),b.push([x[_[g]]|0,_[g]]);return b}}return null}function Re(u,o,v){var w=u.static,x=u.dynamic;function _(d){if(d in w){var C=s.id(w[d]);l.optional(function(){W.shader(Nu[d],C,l.guessCommand())});var E=ot(function(){return C});return E.id=C,E}else if(d in x){var D=x[d];return Ot(D,function(B,Y){var we=B.invoke(Y,D),he=Y.def(B.shared.strings,".id(",we,")");return l.optional(function(){Y(B.shared.shader,".shader(",Nu[d],",",he,",",B.command,");")}),he})}return null}var b=_(Yn),g=_(Wn),c=null,p;return wn(b)&&wn(g)?(c=W.program(g.id,b.id,null,v),p=ot(function(d,C){return d.link(c)})):p=new pt(b&&b.thisDep||g&&g.thisDep,b&&b.contextDep||g&&g.contextDep,b&&b.propDep||g&&g.propDep,function(d,C){var E=d.shared.shader,D;b?D=b.append(d,C):D=C.def(E,".",Yn);var B;g?B=g.append(d,C):B=C.def(E,".",Wn);var Y=E+".program("+B+","+D;return l.optional(function(){Y+=","+d.command}),C.def(Y+")")}),{frag:b,vert:g,progVar:p,program:c}}function et(u,o){var v=u.static,w=u.dynamic,x={},_=!1;function b(){if(hn in v){var le=v[hn];return le!==null&&X.getVAO(le)===null&&(le=X.createVAO(le)),_=!0,x.vao=le,ot(function(O){var fe=X.getVAO(le);return fe?O.link(fe):"null"})}else if(hn in w){_=!0;var M=w[hn];return Ot(M,function(O,fe){var de=O.invoke(fe,M);return fe.def(O.shared.vao+".getVAO("+de+")")})}return null}var g=b(),c=!1;function p(){if(Br in v){var le=v[Br];if(x.elements=le,js(le)){var M=x.elements=S.create(le,!0);le=S.getElements(M),c=!0}else le&&(le=S.getElements(le),c=!0,l.command(le,"invalid elements",o.commandStr));var O=ot(function(de,ge){if(le){var ze=de.link(le);return de.ELEMENTS=ze,ze}return de.ELEMENTS=null,null});return O.value=le,O}else if(Br in w){c=!0;var fe=w[Br];return Ot(fe,function(de,ge){var ze=de.shared,yt=ze.isBufferArgs,ei=ze.elements,Ur=de.invoke(ge,fe),yr=ge.def("null"),yn=ge.def(yt,"(",Ur,")"),ti=de.cond(yn).then(yr,"=",ei,".createStream(",Ur,");").else(yr,"=",ei,".getElements(",Ur,");");return l.optional(function(){de.assert(ti.else,"!"+Ur+"||"+yr,"invalid elements")}),ge.entry(ti),ge.exit(de.cond(yn).then(ei,".destroyStream(",yr,");")),de.ELEMENTS=yr,yr})}else if(_)return new pt(g.thisDep,g.contextDep,g.propDep,function(de,ge){return ge.def(de.shared.vao+".currentVAO?"+de.shared.elements+".getElements("+de.shared.vao+".currentVAO.elements):null")});return null}var d=p();function C(){if(Mr in v){var le=v[Mr];return x.primitive=le,l.commandParameter(le,_t,"invalid primitve",o.commandStr),ot(function(O,fe){return _t[le]})}else if(Mr in w){var M=w[Mr];return Ot(M,function(O,fe){var de=O.constants.primTypes,ge=O.invoke(fe,M);return l.optional(function(){O.assert(fe,ge+" in "+de,"invalid primitive, must be one of "+Object.keys(_t))}),fe.def(de,"[",ge,"]")})}else{if(c)return wn(d)?d.value?ot(function(O,fe){return fe.def(O.ELEMENTS,".primType")}):ot(function(){return yu}):new pt(d.thisDep,d.contextDep,d.propDep,function(O,fe){var de=O.ELEMENTS;return fe.def(de,"?",de,".primType:",yu)});if(_)return new pt(g.thisDep,g.contextDep,g.propDep,function(O,fe){return fe.def(O.shared.vao+".currentVAO?"+O.shared.vao+".currentVAO.primitive:"+yu)})}return null}function E(le,M){if(le in v){var O=v[le]|0;return M?x.offset=O:x.instances=O,l.command(!M||O>=0,"invalid "+le,o.commandStr),ot(function(de,ge){return M&&(de.OFFSET=O),O})}else if(le in w){var fe=w[le];return Ot(fe,function(de,ge){var ze=de.invoke(ge,fe);return M&&(de.OFFSET=ze,l.optional(function(){de.assert(ge,ze+">=0","invalid "+le)})),ze})}else if(M){if(c)return ot(function(de,ge){return de.OFFSET=0,0});if(_)return new pt(g.thisDep,g.contextDep,g.propDep,function(de,ge){return ge.def(de.shared.vao+".currentVAO?"+de.shared.vao+".currentVAO.offset:0")})}else if(_)return new pt(g.thisDep,g.contextDep,g.propDep,function(de,ge){return ge.def(de.shared.vao+".currentVAO?"+de.shared.vao+".currentVAO.instances:-1")});return null}var D=E(Ni,!0);function B(){if(Ir in v){var le=v[Ir]|0;return x.count=le,l.command(typeof le=="number"&&le>=0,"invalid vertex count",o.commandStr),ot(function(){return le})}else if(Ir in w){var M=w[Ir];return Ot(M,function(ge,ze){var yt=ge.invoke(ze,M);return l.optional(function(){ge.assert(ze,"typeof "+yt+'==="number"&&'+yt+">=0&&"+yt+"===("+yt+"|0)","invalid vertex count")}),yt})}else if(c)if(wn(d)){if(d)return D?new pt(D.thisDep,D.contextDep,D.propDep,function(ge,ze){var yt=ze.def(ge.ELEMENTS,".vertCount-",ge.OFFSET);return l.optional(function(){ge.assert(ze,yt+">=0","invalid vertex offset/element buffer too small")}),yt}):ot(function(ge,ze){return ze.def(ge.ELEMENTS,".vertCount")});var O=ot(function(){return-1});return l.optional(function(){O.MISSING=!0}),O}else{var fe=new pt(d.thisDep||D.thisDep,d.contextDep||D.contextDep,d.propDep||D.propDep,function(ge,ze){var yt=ge.ELEMENTS;return ge.OFFSET?ze.def(yt,"?",yt,".vertCount-",ge.OFFSET,":-1"):ze.def(yt,"?",yt,".vertCount:-1")});return l.optional(function(){fe.DYNAMIC=!0}),fe}else if(_){var de=new pt(g.thisDep,g.contextDep,g.propDep,function(ge,ze){return ze.def(ge.shared.vao,".currentVAO?",ge.shared.vao,".currentVAO.count:-1")});return de}return null}var Y=C(),we=B(),he=E(Qn,!1);return{elements:d,primitive:Y,count:we,instances:he,offset:D,vao:g,vaoActive:_,elementsActive:c,static:x}}function tt(u,o){var v=u.static,w=u.dynamic,x={};return ve.forEach(function(_){var b=ce(_);function g(c,p){if(_ in v){var d=c(v[_]);x[b]=ot(function(){return d})}else if(_ in w){var C=w[_];x[b]=Ot(C,function(E,D){return p(E,D,E.invoke(D,C))})}}switch(_){case Ts:case Es:case Li:case er:case Cs:case Rs:case Di:case ks:case Vi:case Ps:return g(function(c){return l.commandType(c,"boolean",_,o.commandStr),c},function(c,p,d){return l.optional(function(){c.assert(p,"typeof "+d+'==="boolean"',"invalid flag "+_,c.commandStr)}),d});case As:return g(function(c){return l.commandParameter(c,Mi,"invalid "+_,o.commandStr),Mi[c]},function(c,p,d){var C=c.constants.compareFuncs;return l.optional(function(){c.assert(p,d+" in "+C,"invalid "+_+", must be one of "+Object.keys(Mi))}),p.def(C,"[",d,"]")});case Ss:return g(function(c){return l.command(Ke(c)&&c.length===2&&typeof c[0]=="number"&&typeof c[1]=="number"&&c[0]<=c[1],"depth range is 2d array",o.commandStr),c},function(c,p,d){l.optional(function(){c.assert(p,c.shared.isArrayLike+"("+d+")&&"+d+".length===2&&typeof "+d+'[0]==="number"&&typeof '+d+'[1]==="number"&&'+d+"[0]<="+d+"[1]","depth range must be a 2d array")});var C=p.def("+",d,"[0]"),E=p.def("+",d,"[1]");return[C,E]});case Ra:return g(function(c){l.commandType(c,"object","blend.func",o.commandStr);var p="srcRGB"in c?c.srcRGB:c.src,d="srcAlpha"in c?c.srcAlpha:c.src,C="dstRGB"in c?c.dstRGB:c.dst,E="dstAlpha"in c?c.dstAlpha:c.dst;return l.commandParameter(p,gr,b+".srcRGB",o.commandStr),l.commandParameter(d,gr,b+".srcAlpha",o.commandStr),l.commandParameter(C,gr,b+".dstRGB",o.commandStr),l.commandParameter(E,gr,b+".dstAlpha",o.commandStr),l.command(Vu.indexOf(p+", "+C)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+p+", "+C+")",o.commandStr),[gr[p],gr[C],gr[d],gr[E]]},function(c,p,d){var C=c.constants.blendFuncs;l.optional(function(){c.assert(p,d+"&&typeof "+d+'==="object"',"invalid blend func, must be an object")});function E(M,O){var fe=p.def('"',M,O,'" in ',d,"?",d,".",M,O,":",d,".",M);return l.optional(function(){c.assert(p,fe+" in "+C,"invalid "+_+"."+M+O+", must be one of "+Object.keys(gr))}),fe}var D=E("src","RGB"),B=E("dst","RGB");l.optional(function(){var M=c.constants.invalidBlendCombinations;c.assert(p,M+".indexOf("+D+'+", "+'+B+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Y=p.def(C,"[",D,"]"),we=p.def(C,"[",E("src","Alpha"),"]"),he=p.def(C,"[",B,"]"),le=p.def(C,"[",E("dst","Alpha"),"]");return[Y,he,we,le]});case Ri:return g(function(c){if(typeof c=="string")return l.commandParameter(c,L,"invalid "+_,o.commandStr),[L[c],L[c]];if(typeof c=="object")return l.commandParameter(c.rgb,L,_+".rgb",o.commandStr),l.commandParameter(c.alpha,L,_+".alpha",o.commandStr),[L[c.rgb],L[c.alpha]];l.commandRaise("invalid blend.equation",o.commandStr)},function(c,p,d){var C=c.constants.blendEquations,E=p.def(),D=p.def(),B=c.cond("typeof ",d,'==="string"');return l.optional(function(){function Y(we,he,le){c.assert(we,le+" in "+C,"invalid "+he+", must be one of "+Object.keys(L))}Y(B.then,_,d),c.assert(B.else,d+"&&typeof "+d+'==="object"',"invalid "+_),Y(B.else,_+".rgb",d+".rgb"),Y(B.else,_+".alpha",d+".alpha")}),B.then(E,"=",D,"=",C,"[",d,"];"),B.else(E,"=",C,"[",d,".rgb];",D,"=",C,"[",d,".alpha];"),p(B),[E,D]});case Vr:return g(function(c){return l.command(Ke(c)&&c.length===4,"blend.color must be a 4d array",o.commandStr),At(4,function(p){return+c[p]})},function(c,p,d){return l.optional(function(){c.assert(p,c.shared.isArrayLike+"("+d+")&&"+d+".length===4","blend.color must be a 4d array")}),At(4,function(C){return p.def("+",d,"[",C,"]")})});case Ls:return g(function(c){return l.commandType(c,"number",b,o.commandStr),c|0},function(c,p,d){return l.optional(function(){c.assert(p,"typeof "+d+'==="number"',"invalid stencil.mask")}),p.def(d,"|0")});case Va:return g(function(c){l.commandType(c,"object",b,o.commandStr);var p=c.cmp||"keep",d=c.ref||0,C="mask"in c?c.mask:-1;return l.commandParameter(p,Mi,_+".cmp",o.commandStr),l.commandType(d,"number",_+".ref",o.commandStr),l.commandType(C,"number",_+".mask",o.commandStr),[Mi[p],d,C]},function(c,p,d){var C=c.constants.compareFuncs;l.optional(function(){function Y(){c.assert(p,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Y(d+"&&typeof ",d,'==="object"'),Y('!("cmp" in ',d,")||(",d,".cmp in ",C,")")});var E=p.def('"cmp" in ',d,"?",C,"[",d,".cmp]",":",_n),D=p.def(d,".ref|0"),B=p.def('"mask" in ',d,"?",d,".mask|0:-1");return[E,D,B]});case $n:case Kn:return g(function(c){l.commandType(c,"object",b,o.commandStr);var p=c.fail||"keep",d=c.zfail||"keep",C=c.zpass||"keep";return l.commandParameter(p,gn,_+".fail",o.commandStr),l.commandParameter(d,gn,_+".zfail",o.commandStr),l.commandParameter(C,gn,_+".zpass",o.commandStr),[_===Kn?Zn:ja,gn[p],gn[d],gn[C]]},function(c,p,d){var C=c.constants.stencilOps;l.optional(function(){c.assert(p,d+"&&typeof "+d+'==="object"',"invalid "+_)});function E(D){return l.optional(function(){c.assert(p,'!("'+D+'" in '+d+")||("+d+"."+D+" in "+C+")","invalid "+_+"."+D+", must be one of "+Object.keys(gn))}),p.def('"',D,'" in ',d,"?",C,"[",d,".",D,"]:",_n)}return[_===Kn?Zn:ja,E("fail"),E("zfail"),E("zpass")]});case Fi:return g(function(c){l.commandType(c,"object",b,o.commandStr);var p=c.factor|0,d=c.units|0;return l.commandType(p,"number",b+".factor",o.commandStr),l.commandType(d,"number",b+".units",o.commandStr),[p,d]},function(c,p,d){l.optional(function(){c.assert(p,d+"&&typeof "+d+'==="object"',"invalid "+_)});var C=p.def(d,".factor|0"),E=p.def(d,".units|0");return[C,E]});case pn:return g(function(c){var p=0;return c==="front"?p=ja:c==="back"&&(p=Zn),l.command(!!p,b,o.commandStr),p},function(c,p,d){return l.optional(function(){c.assert(p,d+'==="front"||'+d+'==="back"',"invalid cull.face")}),p.def(d,'==="front"?',ja,":",Zn)});case Da:return g(function(c){return l.command(typeof c=="number"&&c>=T.lineWidthDims[0]&&c<=T.lineWidthDims[1],"invalid line width, must be a positive number between "+T.lineWidthDims[0]+" and "+T.lineWidthDims[1],o.commandStr),c},function(c,p,d){return l.optional(function(){c.assert(p,"typeof "+d+'==="number"&&'+d+">="+T.lineWidthDims[0]+"&&"+d+"<="+T.lineWidthDims[1],"invalid line width")}),d});case Oi:return g(function(c){return l.commandParameter(c,Eu,b,o.commandStr),Eu[c]},function(c,p,d){return l.optional(function(){c.assert(p,d+'==="cw"||'+d+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),p.def(d+'==="cw"?'+Lu+":"+xu)});case Oa:return g(function(c){return l.command(Ke(c)&&c.length===4,"color.mask must be length 4 array",o.commandStr),c.map(function(p){return!!p})},function(c,p,d){return l.optional(function(){c.assert(p,c.shared.isArrayLike+"("+d+")&&"+d+".length===4","invalid color.mask")}),At(4,function(C){return"!!"+d+"["+C+"]"})});case Fa:return g(function(c){l.command(typeof c=="object"&&c,b,o.commandStr);var p="value"in c?c.value:1,d=!!c.invert;return l.command(typeof p=="number"&&p>=0&&p<=1,"sample.coverage.value must be a number between 0 and 1",o.commandStr),[p,d]},function(c,p,d){l.optional(function(){c.assert(p,d+"&&typeof "+d+'==="object"',"invalid sample.coverage")});var C=p.def('"value" in ',d,"?+",d,".value:1"),E=p.def("!!",d,".invert");return[C,E]})}}),x}function Fe(u,o){var v=u.static,w=u.dynamic,x={};return Object.keys(v).forEach(function(_){var b=v[_],g;if(typeof b=="number"||typeof b=="boolean")g=ot(function(){return b});else if(typeof b=="function"){var c=b._reglType;c==="texture2d"||c==="textureCube"?g=ot(function(p){return p.link(b)}):c==="framebuffer"||c==="framebufferCube"?(l.command(b.color.length>0,'missing color attachment for framebuffer sent to uniform "'+_+'"',o.commandStr),g=ot(function(p){return p.link(b.color[0])})):l.commandRaise('invalid data for uniform "'+_+'"',o.commandStr)}else Ke(b)?g=ot(function(p){var d=p.global.def("[",At(b.length,function(C){return l.command(typeof b[C]=="number"||typeof b[C]=="boolean","invalid uniform "+_,p.commandStr),b[C]}),"]");return d}):l.commandRaise('invalid or missing data for uniform "'+_+'"',o.commandStr);g.value=b,x[_]=g}),Object.keys(w).forEach(function(_){var b=w[_];x[_]=Ot(b,function(g,c){return g.invoke(c,b)})}),x}function lt(u,o){var v=u.static,w=u.dynamic,x={};return Object.keys(v).forEach(function(_){var b=v[_],g=s.id(_),c=new y;if(js(b))c.state=fn,c.buffer=V.getBuffer(V.create(b,bn,!1,!0)),c.type=0;else{var p=V.getBuffer(b);if(p)c.state=fn,c.buffer=p,c.type=0;else if(l.command(typeof b=="object"&&b,"invalid data for attribute "+_,o.commandStr),"constant"in b){var d=b.constant;c.buffer="null",c.state=Pi,typeof d=="number"?c.x=d:(l.command(Ke(d)&&d.length>0&&d.length<=4,"invalid constant for attribute "+_,o.commandStr),dn.forEach(function(he,le){le<d.length&&(c[he]=d[le])}))}else{js(b.buffer)?p=V.getBuffer(V.create(b.buffer,bn,!1,!0)):p=V.getBuffer(b.buffer),l.command(!!p,'missing buffer for attribute "'+_+'"',o.commandStr);var C=b.offset|0;l.command(C>=0,'invalid offset for attribute "'+_+'"',o.commandStr);var E=b.stride|0;l.command(E>=0&&E<256,'invalid stride for attribute "'+_+'", must be integer betweeen [0, 255]',o.commandStr);var D=b.size|0;l.command(!("size"in b)||D>0&&D<=4,'invalid size for attribute "'+_+'", must be 1,2,3,4',o.commandStr);var B=!!b.normalized,Y=0;"type"in b&&(l.commandParameter(b.type,Pr,"invalid type for attribute "+_,o.commandStr),Y=Pr[b.type]);var we=b.divisor|0;l.optional(function(){"divisor"in b&&(l.command(we===0||$,'cannot specify divisor for attribute "'+_+'", instancing not supported',o.commandStr),l.command(we>=0,'invalid divisor for attribute "'+_+'"',o.commandStr));var he=o.commandStr,le=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(b).forEach(function(M){l.command(le.indexOf(M)>=0,'unknown parameter "'+M+'" for attribute pointer "'+_+'" (valid parameters are '+le+")",he)})}),c.buffer=p,c.state=fn,c.size=D,c.normalized=B,c.type=Y||p.dtype,c.offset=C,c.stride=E,c.divisor=we}}x[_]=ot(function(he,le){var M=he.attribCache;if(g in M)return M[g];var O={isStream:!1};return Object.keys(c).forEach(function(fe){O[fe]=c[fe]}),c.buffer&&(O.buffer=he.link(c.buffer),O.type=O.type||O.buffer+".dtype"),M[g]=O,O})}),Object.keys(w).forEach(function(_){var b=w[_];function g(c,p){var d=c.invoke(p,b),C=c.shared,E=c.constants,D=C.isBufferArgs,B=C.buffer;l.optional(function(){c.assert(p,d+"&&(typeof "+d+'==="object"||typeof '+d+'==="function")&&('+D+"("+d+")||"+B+".getBuffer("+d+")||"+B+".getBuffer("+d+".buffer)||"+D+"("+d+'.buffer)||("constant" in '+d+"&&(typeof "+d+'.constant==="number"||'+C.isArrayLike+"("+d+".constant))))",'invalid dynamic attribute "'+_+'"')});var Y={isStream:p.def(!1)},we=new y;we.state=fn,Object.keys(we).forEach(function(O){Y[O]=p.def(""+we[O])});var he=Y.buffer,le=Y.type;p("if(",D,"(",d,")){",Y.isStream,"=true;",he,"=",B,".createStream(",bn,",",d,");",le,"=",he,".dtype;","}else{",he,"=",B,".getBuffer(",d,");","if(",he,"){",le,"=",he,".dtype;",'}else if("constant" in ',d,"){",Y.state,"=",Pi,";","if(typeof "+d+'.constant === "number"){',Y[dn[0]],"=",d,".constant;",dn.slice(1).map(function(O){return Y[O]}).join("="),"=0;","}else{",dn.map(function(O,fe){return Y[O]+"="+d+".constant.length>"+fe+"?"+d+".constant["+fe+"]:0;"}).join(""),"}}else{","if(",D,"(",d,".buffer)){",he,"=",B,".createStream(",bn,",",d,".buffer);","}else{",he,"=",B,".getBuffer(",d,".buffer);","}",le,'="type" in ',d,"?",E.glTypes,"[",d,".type]:",he,".dtype;",Y.normalized,"=!!",d,".normalized;");function M(O){p(Y[O],"=",d,".",O,"|0;")}return M("size"),M("offset"),M("stride"),M("divisor"),p("}}"),p.exit("if(",Y.isStream,"){",B,".destroyStream(",he,");","}"),Y}x[_]=Ot(b,g)}),x}function We(u){var o=u.static,v=u.dynamic,w={};return Object.keys(o).forEach(function(x){var _=o[x];w[x]=ot(function(b,g){return typeof _=="number"||typeof _=="boolean"?""+_:b.link(_)})}),Object.keys(v).forEach(function(x){var _=v[x];w[x]=Ot(_,function(b,g){return b.invoke(g,_)})}),w}function st(u,o,v,w,x){var _=u.static,b=u.dynamic;l.optional(function(){var M=[Nr,Wn,Yn,Br,Mr,Ni,Ir,Qn,qn,hn].concat(ve);function O(fe){Object.keys(fe).forEach(function(de){l.command(M.indexOf(de)>=0,'unknown parameter "'+de+'"',x.commandStr)})}O(_),O(b)});var g=Ce(u,o),c=oe(u),p=_e(u,c,x),d=et(u,x),C=tt(u,x),E=Re(u,x,g);function D(M){var O=p[M];O&&(C[M]=O)}D(tr),D(ce(Xn));var B=Object.keys(C).length>0,Y={framebuffer:c,draw:d,shader:E,state:C,dirty:B,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Y.profile=ie(u),Y.uniforms=Fe(v,x),Y.drawVAO=Y.scopeVAO=d.vao,!Y.drawVAO&&E.program&&!g&&h.angle_instanced_arrays&&d.static.elements){var we=!0,he=E.program.attributes.map(function(M){var O=o.static[M];return we=we&&!!O,O});if(we&&he.length>0){var le=X.getVAO(X.createVAO({attributes:he,elements:d.static.elements}));Y.drawVAO=new pt(null,null,null,function(M,O){return M.link(le)}),Y.useVAO=!0}}return g?Y.useVAO=!0:Y.attributes=lt(o,x),Y.context=We(w),Y}function ut(u,o,v){var w=u.shared,x=w.context,_=u.scope();Object.keys(v).forEach(function(b){o.save(x,"."+b);var g=v[b],c=g.append(u,o);Array.isArray(c)?_(x,".",b,"=[",c.join(),"];"):_(x,".",b,"=",c,";")}),o(_)}function ct(u,o,v,w){var x=u.shared,_=x.gl,b=x.framebuffer,g;se&&(g=o.def(x.extensions,".webgl_draw_buffers"));var c=u.constants,p=c.drawBuffer,d=c.backBuffer,C;v?C=v.append(u,o):C=o.def(b,".next"),w||o("if(",C,"!==",b,".cur){"),o("if(",C,"){",_,".bindFramebuffer(",Fu,",",C,".framebuffer);"),se&&o(g,".drawBuffersWEBGL(",p,"[",C,".colorAttachments.length]);"),o("}else{",_,".bindFramebuffer(",Fu,",null);"),se&&o(g,".drawBuffersWEBGL(",d,");"),o("}",b,".cur=",C,";"),w||o("}")}function vt(u,o,v){var w=u.shared,x=w.gl,_=u.current,b=u.next,g=w.current,c=w.next,p=u.cond(g,".dirty");ve.forEach(function(d){var C=ce(d);if(!(C in v.state)){var E,D;if(C in b){E=b[C],D=_[C];var B=At(ae[C].length,function(we){return p.def(E,"[",we,"]")});p(u.cond(B.map(function(we,he){return we+"!=="+D+"["+he+"]"}).join("||")).then(x,".",F[C],"(",B,");",B.map(function(we,he){return D+"["+he+"]="+we}).join(";"),";"))}else{E=p.def(c,".",C);var Y=u.cond(E,"!==",g,".",C);p(Y),C in N?Y(u.cond(E).then(x,".enable(",N[C],");").else(x,".disable(",N[C],");"),g,".",C,"=",E,";"):Y(x,".",F[C],"(",E,");",g,".",C,"=",E,";")}}}),Object.keys(v.state).length===0&&p(g,".dirty=false;"),o(p)}function gt(u,o,v,w){var x=u.shared,_=u.current,b=x.current,g=x.gl;Bu(Object.keys(v)).forEach(function(c){var p=v[c];if(!(w&&!w(p))){var d=p.append(u,o);if(N[c]){var C=N[c];wn(p)?d?o(g,".enable(",C,");"):o(g,".disable(",C,");"):o(u.cond(d).then(g,".enable(",C,");").else(g,".disable(",C,");")),o(b,".",c,"=",d,";")}else if(Ke(d)){var E=_[c];o(g,".",F[c],"(",d,");",d.map(function(D,B){return E+"["+B+"]="+D}).join(";"),";")}else o(g,".",F[c],"(",d,");",b,".",c,"=",d,";")}})}function it(u,o){$&&(u.instancing=o.def(u.shared.extensions,".angle_instanced_arrays"))}function Pe(u,o,v,w,x){var _=u.shared,b=u.stats,g=_.current,c=_.timer,p=v.profile;function d(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var C,E;function D(M){C=o.def(),M(C,"=",d(),";"),typeof x=="string"?M(b,".count+=",x,";"):M(b,".count++;"),z&&(w?(E=o.def(),M(E,"=",c,".getNumPendingQueries();")):M(c,".beginQuery(",b,");"))}function B(M){M(b,".cpuTime+=",d(),"-",C,";"),z&&(w?M(c,".pushScopeStats(",E,",",c,".getNumPendingQueries(),",b,");"):M(c,".endQuery();"))}function Y(M){var O=o.def(g,".profile");o(g,".profile=",M,";"),o.exit(g,".profile=",O,";")}var we;if(p){if(wn(p)){p.enable?(D(o),B(o.exit),Y("true")):Y("false");return}we=p.append(u,o),Y(we)}else we=o.def(g,".profile");var he=u.block();D(he),o("if(",we,"){",he,"}");var le=u.block();B(le),o.exit("if(",we,"){",le,"}")}function wt(u,o,v,w,x){var _=u.shared;function b(c){switch(c){case _r:case Bs:case Gs:return 2;case nr:case Ms:case Us:return 3;case Ns:case Is:case zs:return 4;default:return 1}}function g(c,p,d){var C=_.gl,E=o.def(c,".location"),D=o.def(_.attributes,"[",E,"]"),B=d.state,Y=d.buffer,we=[d.x,d.y,d.z,d.w],he=["buffer","normalized","offset","stride"];function le(){o("if(!",D,".buffer){",C,".enableVertexAttribArray(",E,");}");var O=d.type,fe;if(d.size?fe=o.def(d.size,"||",p):fe=p,o("if(",D,".type!==",O,"||",D,".size!==",fe,"||",he.map(function(ge){return D+"."+ge+"!=="+d[ge]}).join("||"),"){",C,".bindBuffer(",bn,",",Y,".buffer);",C,".vertexAttribPointer(",[E,fe,O,d.normalized,d.stride,d.offset],");",D,".type=",O,";",D,".size=",fe,";",he.map(function(ge){return D+"."+ge+"="+d[ge]+";"}).join(""),"}"),$){var de=d.divisor;o("if(",D,".divisor!==",de,"){",u.instancing,".vertexAttribDivisorANGLE(",[E,de],");",D,".divisor=",de,";}")}}function M(){o("if(",D,".buffer){",C,".disableVertexAttribArray(",E,");",D,".buffer=null;","}if(",dn.map(function(O,fe){return D+"."+O+"!=="+we[fe]}).join("||"),"){",C,".vertexAttrib4f(",E,",",we,");",dn.map(function(O,fe){return D+"."+O+"="+we[fe]+";"}).join(""),"}")}B===fn?le():B===Pi?M():(o("if(",B,"===",fn,"){"),le(),o("}else{"),M(),o("}"))}w.forEach(function(c){var p=c.name,d=v.attributes[p],C;if(d){if(!x(d))return;C=d.append(u,o)}else{if(!x(Mu))return;var E=u.scopeAttrib(p);l.optional(function(){u.assert(o,E+".state","missing attribute "+p)}),C={},Object.keys(new y).forEach(function(D){C[D]=o.def(E,".",D)})}g(u.link(c),b(c.info.type),C)})}function Ue(u,o,v,w,x,_){for(var b=u.shared,g=b.gl,c={},p,d=0;d<w.length;++d){var C=w[d],E=C.name,D=C.info.type,B=C.info.size,Y=v.uniforms[E];if(B>1){if(!Y)continue;var we=E.replace("[0]","");if(c[we])continue;c[we]=1}var he=u.link(C),le=he+".location",M;if(Y){if(!x(Y))continue;if(wn(Y)){var O=Y.value;if(l.command(O!==null&&typeof O!="undefined",'missing uniform "'+E+'"',u.commandStr),D===Ua||D===za){l.command(typeof O=="function"&&(D===Ua&&(O._reglType==="texture2d"||O._reglType==="framebuffer")||D===za&&(O._reglType==="textureCube"||O._reglType==="framebufferCube")),"invalid texture for uniform "+E,u.commandStr);var fe=u.link(O._texture||O.color[0]._texture);o(g,".uniform1i(",le,",",fe+".bind());"),o.exit(fe,".unbind();")}else if(D===Ma||D===Ia||D===Ga){l.optional(function(){l.command(Ke(O),"invalid matrix for uniform "+E,u.commandStr),l.command(D===Ma&&O.length===4||D===Ia&&O.length===9||D===Ga&&O.length===16,"invalid length for matrix uniform "+E,u.commandStr)});var de=u.global.def("new Float32Array(["+Array.prototype.slice.call(O)+"])"),ge=2;D===Ia?ge=3:D===Ga&&(ge=4),o(g,".uniformMatrix",ge,"fv(",le,",false,",de,");")}else{switch(D){case Gr:B===1?l.commandType(O,"number","uniform "+E,u.commandStr):l.command(Ke(O)&&O.length===B,"uniform "+E,u.commandStr),p="1f";break;case _r:l.command(Ke(O)&&O.length&&O.length%2===0&&O.length<=B*2,"uniform "+E,u.commandStr),p="2f";break;case nr:l.command(Ke(O)&&O.length&&O.length%3===0&&O.length<=B*3,"uniform "+E,u.commandStr),p="3f";break;case Ns:l.command(Ke(O)&&O.length&&O.length%4===0&&O.length<=B*4,"uniform "+E,u.commandStr),p="4f";break;case wu:B===1?l.commandType(O,"boolean","uniform "+E,u.commandStr):l.command(Ke(O)&&O.length===B,"uniform "+E,u.commandStr),p="1i";break;case gu:B===1?l.commandType(O,"number","uniform "+E,u.commandStr):l.command(Ke(O)&&O.length===B,"uniform "+E,u.commandStr),p="1i";break;case Gs:l.command(Ke(O)&&O.length&&O.length%2===0&&O.length<=B*2,"uniform "+E,u.commandStr),p="2i";break;case Bs:l.command(Ke(O)&&O.length&&O.length%2===0&&O.length<=B*2,"uniform "+E,u.commandStr),p="2i";break;case Us:l.command(Ke(O)&&O.length&&O.length%3===0&&O.length<=B*3,"uniform "+E,u.commandStr),p="3i";break;case Ms:l.command(Ke(O)&&O.length&&O.length%3===0&&O.length<=B*3,"uniform "+E,u.commandStr),p="3i";break;case zs:l.command(Ke(O)&&O.length&&O.length%4===0&&O.length<=B*4,"uniform "+E,u.commandStr),p="4i";break;case Is:l.command(Ke(O)&&O.length&&O.length%4===0&&O.length<=B*4,"uniform "+E,u.commandStr),p="4i";break}B>1?(p+="v",O=u.global.def("["+Array.prototype.slice.call(O)+"]")):O=Ke(O)?Array.prototype.slice.call(O):O,o(g,".uniform",p,"(",le,",",O,");")}continue}else M=Y.append(u,o)}else{if(!x(Mu))continue;M=o.def(b.uniforms,"[",s.id(E),"]")}D===Ua?(l(!Array.isArray(M),"must specify a scalar prop for textures"),o("if(",M,"&&",M,'._reglType==="framebuffer"){',M,"=",M,".color[0];","}")):D===za&&(l(!Array.isArray(M),"must specify a scalar prop for cube maps"),o("if(",M,"&&",M,'._reglType==="framebufferCube"){',M,"=",M,".color[0];","}")),l.optional(function(){function Nt(Dt,Hs){u.assert(o,Dt,'bad data or missing for uniform "'+E+'".  '+Hs)}function ri(Dt,Hs){Hs===1&&l(!Array.isArray(M),"must not specify an array type for uniform"),Nt("Array.isArray("+M+") && typeof "+M+'[0]===" '+Dt+'" || typeof '+M+'==="'+Dt+'"',"invalid type, expected "+Dt)}function Xt(Dt,Hs,$s){Array.isArray(M)?l(M.length&&M.length%Dt===0&&M.length<=Dt*$s,"must have length of "+($s===1?"":"n * ")+Dt):Nt(b.isArrayLike+"("+M+")&&"+M+".length && "+M+".length % "+Dt+" === 0 && "+M+".length<="+Dt*$s,"invalid vector, should have length of "+($s===1?"":"n * ")+Dt,u.commandStr)}function $u(Dt){l(!Array.isArray(M),"must not specify a value type"),Nt("typeof "+M+'==="function"&&'+M+'._reglType==="texture'+(Dt===t?"2d":"Cube")+'"',"invalid texture type",u.commandStr)}switch(D){case gu:ri("number",B);break;case Bs:Xt(2,"number",B);break;case Ms:Xt(3,"number",B);break;case Is:Xt(4,"number",B);break;case Gr:ri("number",B);break;case _r:Xt(2,"number",B);break;case nr:Xt(3,"number",B);break;case Ns:Xt(4,"number",B);break;case wu:ri("boolean",B);break;case Gs:Xt(2,"boolean",B);break;case Us:Xt(3,"boolean",B);break;case zs:Xt(4,"boolean",B);break;case Ma:Xt(4,"number",B);break;case Ia:Xt(9,"number",B);break;case Ga:Xt(16,"number",B);break;case Ua:$u(t);break;case za:$u(n);break}});var ze=1;switch(D){case Ua:case za:var yt=o.def(M,"._texture");o(g,".uniform1i(",le,",",yt,".bind());"),o.exit(yt,".unbind();");continue;case gu:case wu:p="1i";break;case Bs:case Gs:p="2i",ze=2;break;case Ms:case Us:p="3i",ze=3;break;case Is:case zs:p="4i",ze=4;break;case Gr:p="1f";break;case _r:p="2f",ze=2;break;case nr:p="3f",ze=3;break;case Ns:p="4f",ze=4;break;case Ma:p="Matrix2fv";break;case Ia:p="Matrix3fv";break;case Ga:p="Matrix4fv";break}if(p.indexOf("Matrix")===-1&&B>1&&(p+="v",ze=1),p.charAt(0)==="M"){o(g,".uniform",p,"(",le,",");var ei=Math.pow(D-Ma+2,2),Ur=u.global.def("new Float32Array(",ei,")");Array.isArray(M)?o("false,(",At(ei,function(Nt){return Ur+"["+Nt+"]="+M[Nt]}),",",Ur,")"):o("false,(Array.isArray(",M,")||",M," instanceof Float32Array)?",M,":(",At(ei,function(Nt){return Ur+"["+Nt+"]="+M+"["+Nt+"]"}),",",Ur,")"),o(");")}else if(ze>1){for(var yr=[],yn=[],ti=0;ti<ze;++ti)Array.isArray(M)?yn.push(M[ti]):yn.push(o.def(M+"["+ti+"]")),_&&yr.push(o.def());_&&o("if(!",u.batchId,"||",yr.map(function(Nt,ri){return Nt+"!=="+yn[ri]}).join("||"),"){",yr.map(function(Nt,ri){return Nt+"="+yn[ri]+";"}).join("")),o(g,".uniform",p,"(",le,",",yn.join(","),");"),_&&o("}")}else{if(l(!Array.isArray(M),"uniform value must not be an array"),_){var Hu=o.def();o("if(!",u.batchId,"||",Hu,"!==",M,"){",Hu,"=",M,";")}o(g,".uniform",p,"(",le,",",M,");"),_&&o("}")}}}function be(u,o,v,w){var x=u.shared,_=x.gl,b=x.draw,g=w.draw;function c(){var fe=g.elements,de,ge=o;return fe?((fe.contextDep&&w.contextDynamic||fe.propDep)&&(ge=v),de=fe.append(u,ge),g.elementsActive&&ge("if("+de+")"+_+".bindBuffer("+Ba+","+de+".buffer.buffer);")):(de=ge.def(),ge(de,"=",b,".",Br,";","if(",de,"){",_,".bindBuffer(",Ba,",",de,".buffer.buffer);}","else if(",x.vao,".currentVAO){",de,"=",u.shared.elements+".getElements("+x.vao,".currentVAO.elements);",I?"":"if("+de+")"+_+".bindBuffer("+Ba+","+de+".buffer.buffer);","}")),de}function p(){var fe=g.count,de,ge=o;return fe?((fe.contextDep&&w.contextDynamic||fe.propDep)&&(ge=v),de=fe.append(u,ge),l.optional(function(){fe.MISSING&&u.assert(o,"false","missing vertex count"),fe.DYNAMIC&&u.assert(ge,de+">=0","missing vertex count")})):(de=ge.def(b,".",Ir),l.optional(function(){u.assert(ge,de+">=0","missing vertex count")})),de}var d=c();function C(fe){var de=g[fe];return de?de.contextDep&&w.contextDynamic||de.propDep?de.append(u,v):de.append(u,o):o.def(b,".",fe)}var E=C(Mr),D=C(Ni),B=p();if(typeof B=="number"){if(B===0)return}else v("if(",B,"){"),v.exit("}");var Y,we;$&&(Y=C(Qn),we=u.instancing);var he=d+".type",le=g.elements&&wn(g.elements)&&!g.vaoActive;function M(){function fe(){v(we,".drawElementsInstancedANGLE(",[E,B,he,D+"<<(("+he+"-"+Ta+")>>1)",Y],");")}function de(){v(we,".drawArraysInstancedANGLE(",[E,D,B,Y],");")}d&&d!=="null"?le?fe():(v("if(",d,"){"),fe(),v("}else{"),de(),v("}")):de()}function O(){function fe(){v(_+".drawElements("+[E,B,he,D+"<<(("+he+"-"+Ta+")>>1)"]+");")}function de(){v(_+".drawArrays("+[E,D,B]+");")}d&&d!=="null"?le?fe():(v("if(",d,"){"),fe(),v("}else{"),de(),v("}")):de()}$&&(typeof Y!="number"||Y>=0)?typeof Y=="string"?(v("if(",Y,">0){"),M(),v("}else if(",Y,"<0){"),O(),v("}")):M():O()}function Oe(u,o,v,w,x){var _=ye(),b=_.proc("body",x);return l.optional(function(){_.commandStr=o.commandStr,_.command=_.link(o.commandStr)}),$&&(_.instancing=b.def(_.shared.extensions,".angle_instanced_arrays")),u(_,b,v,w),_.compile().body}function Be(u,o,v,w){it(u,o),v.useVAO?v.drawVAO?o(u.shared.vao,".setVAO(",v.drawVAO.append(u,o),");"):o(u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"):(o(u.shared.vao,".setVAO(null);"),wt(u,o,v,w.attributes,function(){return!0})),Ue(u,o,v,w.uniforms,function(){return!0},!1),be(u,o,o,v)}function at(u,o){var v=u.proc("draw",1);it(u,v),ut(u,v,o.context),ct(u,v,o.framebuffer),vt(u,v,o),gt(u,v,o.state),Pe(u,v,o,!1,!0);var w=o.shader.progVar.append(u,v);if(v(u.shared.gl,".useProgram(",w,".program);"),o.shader.program)Be(u,v,o,o.shader.program);else{v(u.shared.vao,".setVAO(null);");var x=u.global.def("{}"),_=v.def(w,".id"),b=v.def(x,"[",_,"]");v(u.cond(b).then(b,".call(this,a0);").else(b,"=",x,"[",_,"]=",u.link(function(g){return Oe(Be,u,o,g,1)}),"(",w,");",b,".call(this,a0);"))}Object.keys(o.state).length>0&&v(u.shared.current,".dirty=true;"),u.shared.vao&&v(u.shared.vao,".setVAO(null);")}function wr(u,o,v,w){u.batchId="a1",it(u,o);function x(){return!0}wt(u,o,v,w.attributes,x),Ue(u,o,v,w.uniforms,x,!1),be(u,o,o,v)}function Jn(u,o,v,w){it(u,o);var x=v.contextDep,_=o.def(),b="a0",g="a1",c=o.def();u.shared.props=c,u.batchId=_;var p=u.scope(),d=u.scope();o(p.entry,"for(",_,"=0;",_,"<",g,";++",_,"){",c,"=",b,"[",_,"];",d,"}",p.exit);function C(he){return he.contextDep&&x||he.propDep}function E(he){return!C(he)}if(v.needsContext&&ut(u,d,v.context),v.needsFramebuffer&&ct(u,d,v.framebuffer),gt(u,d,v.state,C),v.profile&&C(v.profile)&&Pe(u,d,v,!1,!0),w)v.useVAO?v.drawVAO?C(v.drawVAO)?d(u.shared.vao,".setVAO(",v.drawVAO.append(u,d),");"):p(u.shared.vao,".setVAO(",v.drawVAO.append(u,p),");"):p(u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"):(p(u.shared.vao,".setVAO(null);"),wt(u,p,v,w.attributes,E),wt(u,d,v,w.attributes,C)),Ue(u,p,v,w.uniforms,E,!1),Ue(u,d,v,w.uniforms,C,!0),be(u,p,d,v);else{var D=u.global.def("{}"),B=v.shader.progVar.append(u,d),Y=d.def(B,".id"),we=d.def(D,"[",Y,"]");d(u.shared.gl,".useProgram(",B,".program);","if(!",we,"){",we,"=",D,"[",Y,"]=",u.link(function(he){return Oe(wr,u,v,he,2)}),"(",B,");}",we,".call(this,a0[",_,"],",_,");")}}function f(u,o){var v=u.proc("batch",2);u.batchId="0",it(u,v);var w=!1,x=!0;Object.keys(o.context).forEach(function(D){w=w||o.context[D].propDep}),w||(ut(u,v,o.context),x=!1);var _=o.framebuffer,b=!1;_?(_.propDep?w=b=!0:_.contextDep&&w&&(b=!0),b||ct(u,v,_)):ct(u,v,null),o.state.viewport&&o.state.viewport.propDep&&(w=!0);function g(D){return D.contextDep&&w||D.propDep}vt(u,v,o),gt(u,v,o.state,function(D){return!g(D)}),(!o.profile||!g(o.profile))&&Pe(u,v,o,!1,"a1"),o.contextDep=w,o.needsContext=x,o.needsFramebuffer=b;var c=o.shader.progVar;if(c.contextDep&&w||c.propDep)Jn(u,v,o,null);else{var p=c.append(u,v);if(v(u.shared.gl,".useProgram(",p,".program);"),o.shader.program)Jn(u,v,o,o.shader.program);else{v(u.shared.vao,".setVAO(null);");var d=u.global.def("{}"),C=v.def(p,".id"),E=v.def(d,"[",C,"]");v(u.cond(E).then(E,".call(this,a0,a1);").else(E,"=",d,"[",C,"]=",u.link(function(D){return Oe(Jn,u,o,D,2)}),"(",p,");",E,".call(this,a0,a1);"))}}Object.keys(o.state).length>0&&v(u.shared.current,".dirty=true;"),u.shared.vao&&v(u.shared.vao,".setVAO(null);")}function k(u,o){var v=u.proc("scope",3);u.batchId="a2";var w=u.shared,x=w.current;ut(u,v,o.context),o.framebuffer&&o.framebuffer.append(u,v),Bu(Object.keys(o.state)).forEach(function(b){var g=o.state[b],c=g.append(u,v);Ke(c)?c.forEach(function(p,d){v.set(u.next[b],"["+d+"]",p)}):v.set(w.next,"."+b,c)}),Pe(u,v,o,!0,!0),[Br,Ni,Ir,Qn,Mr].forEach(function(b){var g=o.draw[b];!g||v.set(w.draw,"."+b,""+g.append(u,v))}),Object.keys(o.uniforms).forEach(function(b){var g=o.uniforms[b].append(u,v);Array.isArray(g)&&(g="["+g.join()+"]"),v.set(w.uniforms,"["+s.id(b)+"]",g)}),Object.keys(o.attributes).forEach(function(b){var g=o.attributes[b].append(u,v),c=u.scopeAttrib(b);Object.keys(new y).forEach(function(p){v.set(c,"."+p,g[p])})}),o.scopeVAO&&v.set(w.vao,".targetVAO",o.scopeVAO.append(u,v));function _(b){var g=o.shader[b];g&&v.set(w.shader,"."+b,g.append(u,v))}_(Wn),_(Yn),Object.keys(o.state).length>0&&(v(x,".dirty=true;"),v.exit(x,".dirty=true;")),v("a1(",u.shared.context,",a0,",u.batchId,");")}function A(u){if(!(typeof u!="object"||Ke(u))){for(var o=Object.keys(u),v=0;v<o.length;++v)if(Ct.isDynamic(u[o[v]]))return!0;return!1}}function ue(u,o,v){var w=o.static[v];if(!w||!A(w))return;var x=u.global,_=Object.keys(w),b=!1,g=!1,c=!1,p=u.global.def("{}");_.forEach(function(C){var E=w[C];if(Ct.isDynamic(E)){typeof E=="function"&&(E=w[C]=Ct.unbox(E));var D=Ot(E,null);b=b||D.thisDep,c=c||D.propDep,g=g||D.contextDep}else{switch(x(p,".",C,"="),typeof E){case"number":x(E);break;case"string":x('"',E,'"');break;case"object":Array.isArray(E)&&x("[",E.join(),"]");break;default:x(u.link(E));break}x(";")}});function d(C,E){_.forEach(function(D){var B=w[D];if(!!Ct.isDynamic(B)){var Y=C.invoke(E,B);E(p,".",D,"=",Y,";")}})}o.dynamic[v]=new Ct.DynamicVariable(ki,{thisDep:b,contextDep:g,propDep:c,ref:p,append:d}),delete o.static[v]}function Le(u,o,v,w,x){var _=ye();_.stats=_.link(x),Object.keys(o.static).forEach(function(g){ue(_,o,g)}),Vs.forEach(function(g){ue(_,u,g)});var b=st(u,o,v,w,_);return at(_,b),k(_,b),f(_,b),pe(_.compile(),{destroy:function(){b.shader.program.destroy()}})}return{next:ne,current:ae,procs:function(){var u=ye(),o=u.proc("poll"),v=u.proc("refresh"),w=u.block();o(w),v(w);var x=u.shared,_=x.gl,b=x.next,g=x.current;w(g,".dirty=false;"),ct(u,o),ct(u,v,null,!0);var c;$&&(c=u.link($)),h.oes_vertex_array_object&&v(u.link(h.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<T.maxAttributes;++p){var d=v.def(x.attributes,"[",p,"]"),C=u.cond(d,".buffer");C.then(_,".enableVertexAttribArray(",p,");",_,".bindBuffer(",bn,",",d,".buffer.buffer);",_,".vertexAttribPointer(",p,",",d,".size,",d,".type,",d,".normalized,",d,".stride,",d,".offset);").else(_,".disableVertexAttribArray(",p,");",_,".vertexAttrib4f(",p,",",d,".x,",d,".y,",d,".z,",d,".w);",d,".buffer=null;"),v(C),$&&v(c,".vertexAttribDivisorANGLE(",p,",",d,".divisor);")}return v(u.shared.vao,".currentVAO=null;",u.shared.vao,".setVAO(",u.shared.vao,".targetVAO);"),Object.keys(N).forEach(function(E){var D=N[E],B=w.def(b,".",E),Y=u.block();Y("if(",B,"){",_,".enable(",D,")}else{",_,".disable(",D,")}",g,".",E,"=",B,";"),v(Y),o("if(",B,"!==",g,".",E,"){",Y,"}")}),Object.keys(F).forEach(function(E){var D=F[E],B=ae[E],Y,we,he=u.block();if(he(_,".",D,"("),Ke(B)){var le=B.length;Y=u.global.def(b,".",E),we=u.global.def(g,".",E),he(At(le,function(M){return Y+"["+M+"]"}),");",At(le,function(M){return we+"["+M+"]="+Y+"["+M+"];"}).join("")),o("if(",At(le,function(M){return Y+"["+M+"]!=="+we+"["+M+"]"}).join("||"),"){",he,"}")}else Y=w.def(b,".",E),we=w.def(g,".",E),he(Y,");",g,".",E,"=",Y,";"),o("if(",Y,"!==",we,"){",he,"}");v(he)}),u.compile()}(),compile:Le}}function ic(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var ac=34918,oc=34919,Iu=35007,sc=function(i,s){if(!s.ext_disjoint_timer_query)return null;var h=[];function T(){return h.pop()||s.ext_disjoint_timer_query.createQueryEXT()}function V($){h.push($)}var S=[];function R($){var se=T();s.ext_disjoint_timer_query.beginQueryEXT(Iu,se),S.push(se),z(S.length-1,S.length,$)}function U(){s.ext_disjoint_timer_query.endQueryEXT(Iu)}function G(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var X=[];function W(){return X.pop()||new G}function q($){X.push($)}var Q=[];function z($,se,I){var ae=W();ae.startQueryIndex=$,ae.endQueryIndex=se,ae.sum=0,ae.stats=I,Q.push(ae)}var K=[],y=[];function L(){var $,se,I=S.length;if(I!==0){y.length=Math.max(y.length,I+1),K.length=Math.max(K.length,I+1),K[0]=0,y[0]=0;var ae=0;for($=0,se=0;se<S.length;++se){var ne=S[se];s.ext_disjoint_timer_query.getQueryObjectEXT(ne,oc)?(ae+=s.ext_disjoint_timer_query.getQueryObjectEXT(ne,ac),V(ne)):S[$++]=ne,K[se+1]=ae,y[se+1]=$}for(S.length=$,$=0,se=0;se<Q.length;++se){var ve=Q[se],N=ve.startQueryIndex,F=ve.endQueryIndex;ve.sum+=K[F]-K[N];var ce=y[N],J=y[F];J===ce?(ve.stats.gpuTime+=ve.sum/1e6,q(ve)):(ve.startQueryIndex=ce,ve.endQueryIndex=J,Q[$++]=ve)}Q.length=$}}return{beginQuery:R,endQuery:U,pushScopeStats:z,update:L,getNumPendingQueries:function(){return S.length},clear:function(){h.push.apply(h,S);for(var $=0;$<h.length;$++)s.ext_disjoint_timer_query.deleteQueryEXT(h[$]);S.length=0,h.length=0},restore:function(){S.length=0,h.length=0}}},lc=16384,uc=256,cc=1024,dc=34962,Gu="webglcontextlost",Uu="webglcontextrestored",zu=1,fc=2,pc=3;function ju(i,s){for(var h=0;h<i.length;++h)if(i[h]===s)return h;return-1}function hc(i){var s=sl(i);if(!s)return null;var h=s.gl,T=h.getContextAttributes(),V=h.isContextLost(),S=An(h,s);if(!S)return null;var R=al(),U=ic(),G=S.extensions,X=sc(h,G),W=io(),q=h.drawingBufferWidth,Q=h.drawingBufferHeight,z={tick:0,time:0,viewportWidth:q,viewportHeight:Q,framebufferWidth:q,framebufferHeight:Q,drawingBufferWidth:q,drawingBufferHeight:Q,pixelRatio:s.pixelRatio},K={},y={elements:null,primitive:4,count:-1,offset:0,instances:-1},L=wo(h,G),$=Dl(h,U,s,ae),se=St(h,G,$,U),I=hu(h,G,L,U,$,se,y);function ae(be){return I.destroyBuffer(be)}var ne=vu(h,R,U,s),ve=Yl(h,G,L,function(){ce.procs.poll()},z,U,s),N=Ql(h,G,L,U,s),F=pu(h,G,L,ve,N,U),ce=nc(h,R,G,L,$,se,ve,F,K,I,ne,y,z,X,s),J=mu(h,F,ce.procs.poll,z,T,G,L),j=ce.next,ee=h.canvas,re=[],Ee=[],ye=[],ie=[s.onDestroy],oe=null;function _e(){if(re.length===0){X&&X.update(),oe=null;return}oe=$i.next(_e),gt();for(var be=re.length-1;be>=0;--be){var Oe=re[be];Oe&&Oe(z,null,0)}h.flush(),X&&X.update()}function Ce(){!oe&&re.length>0&&(oe=$i.next(_e))}function Re(){oe&&($i.cancel(_e),oe=null)}function et(be){be.preventDefault(),V=!0,Re(),Ee.forEach(function(Oe){Oe()})}function tt(be){h.getError(),V=!1,S.restore(),ne.restore(),$.restore(),ve.restore(),N.restore(),F.restore(),I.restore(),X&&X.restore(),ce.procs.refresh(),Ce(),ye.forEach(function(Oe){Oe()})}ee&&(ee.addEventListener(Gu,et,!1),ee.addEventListener(Uu,tt,!1));function Fe(){re.length=0,Re(),ee&&(ee.removeEventListener(Gu,et),ee.removeEventListener(Uu,tt)),ne.clear(),F.clear(),N.clear(),I.clear(),ve.clear(),se.clear(),$.clear(),X&&X.clear(),ie.forEach(function(be){be()})}function lt(be){l(!!be,"invalid args to regl({...})"),l.type(be,"object","invalid args to regl({...})");function Oe(x){var _=pe({},x);delete _.uniforms,delete _.attributes,delete _.context,delete _.vao,"stencil"in _&&_.stencil.op&&(_.stencil.opBack=_.stencil.opFront=_.stencil.op,delete _.stencil.op);function b(g){if(g in _){var c=_[g];delete _[g],Object.keys(c).forEach(function(p){_[g+"."+p]=c[p]})}}return b("blend"),b("depth"),b("cull"),b("stencil"),b("polygonOffset"),b("scissor"),b("sample"),"vao"in x&&(_.vao=x.vao),_}function Be(x,_){var b={},g={};return Object.keys(x).forEach(function(c){var p=x[c];if(Ct.isDynamic(p)){g[c]=Ct.unbox(p,c);return}else if(_&&Array.isArray(p)){for(var d=0;d<p.length;++d)if(Ct.isDynamic(p[d])){g[c]=Ct.unbox(p,c);return}}b[c]=p}),{dynamic:g,static:b}}var at=Be(be.context||{},!0),wr=Be(be.uniforms||{},!0),Jn=Be(be.attributes||{},!1),f=Be(Oe(be),!1),k={gpuTime:0,cpuTime:0,count:0},A=ce.compile(f,Jn,wr,at,k),ue=A.draw,Le=A.batch,u=A.scope,o=[];function v(x){for(;o.length<x;)o.push(null);return o}function w(x,_){var b;if(V&&l.raise("context lost"),typeof x=="function")return u.call(this,null,x,0);if(typeof _=="function")if(typeof x=="number")for(b=0;b<x;++b)u.call(this,null,_,b);else if(Array.isArray(x))for(b=0;b<x.length;++b)u.call(this,x[b],_,b);else return u.call(this,x,_,0);else if(typeof x=="number"){if(x>0)return Le.call(this,v(x|0),x|0)}else if(Array.isArray(x)){if(x.length)return Le.call(this,x,x.length)}else return ue.call(this,x)}return pe(w,{stats:k,destroy:function(){A.destroy()}})}var We=F.setFBO=lt({framebuffer:Ct.define.call(null,zu,"framebuffer")});function st(be,Oe){var Be=0;ce.procs.poll();var at=Oe.color;at&&(h.clearColor(+at[0]||0,+at[1]||0,+at[2]||0,+at[3]||0),Be|=lc),"depth"in Oe&&(h.clearDepth(+Oe.depth),Be|=uc),"stencil"in Oe&&(h.clearStencil(Oe.stencil|0),Be|=cc),l(!!Be,"called regl.clear with no buffer specified"),h.clear(Be)}function ut(be){if(l(typeof be=="object"&&be,"regl.clear() takes an object as input"),"framebuffer"in be)if(be.framebuffer&&be.framebuffer_reglType==="framebufferCube")for(var Oe=0;Oe<6;++Oe)We(pe({framebuffer:be.framebuffer.faces[Oe]},be),st);else We(be,st);else st(null,be)}function ct(be){l.type(be,"function","regl.frame() callback must be a function"),re.push(be);function Oe(){var Be=ju(re,be);l(Be>=0,"cannot cancel a frame twice");function at(){var wr=ju(re,at);re[wr]=re[re.length-1],re.length-=1,re.length<=0&&Re()}re[Be]=at}return Ce(),{cancel:Oe}}function vt(){var be=j.viewport,Oe=j.scissor_box;be[0]=be[1]=Oe[0]=Oe[1]=0,z.viewportWidth=z.framebufferWidth=z.drawingBufferWidth=be[2]=Oe[2]=h.drawingBufferWidth,z.viewportHeight=z.framebufferHeight=z.drawingBufferHeight=be[3]=Oe[3]=h.drawingBufferHeight}function gt(){z.tick+=1,z.time=Pe(),vt(),ce.procs.poll()}function it(){ve.refresh(),vt(),ce.procs.refresh(),X&&X.update()}function Pe(){return(io()-W)/1e3}it();function wt(be,Oe){l.type(Oe,"function","listener callback must be a function");var Be;switch(be){case"frame":return ct(Oe);case"lost":Be=Ee;break;case"restore":Be=ye;break;case"destroy":Be=ie;break;default:l.raise("invalid event, must be one of frame,lost,restore,destroy")}return Be.push(Oe),{cancel:function(){for(var at=0;at<Be.length;++at)if(Be[at]===Oe){Be[at]=Be[Be.length-1],Be.pop();return}}}}var Ue=pe(lt,{clear:ut,prop:Ct.define.bind(null,zu),context:Ct.define.bind(null,fc),this:Ct.define.bind(null,pc),draw:lt({}),buffer:function(be){return $.create(be,dc,!1,!1)},elements:function(be){return se.create(be,!1)},texture:ve.create2D,cube:ve.createCube,renderbuffer:N.create,framebuffer:F.create,framebufferCube:F.createCube,vao:I.createVAO,attributes:T,frame:ct,on:wt,limits:L,hasExtension:function(be){return L.extensions.indexOf(be.toLowerCase())>=0},read:J,destroy:Fe,_gl:h,_refresh:it,poll:function(){gt(),X&&X.update()},now:Pe,stats:U});return s.onDone(null,Ue),Ue}return hc})})(Yu);var gc=Yu.exports,Ii=`precision highp float;

attribute vec2 position;

void main() {
  vec2 a = vec2(1.0);
  gl_Position = vec4(position, 0, 1);
}`,wc=`precision highp float;

vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }
vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }
vec3 fade(vec3 t) { return t * t * t * (t * (t * 6.0 - 15.0) + 10.0); }

float cnoise(vec3 P) {
  vec3 Pi0 = floor(P);
  vec3 Pi1 = Pi0 + vec3(1.0);
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P);
  vec3 Pf1 = Pf0 - vec3(1.0);
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;
  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);
  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
  vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);
  vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);
  vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);
  vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);
  vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);
  vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);
  vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);
  vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);
  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;
  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);
  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);
  return 2.2 * n_xyz;
}

uniform sampler2D starPositionTexture;
uniform sampler2D starColorTexture;

uniform vec3 emissiveHigh;
uniform vec3 emissiveLow;
uniform vec3 albedoHigh;
uniform vec3 albedoLow;
uniform vec3 albedoOffset;
uniform vec3 emissiveOffset;

uniform vec2 offset;

uniform float albedoScale;
uniform float emissiveScale;
uniform float lacunarity;
uniform float absorption;
uniform float density;
uniform float depth;
uniform float scale;
uniform float falloff;
uniform float gain;

uniform int octaves;
uniform int nStars;

float fbm(vec3 p) {
  float amplitude = 1.0;
  float frequency = 1.0;
  float sum = 0.0;
  float q = 0.0;
  for (int i = 0; i < 32; i++) {
    sum += amplitude * cnoise(frequency * p);
    q += amplitude;
    amplitude *= gain;
    frequency *= lacunarity;
    if (i >= octaves) {
      break;
    }
  }
  return sum / q;
}

void main() {
  vec3 p = vec3(scale * (gl_FragCoord.xy + offset), 0.002 * depth);

  float d = fbm(p);
  d = abs(d);
  d = exp(-falloff * d);
  d *= density;

  vec3 totalLight = vec3(0.0);

  for (int i = 0; i < 1024; i++) {
    if (i >= nStars) {
      break;
    }
    vec2 xy = vec2((float(i) + 0.5) / float(nStars), 0.5);
    vec3 pos = texture2D(starPositionTexture, xy).rgb;
    vec3 dl = vec3(scale * pos.xy, 0.002 * pos.z) - p;
    vec3 ndl = normalize(dl);
    vec3 ndeye = vec3(0, 0, -1);
    float light = clamp(dot(ndl, ndeye), 0.0, 1.0);
    light = light / (dl.x * dl.x + dl.y * dl.y + dl.z * dl.z);
    totalLight += light * texture2D(starColorTexture, xy).rgb;
  }

  vec3 emissive = mix(emissiveLow, emissiveHigh, abs(cnoise(p * emissiveScale + emissiveOffset)));
  vec3 albedo = mix(albedoLow, albedoHigh, abs(cnoise(p * albedoScale + albedoOffset)));

  gl_FragColor = vec4(totalLight * d * albedo + d * emissive, d * absorption);
}`,yc=`precision highp float;

uniform vec3 color, position;
uniform vec2 resolution, offset;
uniform float scale;
uniform float falloff;
uniform float diffractionSpikeFalloff;
uniform float diffractionSpikeScale;

void main() {
  vec2 p = scale * (gl_FragCoord.xy + offset);
  vec2 dl = scale * (position.xy) - p.xy;
  float spike = exp(-diffractionSpikeFalloff * abs(dl.x));
  spike += exp(-diffractionSpikeFalloff * abs(dl.y));
  spike *= exp(-1.0 / diffractionSpikeScale * falloff * length(dl));
  float light = spike + exp(-falloff * length(dl));
  gl_FragColor = vec4(light * 4.0 * normalize(color), 0.0);
}`,xc=`precision highp float;

uniform sampler2D starTexture;
uniform vec2 resolution;
uniform vec2 offset;
uniform float density;
uniform float brightness;

void main() {
  vec2 xy = (offset + gl_FragCoord.xy) / resolution;

  if (texture2D(starTexture, xy).a > density) {
    discard;
  };

  float alpha = texture2D(starTexture, xy + 0.5).a;
  float c = log(1.0 - alpha) * -brightness;
  gl_FragColor = vec4(c, c, c, 1);
}`,Ec=`precision highp float;

vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec4 mod289(vec4 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }
vec4 permute(vec4 x) { return mod289(((x * 34.0) + 1.0) * x); }
vec4 taylorInvSqrt(vec4 r) { return 1.79284291400159 - 0.85373472095314 * r; }
vec3 fade(vec3 t) { return t * t * t * (t * (t * 6.0 - 15.0) + 10.0); }

float cnoise(vec3 P) {
  vec3 Pi0 = floor(P);
  vec3 Pi1 = Pi0 + vec3(1.0);
  Pi0 = mod289(Pi0);
  Pi1 = mod289(Pi1);
  vec3 Pf0 = fract(P);
  vec3 Pf1 = Pf0 - vec3(1.0);
  vec4 ix = vec4(Pi0.x, Pi1.x, Pi0.x, Pi1.x);
  vec4 iy = vec4(Pi0.yy, Pi1.yy);
  vec4 iz0 = Pi0.zzzz;
  vec4 iz1 = Pi1.zzzz;
  vec4 ixy = permute(permute(ix) + iy);
  vec4 ixy0 = permute(ixy + iz0);
  vec4 ixy1 = permute(ixy + iz1);
  vec4 gx0 = ixy0 * (1.0 / 7.0);
  vec4 gy0 = fract(floor(gx0) * (1.0 / 7.0)) - 0.5;
  gx0 = fract(gx0);
  vec4 gz0 = vec4(0.5) - abs(gx0) - abs(gy0);
  vec4 sz0 = step(gz0, vec4(0.0));
  gx0 -= sz0 * (step(0.0, gx0) - 0.5);
  gy0 -= sz0 * (step(0.0, gy0) - 0.5);
  vec4 gx1 = ixy1 * (1.0 / 7.0);
  vec4 gy1 = fract(floor(gx1) * (1.0 / 7.0)) - 0.5;
  gx1 = fract(gx1);
  vec4 gz1 = vec4(0.5) - abs(gx1) - abs(gy1);
  vec4 sz1 = step(gz1, vec4(0.0));
  gx1 -= sz1 * (step(0.0, gx1) - 0.5);
  gy1 -= sz1 * (step(0.0, gy1) - 0.5);
  vec3 g000 = vec3(gx0.x, gy0.x, gz0.x);
  vec3 g100 = vec3(gx0.y, gy0.y, gz0.y);
  vec3 g010 = vec3(gx0.z, gy0.z, gz0.z);
  vec3 g110 = vec3(gx0.w, gy0.w, gz0.w);
  vec3 g001 = vec3(gx1.x, gy1.x, gz1.x);
  vec3 g101 = vec3(gx1.y, gy1.y, gz1.y);
  vec3 g011 = vec3(gx1.z, gy1.z, gz1.z);
  vec3 g111 = vec3(gx1.w, gy1.w, gz1.w);
  vec4 norm0 = taylorInvSqrt(vec4(dot(g000, g000), dot(g010, g010), dot(g100, g100), dot(g110, g110)));
  g000 *= norm0.x;
  g010 *= norm0.y;
  g100 *= norm0.z;
  g110 *= norm0.w;
  vec4 norm1 = taylorInvSqrt(vec4(dot(g001, g001), dot(g011, g011), dot(g101, g101), dot(g111, g111)));
  g001 *= norm1.x;
  g011 *= norm1.y;
  g101 *= norm1.z;
  g111 *= norm1.w;
  float n000 = dot(g000, Pf0);
  float n100 = dot(g100, vec3(Pf1.x, Pf0.yz));
  float n010 = dot(g010, vec3(Pf0.x, Pf1.y, Pf0.z));
  float n110 = dot(g110, vec3(Pf1.xy, Pf0.z));
  float n001 = dot(g001, vec3(Pf0.xy, Pf1.z));
  float n101 = dot(g101, vec3(Pf1.x, Pf0.y, Pf1.z));
  float n011 = dot(g011, vec3(Pf0.x, Pf1.yz));
  float n111 = dot(g111, Pf1);
  vec3 fade_xyz = fade(Pf0);
  vec4 n_z = mix(vec4(n000, n100, n010, n110), vec4(n001, n101, n011, n111), fade_xyz.z);
  vec2 n_yz = mix(n_z.xy, n_z.zw, fade_xyz.y);
  float n_xyz = mix(n_yz.x, n_yz.y, fade_xyz.x);
  return 2.2 * n_xyz;
}

uniform float lacunarity, gain;
uniform int octaves;

float fbm(vec3 p) {
  float amplitude = 1.0;
  float frequency = 1.0;
  float sum = 0.0;
  float q = 0.0;
  for (int i = 0; i < 13; i++) {
    sum += amplitude * cnoise(frequency * p);
    q += amplitude;
    amplitude *= gain;
    frequency *= lacunarity;
    if (i >= octaves) {
      break;
    }
  }
  return sum / q;
}

uniform vec3 color;
uniform vec2 resolution, offset;
uniform float depth, scale, density, falloff;

void main() {
  vec3 p = vec3(scale * (gl_FragCoord.xy + offset), 0.002 * depth);
  float d = density * exp(-falloff * (0.5 + 0.5 * fbm(p)));
  gl_FragColor = vec4(d * color, 1.0);
}`,Cc=`precision highp float;
uniform sampler2D texture;
uniform vec2 resolution;

void main() {
  vec2 xy = gl_FragCoord.xy / resolution;
  gl_FragColor = texture2D(texture, xy);
}
`,Ac=`precision highp float;
uniform sampler2D incidentTexture, lightTexture;
uniform vec2 resolution;

void main() {
  vec2 uv = gl_FragCoord.xy / resolution;
  vec3 incident = texture2D(incidentTexture, uv).rgb;
  vec4 light = texture2D(lightTexture, uv);
  gl_FragColor = vec4(incident * exp(-light.a) + light.rgb, 1.0);
}
`;class Sc{constructor(){Bt(this,"canvas");Bt(this,"regl");Bt(this,"renderStars");Bt(this,"renderBackground");Bt(this,"renderNebula");Bt(this,"renderStar");Bt(this,"paste");Bt(this,"accumulate");Bt(this,"pingpong");Bt(this,"fbLight");Bt(this,"starPositionTexture");Bt(this,"starColorTexture");this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.regl=gc({canvas:this.canvas,attributes:{preserveDrawingBuffer:!0,alpha:!1},extensions:["OES_texture_float"]});const me=Wu("alea seed"),Z=1024,pe=new Uint8ClampedArray(Z*Z);for(let Ae=0;Ae<pe.length;Ae++)pe[Ae]=Math.floor(me()*256);const H=this.regl.texture({data:pe,width:Z,height:Z,format:"alpha",wrap:"repeat"});this.renderStars=this.regl({vert:Ii,frag:xc,attributes:{position:this.regl.buffer([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1])},uniforms:{starTexture:H,offset:this.regl.prop("offset"),density:this.regl.prop("density"),brightness:this.regl.prop("brightness"),resolution:[Z,Z]},depth:{enable:!1},count:6,viewport:this.regl.prop("viewport"),framebuffer:this.regl.prop("framebuffer")}),this.renderBackground=this.regl({vert:Ii,frag:Ec,attributes:{position:this.regl.buffer([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1])},uniforms:{depth:this.regl.prop("depth"),color:this.regl.prop("color"),scale:this.regl.prop("scale"),lacunarity:this.regl.prop("lacunarity"),gain:this.regl.prop("gain"),octaves:this.regl.prop("octaves"),density:this.regl.prop("density"),falloff:this.regl.prop("falloff"),offset:this.regl.prop("offset"),resolution:this.regl.prop("resolution")},depth:{enable:!1},blend:{enable:!0,func:{src:"one",dst:"one"}},count:6,viewport:this.regl.prop("viewport"),framebuffer:this.regl.prop("framebuffer")}),this.renderNebula=this.regl({vert:Ii,frag:wc,attributes:{position:this.regl.buffer([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1])},uniforms:{depth:this.regl.prop("depth"),starPositionTexture:this.regl.prop("starPositionTexture"),starColorTexture:this.regl.prop("starColorTexture"),nStars:this.regl.prop("nStars"),scale:this.regl.prop("scale"),absorption:this.regl.prop("absorption"),emissiveLow:this.regl.prop("emissiveLow"),emissiveHigh:this.regl.prop("emissiveHigh"),emissiveOffset:this.regl.prop("emissiveOffset"),emissiveScale:this.regl.prop("emissiveScale"),albedoLow:this.regl.prop("albedoLow"),albedoHigh:this.regl.prop("albedoHigh"),albedoOffset:this.regl.prop("albedoOffset"),albedoScale:this.regl.prop("albedoScale"),lacunarity:this.regl.prop("lacunarity"),gain:this.regl.prop("gain"),octaves:this.regl.prop("octaves"),density:this.regl.prop("density"),falloff:this.regl.prop("falloff"),offset:this.regl.prop("offset")},depth:{enable:!1},blend:{enable:!0,func:{src:"one",dst:"one"}},count:6,viewport:this.regl.prop("viewport"),framebuffer:this.regl.prop("framebuffer")}),this.renderStar=this.regl({vert:Ii,frag:yc,attributes:{position:this.regl.buffer([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1])},uniforms:{position:this.regl.prop("position"),color:this.regl.prop("color"),diffractionSpikeFalloff:this.regl.prop("diffractionSpikeFalloff"),diffractionSpikeScale:this.regl.prop("diffractionSpikeScale"),scale:this.regl.prop("scale"),falloff:this.regl.prop("falloff"),offset:this.regl.prop("offset"),resolution:this.regl.prop("resolution")},depth:{enable:!1},blend:{enable:!0,func:{src:"one",dst:"one"}},count:6,viewport:this.regl.prop("viewport"),framebuffer:this.regl.prop("framebuffer")}),this.paste=this.regl({vert:Ii,frag:Cc,attributes:{position:this.regl.buffer([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1])},uniforms:{texture:this.regl.prop("texture"),resolution:this.regl.prop("resolution")},depth:{enable:!1},count:6,viewport:this.regl.prop("viewport"),framebuffer:this.regl.prop("framebuffer")}),this.accumulate=this.regl({vert:Ii,frag:Ac,attributes:{position:this.regl.buffer([-1,-1,1,-1,1,1,-1,-1,1,1,-1,1])},uniforms:{incidentTexture:this.regl.prop("incidentTexture"),lightTexture:this.regl.prop("lightTexture"),resolution:this.regl.prop("resolution")},depth:{enable:!1},count:6,viewport:this.regl.prop("viewport"),framebuffer:this.regl.prop("framebuffer")}),this.pingpong=[this.regl.framebuffer({colorType:"float",depth:!1}),this.regl.framebuffer({colorType:"float",depth:!1})],this.fbLight=this.regl.framebuffer({colorType:"float",depth:!1}),this.starPositionTexture=this.regl.texture(),this.starColorTexture=this.regl.texture()}render(me,Z,pe={}){const H=Ks(Ks({},Pc()),pe);(this.canvas.width!==me||this.canvas.height!==Z)&&(this.canvas.width=me,this.canvas.height=Z,this.pingpong[0]({width:me,height:Z}),this.pingpong[1]({width:me,height:Z}),this.fbLight({width:me,height:Z}));const Ae={x:0,y:0,width:me,height:Z};this.regl.clear({color:[0,0,0,0]}),this.regl.clear({color:[0,0,0,0],framebuffer:this.fbLight}),this.regl.clear({color:[0,0,0,0],framebuffer:this.pingpong[0]}),this.regl.clear({color:[0,0,0,0],framebuffer:this.pingpong[1]});let Te=0;H.stars.length===0&&H.stars.push({position:[0,0,0],color:[0,0,0],falloff:0,diffractionSpikeFalloff:0,diffractionSpikeScale:0}),this.starPositionTexture({data:H.stars.flatMap(Xe=>Xe.position),width:H.stars.length,height:1,type:"float",format:"rgb"}),this.starColorTexture({data:H.stars.flatMap(Xe=>Xe.color),width:H.stars.length,height:1,type:"float",format:"rgb"}),this.renderStars({offset:H.offset,density:H.backgroundStarDensity,brightness:H.backgroundStarBrightness,viewport:Ae,framebuffer:this.pingpong[0]}),this.renderBackground({color:H.backgroundColor,depth:H.backgroundDepth,resolution:[me,Z],offset:H.offset,lacunarity:H.backgroundLacunarity,gain:H.backgroundGain,density:H.backgroundDensity,octaves:H.backgroundOctaves,falloff:H.backgroundFalloff,scale:H.backgroundScale,viewport:Ae,framebuffer:this.pingpong[0]}),this.paste({resolution:[me,Z],texture:this.pingpong[0],viewport:Ae});for(let Xe=0;Xe<H.nebulaLayers;Xe++){const Mt=H.nebulaFar-Xe*(H.nebulaFar-H.nebulaNear)/(H.nebulaLayers-1);this.regl.clear({color:[0,0,0,0],framebuffer:this.fbLight}),this.renderNebula({depth:Mt,starPositionTexture:this.starPositionTexture,starColorTexture:this.starColorTexture,nStars:H.stars.length,offset:H.offset,absorption:H.nebulaAbsorption,lacunarity:H.nebulaLacunarity,gain:H.nebulaGain,albedoLow:H.nebulaAlbedoLow,albedoHigh:H.nebulaAlbedoHigh,albedoOffset:H.nebulaAlbedoOffset,albedoScale:H.nebulaAlbedoScale,emissiveLow:H.nebulaEmissiveLow,emissiveHigh:H.nebulaEmissiveHigh,emissiveOffset:H.nebulaEmissiveOffset,emissiveScale:H.nebulaEmissiveScale,density:H.nebulaDensity,octaves:H.nebulaOctaves,falloff:H.nebulaFalloff,scale:H.scale,viewport:Ae,framebuffer:this.fbLight}),this.accumulate({resolution:[me,Z],incidentTexture:this.pingpong[Te],lightTexture:this.fbLight,viewport:Ae,framebuffer:this.pingpong[1-Te]}),Te=1-Te}for(const Xe of H.stars)this.renderStar({position:Xe.position,color:Xe.color,falloff:Xe.falloff,diffractionSpikeFalloff:Xe.diffractionSpikeFalloff,diffractionSpikeScale:Xe.diffractionSpikeScale,offset:H.offset,scale:H.scale,resolution:[me,Z],viewport:Ae,framebuffer:this.pingpong[Te]});this.paste({resolution:[me,Z],texture:this.pingpong[Te],viewport:Ae});const Se=document.createElement("canvas");return Se.width=me,Se.height=Z,Se.getContext("2d").drawImage(this.canvas,0,0),Se}}function Pc(){return{scale:.002,offset:[0,0],backgroundColor:[.125,.125,.25],backgroundDepth:137,backgroundLacunarity:2,backgroundGain:.5,backgroundDensity:2,backgroundOctaves:8,backgroundFalloff:8,backgroundScale:.003,backgroundStarDensity:.05,backgroundStarBrightness:.125,nebulaNear:0,nebulaFar:500,nebulaLayers:1e3,nebulaAbsorption:1,nebulaLacunarity:2,nebulaDensity:.1,nebulaGain:.5,nebulaOctaves:7,nebulaFalloff:4,nebulaEmissiveLow:[0,0,0],nebulaEmissiveHigh:[0,0,0],nebulaEmissiveOffset:[0,0,0],nebulaEmissiveScale:1,nebulaAlbedoLow:[1,1,1],nebulaAlbedoHigh:[1,1,1],nebulaAlbedoOffset:[0,0,0],nebulaAlbedoScale:1,stars:[]}}const Xs=[[1,.0401,.003],[1,.0631,.003],[1,.086,.003],[1,.1085,.003],[1,.1303,.003],[1,.1515,.003],[1,.1718,.003],[1,.1912,.003],[1,.2097,.003],[1,.2272,.003],[1,.2484,.0061],[1,.2709,.0153],[1,.293,.0257],[1,.3149,.0373],[1,.3364,.0501],[1,.3577,.064],[1,.3786,.079],[1,.3992,.095],[1,.4195,.1119],[1,.4394,.1297],[1,.4589,.1483],[1,.4781,.1677],[1,.497,.1879],[1,.5155,.2087],[1,.5336,.2301],[1,.5515,.252],[1,.5689,.2745],[1,.586,.2974],[1,.6028,.3207],[1,.6193,.3444],[1,.6354,.3684],[1,.6511,.3927],[1,.6666,.4172],[1,.6817,.4419],[1,.6966,.4668],[1,.7111,.4919],[1,.7253,.517],[1,.7392,.5422],[1,.7528,.5675],[1,.7661,.5928],[1,.7792,.618],[1,.7919,.6433],[1,.8044,.6685],[1,.8167,.6937],[1,.8286,.7187],[1,.8403,.7437],[1,.8518,.7686],[1,.863,.7933],[1,.874,.8179],[1,.8847,.8424],[1,.8952,.8666],[1,.9055,.8907],[1,.9156,.9147],[1,.9254,.9384],[1,.9351,.9619],[1,.9445,.9853],[.9917,.9458,1],[.9696,.9336,1],[.9488,.9219,1],[.929,.9107,1],[.9102,.9,1],[.8923,.8897,1],[.8753,.8799,1],[.8591,.8704,1],[.8437,.8614,1],[.8289,.8527,1],[.8149,.8443,1],[.8014,.8363,1],[.7885,.8285,1],[.7762,.8211,1],[.7644,.8139,1],[.7531,.8069,1],[.7423,.8002,1],[.7319,.7938,1],[.7219,.7875,1],[.7123,.7815,1],[.703,.7757,1],[.6941,.77,1],[.6856,.7645,1],[.6773,.7593,1],[.6693,.7541,1],[.6617,.7492,1],[.6543,.7444,1],[.6471,.7397,1],[.6402,.7352,1],[.6335,.7308,1],[.6271,.7265,1],[.6208,.7224,1],[.6148,.7183,1],[.6089,.7144,1],[.6033,.7106,1],[.5978,.7069,1],[.5925,.7033,1],[.5873,.6998,1],[.5823,.6964,1],[.5774,.693,1],[.5727,.6898,1],[.5681,.6866,1],[.5637,.6836,1],[.5593,.6806,1],[.5551,.6776,1],[.551,.6748,1],[.547,.672,1],[.5432,.6693,1],[.5394,.6666,1],[.5357,.664,1],[.5322,.6615,1],[.5287,.659,1],[.5253,.6566,1],[.522,.6542,1],[.5187,.6519,1],[.5156,.6497,1]],Tc=new Sc,$e=document.getElementById("render-canvas");let Ha=!1;async function Au(Ie){if(!Ie)return;Ha&&(Ha=!1,await qs()),Ha=!0;const me=$e.getContext("2d");me.clearRect(0,0,$e.width,$e.height),await qs();const Z=256,pe=Wu(Ie),H=[pe()*1e7-5e6,pe()*1e7-5e6];H[0]-=.5*$e.width,H[1]-=.5*$e.height;const Ae=0,Te=500,Se=2*(Te-Ae),Qe=.001+pe()*.001,Xe=[],Mt=Math.min(64,1+Math.round(pe()*($e.width*$e.height)*Qe*Qe));for(let De=0;De<Mt;De++){const xt=Xs[Math.floor(pe()*Xs.length)].slice(),zr=.5*pe();xt[0]*=zr,xt[1]*=zr,xt[2]*=zr,Xe.push({position:[H[0]+pe()*$e.width,H[1]+pe()*$e.height,Ae+pe()*(Te-Ae)],color:xt,falloff:256,diffractionSpikeFalloff:1024,diffractionSpikeScale:4+4*pe()})}const Ve=Xs[Math.floor(pe()*Xs.length)].slice(),Pt=.5*pe();Ve[0]*=Pt,Ve[1]*=Pt,Ve[2]*=Pt;const Gi={stars:Xe,scale:Qe,backgroundColor:Ve,nebulaLacunarity:1.8+.2*pe(),nebulaGain:.5,nebulaAbsorption:1,nebulaFalloff:256+pe()*1024,nebulaNear:Ae,nebulaFar:Te,nebulaLayers:Se,nebulaDensity:(50+pe()*100)/Se,nebulaAlbedoLow:[pe(),pe(),pe()],nebulaAlbedoHigh:[pe(),pe(),pe()],nebulaAlbedoScale:pe()*8};for(let De=0;De<$e.height;De+=Z)for(let xt=0;xt<$e.width;xt+=Z)if(me.drawImage(Tc.render(Z,Z,Ks({offset:[xt+H[0],De+H[1]]},Gi)),xt,$e.height-(De+Z)),await qs(),!Ha)return;Ha=!1}function Xu(){const Ie="abcdefghijklmnopqrstuvqxyz1234567890";let me="";for(let Z=0;Z<22;Z++)me+=Ie[Math.floor(Math.random()*Ie.length)];return me}function Su(Ie,me){$e.width=Ie,$e.height=me,Qu()}function Qu(){const Ie=window.innerWidth/$e.width,me=window.innerHeight/$e.height,Z=Math.min(Ie,me);if(Z<1){const pe=Z*$e.width,H=Z*$e.height;$e.style.width=`${pe}px`,$e.style.height=`${H}px`,$e.style.left=`${Math.round(.5*(window.innerWidth-pe))}px`,$e.style.top=`${Math.round(.5*(window.innerHeight-H))}px`}else $e.style.width=`${$e.width}px`,$e.style.height=`${$e.height}px`,$e.style.left=`${Math.round(.5*(window.innerWidth-$e.width))}px`,$e.style.top=`${Math.round(.5*(window.innerHeight-$e.height))}px`}function Pu(Ie){history.replaceState(null,"",`?seed=${Ie.seed}&width=${Ie.width}&height=${Ie.height}`)}async function kc(){var pe,H,Ae;var Ie=new URLSearchParams(window.location.search);const me={seed:(pe=Ie.get("seed"))!=null?pe:Xu(),width:parseInt((H=Ie.get("width"))!=null?H:window.innerWidth.toString()),height:parseInt((Ae=Ie.get("height"))!=null?Ae:window.innerHeight.toString())},Z=new Tu.exports.Pane({title:"Options"});Z.addInput(me,"seed"),Z.addButton({title:"Randomize & Render",label:""}).on("click",()=>{me.seed=Xu(),Z.refresh(),Pu(me),Au(me.seed)}),Z.addInput(me,"width",{step:1}).on("change",()=>{Su(me.width,me.height)}),Z.addInput(me,"height",{step:1}).on("change",()=>{Su(me.width,me.height)}),Z.addButton({title:"Render",label:""}).on("click",()=>{Pu(me),Au(me.seed)}),Z.addButton({title:"Download",label:""}).on("click",()=>{const Te=$e.toDataURL(),Se=document.createElement("a");Se.download=`${me.seed}.png`,Se.href=Te,Se.click()}),Su(me.width,me.height),window.addEventListener("resize",()=>{Qu()}),await qs(),Pu(me),await Au(me.seed)}kc();function qs(){return new Promise(Ie=>{requestAnimationFrame(Ie)})}
